var tape=require("tape"),protobuf=require(".."),ProtocolError=protobuf.util.ProtocolError;tape.test("a protocol error",function(o){o.ok(ProtocolError("test1")instanceof ProtocolError,"should construct by calling the constructor as a function"),o.ok(new ProtocolError("test2")instanceof ProtocolError,"should construct by using the 'new' keyword");var r=(new protobuf.Root).add(new protobuf.Type("Test").add(new protobuf.Field("foo",1,"uint32","optional")).add(new protobuf.Field("bar",2,"string","required"))).lookup("Test"),e=protobuf.util.newBuffer(2);e[0]=8,e[1]=2;try{r.decode(e),o.fail("should be thrown if a message is missing required fields")}catch(r){o.ok(r instanceof ProtocolError,"should be thrown if a message is missing required fields"),o.ok(r.message,"should have an error message"),o.ok("string"==typeof r.stack,"should have a stack trace (empty string if not supported)"),o.equal(r.name,"ProtocolError","should have the correct name"),o.ok(/^ProtocolError: /.test(r.toString()),"should correctly convert toString"),o.same(r.instance,{foo:2},"should still return the so far decoded message")}o.end()});