var tape=require("tape"),protobuf=require(".."),Namespace=protobuf.Namespace,Type=protobuf.Type,Field=protobuf.Field;tape.test("extension fields",function(e){var d=new protobuf.Root({noGoogleTypes:!0}),l=new Namespace("my"),o=new Type("DeclaringType"),a=new Field("declaringField",1,"string","optional","ExtendedType");d.add(l.add(o.add(a))),e.deepEqual(d.deferred[0],a,"should be deferred until their extended type can be resolved");var n=new Type("ExtendedType");l.add(n);var t=n.get(a.fullName);e.equal(t,a.extensionField,"should become available once their extended type is known"),o.remove(a),t=n.get(a.fullName),e.equal(t,null,"should become unavailable when their declaring field is removed"),o.add(a),t=n.get(a.fullName),e.equal(t,a.extensionField,"should become instantly available if their extended type is knwon"),d.add(o=new Type("Test")),o.add(a),e.throws(function(){d.resolveAll()},Error,"should throw on resolveAll if there are unresolvable extensions"),o.remove(a),e.end()});