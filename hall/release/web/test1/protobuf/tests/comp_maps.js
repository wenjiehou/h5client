function randomString(e){for(var a="",r=0;r<e;++r)a+=chars.charAt(Math.random()*chars.length|0);return a}function randomMap(){for(var e={},a=0;a<10;++a){for(var r=[],n=0;n<10;++n)r.push(randomString(10));var o;do{o=randomString(10)}while(e[o]);e[o]={key:randomString(10),values:r}}return e}function verifyEncode(e,a){e.test(e.name+" - should encode",function(e){e.equal(a.length,32,"a total of 30 bytes"),e.equal(a[0],10,"id 1, wireType 2"),e.equal(a[1],14,"a length of 14"),e.equal(a[2],10,"id 1, wireType 2"),e.equal(a[3],1,"a length of 1"),e.equal(a[4],98,"'b'"),e.equal(a[5],18,"id 2, wireType 2"),e.equal(a[6],9,"a length of 9"),e.equal(a[7],10,"id 1, wireType 2"),e.equal(a[8],1,"a length of 1"),e.equal(a[9],49,"'1'"),e.equal(a[10],18,"id 2, wireType 2"),e.equal(a[11],1,"a length of 1"),e.equal(a[12],99,"'c'"),e.equal(a[13],18,"id 2, wireType 2"),e.equal(a[14],1,"a length of 1"),e.equal(a[15],100,"'d'"),e.equal(a[16],10,"id 1, wireType 2"),e.end()})}var tape=require("tape"),protobuf=require(".."),root=protobuf.Root.fromJSON({nested:{Inner:{fields:{key:{type:"string",id:1},values:{rule:"repeated",type:"string",id:2}}},Outer:{fields:{value:{keyType:"string",type:"Inner",id:1}}}}}),chars="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";tape.test("maps",function(e){root.lookup("Inner");var a=root.lookup("Outer");e.test(e.name+" - randomly generated",function(e){var r={value:randomMap()},n=a.encode(r).finish(),o=a.decode(n);e.deepEqual(o,r,"should decode back the original random map"),e.end()}),e.test(e.name+" - specifically crafted",function(e){var r={value:{b:{key:"1",values:["c","d"]},a:{key:"2",values:["a","b"]}}},n=a.encode(r).finish();verifyEncode(e,n);var o=a.decode(n);e.deepEqual(o,r,"should decode back the original map"),e.end()}),e.end()});