function performRequestOverTransportChannel(e,o){setTimeout(function(){var r={message:"Hello "+Hello.decodeDelimited(e).name};setTimeout(function(){o(World.encodeDelimited(r).finish())},250*Math.random())},250*Math.random())}var protobuf=require(".."),root=protobuf.Root.fromJSON({nested:{Greeter:{methods:{SayHello:{requestType:"Hello",requestStream:!0,responseType:"World",responseStream:!0}}},Hello:{fields:{name:{type:"string",id:1}}},World:{fields:{message:{type:"string",id:1}}}}}),Greeter=root.lookup("Greeter"),Hello=root.lookup("Hello"),World=root.lookup("World"),greeter=Greeter.create(function(){var e=!1;return function(o,r,t){e||(r?performRequestOverTransportChannel(r,function(e){t(null,e)}):e=!0)}}(),!0,!0);greeter.on("data",function(e,o){console.log("data in "+o.name+":",e.message)}),greeter.on("end",function(){console.log("end")}),greeter.on("error",function(e,o){console.log("error in "+o.name+":",e)}),greeter.sayHello({name:"one"}),greeter.sayHello(Hello.create({name:"two"})),greeter.on("status",function(e,o){console.log("custom status:",e,o)}),greeter.emit("status",200,"OK"),setTimeout(function(){greeter.end(),greeter.sayHello({name:"three"},function(e){console.error("this should fail: "+e.message)})},501);