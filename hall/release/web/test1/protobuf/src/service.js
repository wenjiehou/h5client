"use strict";function Service(e,t){Namespace.call(this,e,t),this.methods={},this._methodsArray=null}function clearCache(e){return e._methodsArray=null,e}module.exports=Service;var Namespace=require("./namespace");((Service.prototype=Object.create(Namespace.prototype)).constructor=Service).className="Service";var Method=require("./method"),util=require("./util"),rpc=require("./rpc");Service.fromJSON=function(e,t){var r=new Service(e,t.options);if(t.methods)for(var o=Object.keys(t.methods),s=0;s<o.length;++s)r.add(Method.fromJSON(o[s],t.methods[o[s]]));return t.nested&&r.addJSON(t.nested),r},Service.prototype.toJSON=function(){var e=Namespace.prototype.toJSON.call(this);return{options:e&&e.options||void 0,methods:Namespace.arrayToJSON(this.methodsArray)||{},nested:e&&e.nested||void 0}},Object.defineProperty(Service.prototype,"methodsArray",{get:function(){return this._methodsArray||(this._methodsArray=util.toArray(this.methods))}}),Service.prototype.get=function(e){return this.methods[e]||Namespace.prototype.get.call(this,e)},Service.prototype.resolveAll=function(){for(var e=this.methodsArray,t=0;t<e.length;++t)e[t].resolve();return Namespace.prototype.resolve.call(this)},Service.prototype.add=function(e){if(this.get(e.name))throw Error("duplicate name '"+e.name+"' in "+this);return e instanceof Method?(this.methods[e.name]=e,e.parent=this,clearCache(this)):Namespace.prototype.add.call(this,e)},Service.prototype.remove=function(e){if(e instanceof Method){if(this.methods[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.methods[e.name],e.parent=null,clearCache(this)}return Namespace.prototype.remove.call(this,e)},Service.prototype.create=function(e,t,r){for(var o=new rpc.Service(e,t,r),s=0;s<this.methodsArray.length;++s)o[util.lcFirst(this._methodsArray[s].resolve().name)]=util.codegen("r","c")("return this.rpcCall(m,q,s,r,c)").eof(util.lcFirst(this._methodsArray[s].name),{m:this._methodsArray[s],q:this._methodsArray[s].resolvedRequestType.ctor,s:this._methodsArray[s].resolvedResponseType.ctor});return o};