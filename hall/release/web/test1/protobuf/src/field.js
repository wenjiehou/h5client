"use strict";function Field(e,t,i,s,l,o){if(util.isObject(s)?(o=s,s=l=void 0):util.isObject(l)&&(o=l,l=void 0),ReflectionObject.call(this,e,o),!util.isInteger(t)||t<0)throw TypeError("id must be a non-negative integer");if(!util.isString(i))throw TypeError("type must be a string");if(void 0!==s&&!ruleRe.test(s=s.toString().toLowerCase()))throw TypeError("rule must be a string rule");if(void 0!==l&&!util.isString(l))throw TypeError("extend must be a string");this.rule=s&&"optional"!==s?s:void 0,this.type=i,this.id=t,this.extend=l||void 0,this.required="required"===s,this.optional=!this.required,this.repeated="repeated"===s,this.map=!1,this.message=null,this.partOf=null,this.typeDefault=null,this.defaultValue=null,this.long=!!util.Long&&void 0!==types.long[i],this.bytes="bytes"===i,this.resolvedType=null,this.extensionField=null,this.declaringField=null,this._packed=null}module.exports=Field;var ReflectionObject=require("./object");((Field.prototype=Object.create(ReflectionObject.prototype)).constructor=Field).className="Field";var Type,Enum=require("./enum"),types=require("./types"),util=require("./util"),ruleRe=/^required|optional|repeated$/;Field.fromJSON=function(e,t){return new Field(e,t.id,t.type,t.rule,t.extend,t.options)},Object.defineProperty(Field.prototype,"packed",{get:function(){return null===this._packed&&(this._packed=!1!==this.getOption("packed")),this._packed}}),Field.prototype.setOption=function(e,t,i){return"packed"===e&&(this._packed=null),ReflectionObject.prototype.setOption.call(this,e,t,i)},Field.prototype.toJSON=function(){return{rule:"optional"!==this.rule&&this.rule||void 0,type:this.type,id:this.id,extend:this.extend,options:this.options}},Field.prototype.resolve=function(){if(this.resolved)return this;if(Type||(Type=require("./type")),void 0===(this.typeDefault=types.defaults[this.type])&&(this.resolvedType=(this.declaringField?this.declaringField.parent:this.parent).lookupTypeOrEnum(this.type),this.resolvedType instanceof Type?this.typeDefault=null:this.typeDefault=this.resolvedType.values[Object.keys(this.resolvedType.values)[0]]),this.options&&void 0!==this.options.default&&(this.typeDefault=this.options.default,this.resolvedType instanceof Enum&&"string"==typeof this.typeDefault&&(this.typeDefault=this.resolvedType.values[this.typeDefault])),!this.options||void 0===this.options.packed||!this.resolvedType||this.resolvedType instanceof Enum||delete this.options.packed,this.long)this.typeDefault=util.Long.fromNumber(this.typeDefault,"u"===this.type.charAt(0)),Object.freeze&&Object.freeze(this.typeDefault);else if(this.bytes&&"string"==typeof this.typeDefault){var e;util.base64.test(this.typeDefault)?util.base64.decode(this.typeDefault,e=util.newBuffer(util.base64.length(this.typeDefault)),0):util.utf8.write(this.typeDefault,e=util.newBuffer(util.utf8.length(this.typeDefault)),0),this.typeDefault=e}return this.map?this.defaultValue=util.emptyObject:this.repeated?this.defaultValue=util.emptyArray:this.defaultValue=this.typeDefault,this.parent instanceof Type&&(this.parent.ctor.prototype[this.name]=this.defaultValue),ReflectionObject.prototype.resolve.call(this)},Field.d=function(e,t,i,s){return"function"==typeof t?t=util.decorateType(t).name:t&&"object"==typeof t&&(t=util.decorateEnum(t).name),function(l,o){util.decorateType(l.constructor).add(new Field(o,e,t,i,{default:s}))}};