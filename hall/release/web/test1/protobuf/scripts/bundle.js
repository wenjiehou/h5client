"use strict";function bundle(e){if(!e||!e.entry||!e.target)throw TypeError("missing options");var r=browserify({entries:e.entry,insertGlobalVars:!1,detectGlobals:!1,debug:!0,prelude:prelude,preludePath:"./lib/prelude.js"}).external("long");return e.exclude&&e.exclude.forEach(r.exclude,r),r.plugin(require("browserify-wrap"),{prefix:'(function(global,undefined){"use strict";',suffix:'})(typeof window==="object"&&window||typeof self==="object"&&self||this);'}).plugin(require("bundle-collapser/plugin")).bundle().pipe(source(e.compress?"protobuf.min.js":"protobuf.js")).pipe(buffer()).pipe(sourcemaps.init({loadMaps:!0})).pipe(gulpif(e.compress,uglify({mangleProperties:{regex:/^_/},mangle:{eval:!0,toplevel:!1},compress:{unused:!0,keep_fargs:!1,unsafe:!0}}))).pipe(header(license,{date:(new Date).toUTCString().replace("GMT","UTC"),version:pkg.version})).pipe(sourcemaps.write(".",{sourceRoot:""})).pipe(vinylfs.dest(e.target)).on("log",gutil.log).on("error",gutil.log)}module.exports=bundle;var fs=require("fs"),path=require("path"),browserify=require("browserify"),header=require("gulp-header"),gulpif=require("gulp-if"),sourcemaps=require("gulp-sourcemaps"),uglify=require("gulp-uglify"),gutil=require("gulp-util"),buffer=require("vinyl-buffer"),vinylfs=require("vinyl-fs"),source=require("vinyl-source-stream"),zopfli=require("node-zopfli"),pkg=require(path.join(__dirname,"..","package.json")),license=["/*!"," * protobuf.js v${version} (c) 2016, Daniel Wirtz"," * Compiled ${date}"," * Licensed under the BSD-3-Clause License"," * see: https://github.com/dcodeIO/protobuf.js for details"," */"].join("\n")+"\n",prelude=fs.readFileSync(require.resolve("../lib/prelude.js")).toString("utf8");bundle.compress=function(e,r,i){var u=fs.createReadStream(e),o=fs.createWriteStream(r);u.on("error",i),o.on("error",i),o.on("close",function(){i(null)}),u.pipe(zopfli.createGzip()).pipe(o)};