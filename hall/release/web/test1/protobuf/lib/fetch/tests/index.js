function fakeXHR(t,e){function n(){this.status=0,this.readyState=r}var r=0;return e||(n.prototype.overrideMimeType=function(t){this._mimeType=t}),n.prototype.open=function(t,e){this._method=t,this._path=e,this.readyState=1},n.prototype.send=function(){var n=this;setTimeout(function(){if(n.onreadystatechange(),n.readyState=2,n.onreadystatechange(),n.readyState=3,n.onreadystatechange(),n.readyState=4,n.status=t,"arraybuffer"!==n.responseType||e)n.responseText=n._path;else{for(var r=new Buffer(n._path,"utf8"),a=new ArrayBuffer(r.length),o=new Uint8Array(a),s=0;s<r.length;++s)o[s]=r[s];n.response=a}n.onreadystatechange()})},n}var tape=require("tape"),fetch=require("..");tape.test("fetch",function(t){"undefined"!=typeof Promise&&t.test(t.name+" - promise",function(t){var e=fetch("NOTFOUND");t.plan(2),t.ok(e instanceof Promise,"should return a promise if callback has been omitted"),e.then(function(){t.fail("should not resolve")}).catch(function(e){t.ok(e,"should reject with an error")})}),t.test(t.name+" - node fs",function(t){t.test(t.name+" - string",function(t){t.plan(2),fetch(require.resolve("./data/file.txt"),function(e,n){t.notOk(e,"should not return an error"),t.equal(n,"file.txt","should return contents as a string")})}),t.test(t.name+" - binary",function(t){t.plan(2),fetch(require.resolve("./data/file.txt"),{binary:!0},function(e,n){t.notOk(e,"should not return an error"),t.same(n,new Buffer("file.txt","utf8"),"should return contents as a Buffer")})}),t.test(t.name+" - fallback",function(t){t.plan(2),global.XMLHttpRequest=fakeXHR(0),fetch("file.txt",function(e,n){delete global.XMLHttpRequest,t.notOk(e,"should not return an error"),t.same(n,"file.txt","should return contents as a string")})}),t.end()}),t.test(t.name+" - XMLHttpRequest",function(t){t.test(t.name+" - 404",function(t){global.XMLHttpRequest=fakeXHR(404),fetch("file.txt",{xhr:!0},function(e){delete global.XMLHttpRequest,t.ok(e,"should return an error"),t.end()})}),t.test(t.name+" - string",function(t){global.XMLHttpRequest=fakeXHR(0),t.plan(2),fetch("file.txt",{xhr:!0},function(e,n){delete global.XMLHttpRequest,t.notOk(e,"should not return an error"),t.equal(n,"file.txt","should return contents as a string")})}),t.test(t.name+" - binary",function(t){global.XMLHttpRequest=fakeXHR(200),t.plan(2),fetch("file.txt",{xhr:!0,binary:!0},function(e,n){delete global.XMLHttpRequest,t.notOk(e,"should not return an error"),t.same(n,new Uint8Array([102,105,108,101,46,116,120,116]),"should return contents as an Uint8Array")})})}),t.test(t.name+" - XMLHttpRequest (ancient)",function(t){t.test(t.name+" - string",function(t){global.XMLHttpRequest=fakeXHR(0,!0),t.plan(2),fetch("file.txt",{xhr:!0},function(e,n){delete global.XMLHttpRequest,t.notOk(e,"should not return an error"),t.equal(n,"file.txt","should return contents as a string")})}),t.test(t.name+" - binary",function(t){global.XMLHttpRequest=fakeXHR(200,!0);var e=global.Uint8Array;delete global.Uint8Array,t.plan(2),fetch("file.txt",{xhr:!0,binary:!0},function(n,r){delete global.XMLHttpRequest,global.Uint8Array=e,t.notOk(n,"should not return an error"),t.same(r,[102,105,108,101,46,116,120,116],"should return contents as an Array")})})})});