"use strict";function write(){var e=Array.prototype.slice.call(arguments).join("");if(!indentWritten){for(var t=0;t<indent;++t)e="    "+e;indentWritten=!0}out.write(e),firstLine=!1}function writeln(){var e=Array.prototype.slice.call(arguments).join("");e.length?write(e,"\n"):firstLine||out.write("\n"),indentWritten=!1}function writeComment(e,t){if(e&&!1!==options.comments){var n=!0;e.split(/\r?\n/g).forEach(function(e){(e=e.trim().replace(/^\*/," *")).length&&(n&&(writeln(),n=!1),writeln(e))})}else t&&writeln()}function replaceRecursive(e,t,n){function i(){return r=!0,n.apply(null,arguments)}var r;do{r=!1,e=e.replace(t,i)}while(r);return e}function isClassLike(e){return e&&("class"===e.kind||"interface"===e.kind||"mixin"===e.kind)}function isInterface(e){return e&&"interface"===e.kind}function isNamespace(e){return e&&("namespace"===e.kind||"module"===e.kind)}function getChildrenOf(e){var t=e?e.longname:void 0;return data.filter(function(e){return e.memberof===t})}function getTypeOf(e){if(e.tsType)return e.tsType;var t="any",n=e.type;return n&&n.names&&n.names.length?(t=1===n.names.length?e.type.names[0].trim():"("+e.type.names.join("|")+")",t=t.replace(/\*|\bmixed\b/g,"any"),t=t.replace(/\bobject\b/g,"Object"),t=replaceRecursive(t,/\b(?!Object|Array)([\w$]+)\.<([^>]*)>/gi,function(e,t,n){return t+"<"+n+">"}),t=replaceRecursive(t,/\bArray\.?<([^>]*)>/gi,function(e,t){return t+"[]"}),t=replaceRecursive(t,/\bObject\.?<([^,]*), *([^>]*)>/gi,function(e,t,n){return"{ [k: "+t+"]: "+n+" }"}),t=t.replace(/\bfunction(?:\(\))?([^\w]|$)/g,"Function"),t=t.replace(/\b(Object(?!\.))/g,function(e,t){return t.toLowerCase()})):t}function begin(e,t){writeComment(e.comment,t||isInterface(e)||isClassLike(e)||isNamespace(e)||e.isEnum),"global"!==e.scope||options.module||t||isInterface(e)||write("export ")}function writeFunctionSignature(e,t,n){write("(");var i={};e.this&&(i.this={type:e.this.replace(/^{|}$/g,""),optional:!1}),e.params&&e.params.forEach(function(e){var t=e.name.split(/\./g);1===t.length?i[e.name]={type:getTypeOf(e),variable:!0===e.variable,optional:!0===e.optional,defaultValue:e.defaultvalue}:i[t[0]].type="{ [k: string]: any }"});var r=Object.keys(i);if(r.forEach(function(e,t){var n=i[e],a=n.type;n.variable&&(e="..."+e,a="("===n.type.charAt(0)?"any[]":n.type+"[]"),write(e,!n.variable&&n.optional?"?: ":": ",a),t<r.length-1&&write(", ")}),write(")"),!t){write(n?" => ":": ");var a;write(e.returns&&e.returns.length&&"undefined"!==(a=getTypeOf(e.returns[0]))?a:"void")}}function writeInterface(e){write("interface ",e.name),writeInterfaceBody(e),writeln()}function writeInterfaceBody(e){writeln("{"),++indent,e.properties.forEach(writeProperty),--indent,write("}")}function writeProperty(e){writeComment(e.comment),write(e.name),e.optional&&write("?"),writeln(": ",getTypeOf(e),";")}function handleElement(e,t,n){if(!0!==e.optional&&e.type&&e.type.names&&e.type.names.length)for(var i=0;i<e.type.names.length;i++)"undefined"===e.type.names[i].toLowerCase()&&(e.optional=!0,e.type.names.splice(i,1),i--);if(seen[e.longname])return!0;if(isClassLike(e)){if(n)return!1;handleClass(e,t)}else switch(e.kind){case"module":case"namespace":if(n)return!1;handleNamespace(e,t);break;case"constant":case"member":if(n&&e.isEnum)return!1;handleMember(e,t);break;case"function":handleFunction(e,t);break;case"typedef":if(n)return!1;handleTypeDef(e,t)}return seen[e.longname]=e,!0}function handleNamespace(e){begin(e),writeln("namespace ",e.name," {"),++indent,getChildrenOf(e).forEach(function(t){handleElement(t,e)}),--indent,writeln("}")}function notAModuleReference(e){return-1===e.indexOf("module:")}function handleClass(e,t){var n=isInterface(e);if(begin(e,n),n?write("interface "):(e.virtual&&write("abstract "),write("class ")),write(e.name),e.templates&&e.templates.length&&write("<",e.templates.join(", "),">"),write(" "),e.augments){var i=e.augments.filter(notAModuleReference);i.length&&write("extends ",i[0]," ")}var r=[];e.implements&&Array.prototype.push.apply(r,e.implements),e.mixes&&Array.prototype.push.apply(r,e.mixes),(r=r.filter(notAModuleReference)).length&&write("implements ",r.join(", ")," "),writeln("{"),++indent,n||e.virtual||handleFunction(e,t,!0),n&&e.properties&&e.properties.forEach(writeProperty);var a=[];getChildrenOf(e).forEach(function(t){handleElement(t,e,!0)||a.push(t)}),--indent,writeln("}"),a.length&&(writeln(),"global"!==e.scope||options.module||write("export "),writeln("namespace ",e.name," {"),++indent,a.forEach(function(t){handleElement(t,e)}),--indent,writeln("}"))}function handleMember(e,t){begin(e),e.isEnum?(writeln("enum ",e.name," {"),++indent,e.properties.forEach(function(t,n){write(t.name),void 0!==t.defaultvalue&&write(" = ",JSON.stringify(t.defaultvalue)),n<e.properties.length-1?writeln(","):writeln()}),--indent,writeln("}")):(isClassLike(t)?(write(e.access||"public"," "),"static"===e.scope&&write("static "),e.readonly&&write("readonly ")):write("constant"===e.kind?"const ":"let "),write(e.name),e.optional&&write("?"),write(": "),e.type&&e.type.names&&/^Object\b/i.test(e.type.names[0])&&e.properties?(writeln("{"),++indent,e.properties.forEach(function(t,n){writeln(JSON.stringify(t.name),": ",getTypeOf(t),n<e.properties.length-1?",":"")}),--indent,writeln("};")):writeln(getTypeOf(e),";"))}function handleFunction(e,t,n){n?(writeComment(e.comment),write("constructor")):(begin(e),isClassLike(t)?(write(e.access||"public"," "),"static"===e.scope&&write("static ")):write("function "),write(e.name),e.templates&&e.templates.length&&write("<",e.templates.join(", "),">")),writeFunctionSignature(e,n,!1),writeln(";")}function handleTypeDef(e,t){if(isInterface(e))isClassLike(t)?queuedInterfaces.push(e):(begin(e),writeInterface(e));else{writeln(),write("type ",e.name),e.templates&&e.templates.length&&write("<",e.templates.join(", "),">"),write(" = ");var n=getTypeOf(e);e.type&&1===e.type.names.length&&"function"===e.type.names[0]?writeFunctionSignature(e,!1,!0):"object"===n?e.properties&&e.properties.length?writeInterfaceBody(e):write("{}"):write(n),writeln(";")}}var fs=require("fs"),out=null,data=null,seen={},indent=0,indentWritten=!1,options={},queuedInterfaces=[],firstLine=!0;exports.publish=function(e,t){(options=t||{}).query&&Object.keys(options.query).forEach(function(e){if("query"!==e)switch(options[e]=options.query[e]){case"true":options[e]=!0;break;case"false":options[e]=!1;break;case"null":options[e]=null}}),e({undocumented:!0}).remove(),e({ignore:!0}).remove(),e({inherited:!0}).remove(),options.private||e({access:"private"}).remove(),out=options.destination?fs.createWriteStream(options.destination):process.stdout;try{for(data=e().get(),indent=0,indentWritten=!1,firstLine=!0,options.module&&(writeln("export = ",options.module,";"),writeln(),writeln("declare namespace ",options.module," {"),writeln(),++indent),getChildrenOf(void 0).forEach(function(e){handleElement(e,null)});queuedInterfaces.length;){var n=queuedInterfaces.shift();begin(n),writeInterface(n),writeln(";")}options.module&&(--indent,writeln("}")),out!==process.stdout&&out.end()}finally{out=data=null,seen=options={},queuedInterfaces=[]}};