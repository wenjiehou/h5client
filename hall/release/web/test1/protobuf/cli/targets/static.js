"use strict";function static_target(e,t,n){config=t;try{var r=[];config.decode&&r.push("Reader"),config.encode&&r.push("Writer"),r.push("util"),r.length&&(config.comments&&push("// Common aliases"),push((config.es6?"const ":"var ")+r.map(function(e){return"$"+e+" = $protobuf."+e}).join(", ")+";"),push("")),config.comments&&(e.comment?pushComment("@fileoverview "+e.comment):push("// Exported root namespace"));var o=cliUtil.safeProp(config.root||"default");return push((config.es6?"const":"var")+" $root = $protobuf.roots"+o+" || ($protobuf.roots"+o+" = {});"),buildNamespace(null,e),n(null,out.join("\n"))}catch(e){return n(e)}finally{out=[],indent=0,config={}}}function push(e){if(""===e)return out.push("");for(var t="",n=0;n<indent;++n)t+="    ";return out.push(t+e)}function pushComment(e){if(config.comments){for(var t=[],n=0;n<e.length;++n)null!==e[n]&&"@exclude"!==e[n].substring(0,8)&&Array.prototype.push.apply(t,e[n].split(/\r?\n/g));push("/**"),t.forEach(function(e){null!==e&&push(" * "+e.replace(/\*\//g,"* /"))}),push(" */")}}function name(e){return e?cliUtil.reserved(e)?e+"_":e:"$root"}function aOrAn(e){return(!/^[hH](?:ou|on|ei)/.test(e)&&!/^[aeiouAEIOU][a-z]/.test(e)||/^us/i.test(e)?"a ":"an ")+e}function buildNamespace(e,t){t&&(""!==t.name&&(push(""),push(!e&&config.es6?"export const "+name(t.name)+" = "+name(e)+"."+name(t.name)+" = (() => {":name(e)+"."+name(t.name)+" = (function() {"),++indent),t instanceof Type?buildType(void 0,t):t instanceof Service?buildService(void 0,t):""!==t.name&&(push(""),pushComment([t.comment||"Namespace "+t.name+".","@exports "+t.fullName.substring(1),"@namespace"]),push((config.es6?"const":"var")+" "+name(t.name)+" = {};")),t.nestedArray.forEach(function(e){e instanceof Enum?buildEnum(t.name,e):e instanceof Namespace&&buildNamespace(t.name,e)}),""!==t.name&&(push(""),push("return "+name(t.name)+";"),--indent,push("})();")))}function beautifyCode(e){e=UglifyJS.minify(e,{fromString:!0,compress:!1,mangle:!1,output:{beautify:!0}}).code;var t=espree.parse(e);return estraverse.replace(t,{enter:function(e,t){if("Identifier"===e.type&&(t.property!==e||t.computed)&&shortVars[e.name])return{type:"Identifier",name:shortVars[e.name]};{if(!config.es6||"VariableDeclaration"!==e.type||"var"!==e.kind)return"BlockStatement"===e.type&&reduceableBlockStatements[t.type]&&1===e.body.length?e.body[0]:void 0;e.kind="let"}}}),e=escodegen.generate(t,{format:{newline:"\n",quotes:"double"}}),config.comments&&(e=e.replace(/\.uint32\((\d+)\)/g,function(e,t){return".uint32(/* id "+(t>>>3)+", wireType "+(7&t)+" =*/"+t+")"})),e}function buildFunction(e,t,n,r){var o=n.str(t).replace(/((?!\.)types\[\d+])(\.values)/g,"$1"),s=espree.parse(o);estraverse.replace(s,{enter:function(t,n){return"Identifier"===t.type&&renameVars[t.name]&&("MemberExpression"===n.type&&n.object===t||"BinaryExpression"===n.type&&n.right===t)?{type:"Identifier",name:renameVars[t.name]}:"MemberExpression"===t.type&&"ThisExpression"===t.object.type&&"Identifier"===t.property.type&&"ctor"===t.property.name?{type:"Identifier",name:"$root"+e.fullName}:"MemberExpression"===t.type&&"Identifier"===t.object.type&&"types"===t.object.name&&"Literal"===t.property.type?{type:"Identifier",name:"$root"+e.fieldsArray[t.property.value].resolvedType.fullName}:void 0}}),o=escodegen.generate(s,{format:{newline:"\n",quotes:"double"}}),config.beautify&&(o=beautifyCode(o)),o=o.replace(/ {4}/g,"\t");var a=r&&Object.keys(r).length,i=t===e.name;a&&Object.keys(r).forEach(function(e){new RegExp("\\b("+e+")\\b","g").test(o)||delete r[e]});var u=o.split(/\n/g);push(i?u[0]:a?name(e.name)+"."+t+" = (function("+Object.keys(r).join(", ")+") { return "+u[0]:name(e.name)+"."+t+" = "+u[0]),u.slice(1,u.length-1).forEach(function(e){for(var t=indent,n=0;"\t"===e.charAt(n++);)++indent;push(e.trim()),indent=t}),push(i?"}":a?"};})("+Object.keys(r).map(function(e){return r[e]}).join(", ")+");":"};")}function toJsType(e){var t;switch(e.type){case"double":case"float":case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":t="number";break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":t=config.forceLong?"Long":"number|Long";break;case"bool":t="boolean";break;case"string":t="string";break;case"bytes":t="Uint8Array";break;default:t=e.resolve().resolvedType instanceof Enum?e.resolvedType.fullName.substring(1):e.resolvedType instanceof Type?e.resolvedType.fullName.substring(1)+(config.forceMessage?"":"$Properties"):"*"}return e.map?"Object.<string,"+t+">":e.repeated?"Array.<"+t+">":t}function buildType(e,t){var n=t.fullName.substring(1);if(config.comments){var r=["Properties of "+aOrAn(t.name)+".","@typedef "+n+"$Properties","@type {Object}"];t.fieldsArray.forEach(function(e){var n=util.safeProp(e.name);n=n.substring(1,"["===n.charAt(0)?n.length-1:n.length),r.push("@property {"+toJsType(e)+"} "+(e.optional?"["+n+"]":e.name)+" "+(e.comment||t.name+" "+e.name+"."))}),push(""),pushComment(r)}push(""),pushComment(["Constructs a new "+t.name+".",t.comment?"@classdesc "+t.comment:null,"@exports "+n,"@constructor","@param {"+n+"$Properties=} ["+(config.beautify?"properties":"p")+"] Properties to set"]),buildFunction(t,t.name,Class.generate(t));var o=!0;t.fieldsArray.forEach(function(e){e.resolve();var n=util.safeProp(e.name);if(config.comments){push("");var r=toJsType(e);e.optional&&!e.map&&!e.repeated&&e.resolvedType instanceof Type&&(r="("+r+"|null)"),pushComment([e.comment||t.name+" "+e.name+".","@type {"+r+"}"])}else o&&(push(""),o=!1);push(e.repeated?name(t.name)+".prototype"+n+" = $util.emptyArray;":e.map?name(t.name)+".prototype"+n+" = $util.emptyObject;":e.long?name(t.name)+".prototype"+n+" = $util.Long ? $util.Long.fromBits("+JSON.stringify(e.typeDefault.low)+","+JSON.stringify(e.typeDefault.high)+","+JSON.stringify(e.typeDefault.unsigned)+") : "+e.typeDefault.toNumber("u"===e.type.charAt(0))+";":e.bytes?name(t.name)+".prototype"+n+" = $util.newBuffer("+JSON.stringify(Array.prototype.slice.call(e.typeDefault))+");":name(t.name)+".prototype"+n+" = "+JSON.stringify(e.typeDefault)+";")});var s=!0;t.oneofsArray.forEach(function(e){s&&(s=!1,push(""),config.comments&&push("// OneOf field names bound to virtual getters and setters"),push((config.es6?"let":"var")+" $oneOfFields;")),e.resolve(),push(""),pushComment([e.comment||t.name+" "+e.name+".","@name "+n+"#"+name(e.name),"@type {string|undefined}"]),push("Object.defineProperty("+name(t.name)+".prototype, "+JSON.stringify(e.name)+", {"),++indent,push("get: $util.oneOfGetter($oneOfFields = ["+e.oneof.map(JSON.stringify).join(", ")+"]),"),push("set: $util.oneOfSetter($oneOfFields)"),--indent,push("});")}),config.create&&(push(""),pushComment(["Creates a new "+t.name+" instance using the specified properties.","@param {"+n+"$Properties=} [properties] Properties to set","@returns {"+n+"} "+t.name+" instance"]),push(name(t.name)+".create = function create(properties) {"),++indent,push("return new "+name(t.name)+"(properties);"),--indent,push("};")),config.encode&&(push(""),pushComment(["Encodes the specified "+t.name+" message. Does not implicitly {@link "+n+".verify|verify} messages.","@param {"+n+(config.forceMessage?"":"$Properties")+"} "+(config.beautify?"message":"m")+" "+t.name+" message or plain object to encode","@param {$protobuf.Writer} ["+(config.beautify?"writer":"w")+"] Writer to encode to","@returns {$protobuf.Writer} Writer"]),buildFunction(t,"encode",protobuf.encoder(t)),config.delimited&&(push(""),pushComment(["Encodes the specified "+t.name+" message, length delimited. Does not implicitly {@link "+n+".verify|verify} messages.","@param {"+n+(config.forceMessage?"":"$Properties")+"} message "+t.name+" message or plain object to encode","@param {$protobuf.Writer} [writer] Writer to encode to","@returns {$protobuf.Writer} Writer"]),push(name(t.name)+".encodeDelimited = function encodeDelimited(message, writer) {"),++indent,push("return this.encode(message, writer).ldelim();"),--indent,push("};"))),config.decode&&(push(""),pushComment(["Decodes "+aOrAn(t.name)+" message from the specified reader or buffer.","@param {$protobuf.Reader|Uint8Array} "+(config.beautify?"reader":"r")+" Reader or buffer to decode from","@param {number} ["+(config.beautify?"length":"l")+"] Message length if known beforehand","@returns {"+n+"} "+t.name,"@throws {Error} If the payload is not a reader or valid buffer","@throws {$protobuf.util.ProtocolError} If required fields are missing"]),buildFunction(t,"decode",protobuf.decoder(t)),config.delimited&&(push(""),pushComment(["Decodes "+aOrAn(t.name)+" message from the specified reader or buffer, length delimited.","@param {$protobuf.Reader|Uint8Array} reader Reader or buffer to decode from","@returns {"+n+"} "+t.name,"@throws {Error} If the payload is not a reader or valid buffer","@throws {$protobuf.util.ProtocolError} If required fields are missing"]),push(name(t.name)+".decodeDelimited = function decodeDelimited(reader) {"),++indent,push("if (!(reader instanceof $Reader))"),++indent,push("reader = $Reader(reader);"),--indent,push("return this.decode(reader, reader.uint32());"),--indent,push("};"))),config.verify&&(push(""),pushComment(["Verifies "+aOrAn(t.name)+" message.","@param {Object.<string,*>} "+(config.beautify?"message":"m")+" Plain object to verify","@returns {?string} `null` if valid, otherwise the reason why it is not"]),buildFunction(t,"verify",protobuf.verifier(t))),config.convert&&(push(""),pushComment(["Creates "+aOrAn(t.name)+" message from a plain object. Also converts values to their respective internal types.","@param {Object.<string,*>} "+(config.beautify?"object":"d")+" Plain object","@returns {"+n+"} "+t.name]),buildFunction(t,"fromObject",protobuf.converter.fromObject(t)),push(""),pushComment(["Creates a plain object from "+aOrAn(t.name)+" message. Also converts values to other types if specified.","@param {"+n+"} "+(config.beautify?"message":"m")+" "+t.name,"@param {$protobuf.ConversionOptions} ["+(config.beautify?"options":"o")+"] Conversion options","@returns {Object.<string,*>} Plain object"]),buildFunction(t,"toObject",protobuf.converter.toObject(t)),push(""),pushComment(["Creates a plain object from this "+t.name+" message. Also converts values to other types if specified.","@param {$protobuf.ConversionOptions} [options] Conversion options","@returns {Object.<string,*>} Plain object"]),push(name(t.name)+".prototype.toObject = function toObject(options) {"),++indent,push("return this.constructor.toObject(this, options);"),--indent,push("};"),push(""),pushComment(["Converts this "+t.name+" to JSON.","@returns {Object.<string,*>} JSON object"]),push(name(t.name)+".prototype.toJSON = function toJSON() {"),++indent,push("return this.constructor.toObject(this, $protobuf.util.toJSONOptions);"),--indent,push("};"))}function buildService(e,t){var n=t.fullName.substring(1);push(""),pushComment(["Constructs a new "+t.name+" service.",t.comment?"@classdesc "+t.comment:null,"@exports "+n,"@extends $protobuf.rpc.Service","@constructor","@param {$protobuf.RPCImpl} rpcImpl RPC implementation","@param {boolean} [requestDelimited=false] Whether requests are length-delimited","@param {boolean} [responseDelimited=false] Whether responses are length-delimited"]),push("function "+name(t.name)+"(rpcImpl, requestDelimited, responseDelimited) {"),++indent,push("$protobuf.rpc.Service.call(this, rpcImpl, requestDelimited, responseDelimited);"),--indent,push("}"),push(""),push("("+name(t.name)+".prototype = Object.create($protobuf.rpc.Service.prototype)).constructor = "+name(t.name)+";"),config.create&&(push(""),pushComment(["Creates new "+t.name+" service using the specified rpc implementation.","@param {$protobuf.RPCImpl} rpcImpl RPC implementation","@param {boolean} [requestDelimited=false] Whether requests are length-delimited","@param {boolean} [responseDelimited=false] Whether responses are length-delimited","@returns {"+name(t.name)+"} RPC service. Useful where requests and/or responses are streamed."]),push(name(t.name)+".create = function create(rpcImpl, requestDelimited, responseDelimited) {"),++indent,push("return new this(rpcImpl, requestDelimited, responseDelimited);"),--indent,push("};")),t.methodsArray.forEach(function(e){e.resolve();var n=e.name.substring(0,1).toLowerCase()+e.name.substring(1);push("");var r=name(t.name)+"_"+name(n)+"_Callback";pushComment(["Callback as used by {@link "+name(t.name)+"#"+name(n)+"}.","@typedef "+r,"@type {function}","@param {?Error} error Error, if any","@param {"+e.resolvedResponseType.fullName.substring(1)+"} [response] "+e.resolvedResponseType.name]),push(""),pushComment([e.comment||"Calls "+e.name+".","@param {"+e.resolvedRequestType.fullName.substring(1)+"|Object.<string,*>} request "+e.resolvedRequestType.name+" message or plain object","@param {"+r+"} callback Node-style callback called with the error, if any, and "+e.resolvedResponseType.name,"@returns {undefined}"]),push(name(t.name)+".prototype"+util.safeProp(n)+" = function "+name(n)+"(request, callback) {"),++indent,push("return this.rpcCall("+name(n)+", $root"+e.resolvedRequestType.fullName+", $root"+e.resolvedResponseType.fullName+", request, callback);"),--indent,push("};"),config.comments&&push(""),pushComment([e.comment||"Calls "+e.name+".","@name "+name(t.name)+"#"+n,"@function","@param {"+e.resolvedRequestType.fullName.substring(1)+"|Object.<string,*>} request "+e.resolvedRequestType.name+" message or plain object","@returns {Promise<"+e.resolvedResponseType.fullName.substring(1)+">} Promise","@variation 2"])})}function buildEnum(e,t){var n=t.parent.fullName.substring(1);push("");var r=[t.comment||t.name+" enum."];n.length?r.push("@name "+name(t.name),"@memberof "+n,"@enum {number}"):r.push("@exports "+name(t.name),"@enum {number}"),Object.keys(t.values).forEach(function(e){var n=t.values[e];r.push("@property {number} "+e+"="+n+" "+(t.comments[e]||e+" value"))}),pushComment(r),push(name(e)+"."+name(t.name)+" = (function() {"),++indent,push((config.es6?"const":"var")+" valuesById = {}, values = Object.create(valuesById);");var o=[];Object.keys(t.values).forEach(function(e){var n=t.values[e];o.indexOf(n)>-1?push("values["+JSON.stringify(e)+"] = "+n+";"):(push("values[valuesById["+n+"] = "+JSON.stringify(e)+"] = "+n+";"),o.push(n))}),push("return values;"),--indent,push("})();")}module.exports=static_target;var protobuf=require("../.."),cliUtil=require("../util"),UglifyJS=require("uglify-js"),espree=require("espree"),escodegen=require("escodegen"),estraverse=require("estraverse"),Type=protobuf.Type,Service=protobuf.Service,Enum=protobuf.Enum,Namespace=protobuf.Namespace,Class=protobuf.Class,util=protobuf.util,out=[],indent=0,config={};static_target.description="Static code without reflection (non-functional on its own)";var reduceableBlockStatements={IfStatement:!0,ForStatement:!0,WhileStatement:!0},shortVars={r:"reader",w:"writer",m:"message",t:"tag",l:"length",c:"end",c2:"end2",k:"key",ks:"keys",ks2:"keys2",e:"error",f:"impl",o:"options",d:"object",n:"long",p:"properties"},renameVars={Writer:"$Writer",Reader:"$Reader",util:"$util"};