!function(e,a,t){var i=(t.un,t.uns,t.static,t.class),n=t.getset,s=(t.__newvec,t.AppConfig),o=laya.utils.Browser,l=common.CommonModule,r=common.event.EventCenter,m=rb.framework.mvc.GameContext,h=modules.game.context.GameMainContext,u=modules.game.GameModule,d=hall.HallModule,c=modules.game.majiangGame.view.animation.HuAnimation,g=modules.game.majiangGame.context.MajiangGameContext,C=modules.game.majiangGame.controller.MajiangGameController,p=modules.game.majiangGame.view.MajiangGameView,f=modules.game.majiangGame.model.MajiangModel,G=(rb.framework.mvc.Module,t.QuickUtils),M=hall.view.RecordView,_=(modules.game.majiangGame.model.ReplayMajiangModel,rb.framework.errors.SingletonError),j=t.UserData,w=t.WX,V=(function(e){function a(){if(a.__super.call(this),null!=a._instance)throw new _(this);a._instance=this}i(a,"modules.xiangshanGame.XiangSGameModule",e);var t=a.prototype;return t.startup=function(){o.window.document.title=s.nameTitle+"象山麻将("+s.costRule[j.roomtype+""][j.Rule[3]]+")",null==this._mainContext&&(this._mainContext=new m("GameMainmain",this),this._main=new h("GameMain",this,this._mainContext),this._majiangGameContext=new R("MajiangGame",this,this._main)),this.switchState(this._mainContext)},t.startGame=function(){1!=a.inGame&&(d.instance.goEmpty(),a.inGame=!0,l.instance.gotoCommonContext(),this.switchState(this.gameContext),this.inGameResize(),0==s.isNewHall?(M.gameName="象山麻将",w.onMenuShareTimeline(j.nickname+"-"+s.nameTitle+"象山麻将("+s.costRule[j.roomtype+""][j.Rule[3]]+")【房间号："+j.roomid+"】",j.roomid+"-"+j.uniqueCode+"-1"),w.onMenuShareAppMessage(j.nickname+"-"+s.nameTitle+"象山麻将("+s.costRule[j.roomtype+""][j.Rule[3]]+")【房间号："+j.roomid+"】","房主创建了西周麻将 【房间号:"+j.roomid+"】"+s.getRule(j.Rule[1]).desc+"局",j.roomid+"-"+j.uniqueCode+"-1")):(w.onMenuShareTimeline(j.nickname+"-"+s.nameTitle+"象山麻将("+s.costRule[j.roomtype+""][j.Rule[3]]+")【房间号："+j.roomid+"】",j.roomid+"--"+j.uniqueCode),w.onMenuShareAppMessage(j.nickname+"-"+s.nameTitle+"象山麻将("+s.costRule[j.roomtype+""][j.Rule[3]]+")【房间号："+j.roomid+"】","房主创建了西周麻将 【房间号:"+j.roomid+"】"+s.getRule(j.Rule[1]).desc+"局",j.roomid+"--"+j.uniqueCode)),console.log("startMajiangGame..........."))},t.stopGame=function(e,t){void 0===e&&(e=!0),void 0===t&&(t=!1),t&&this._majiangGameContext.controller.clear(),a.inGame=!1,u.isSettlement=!1,this.switchState(this._mainContext),e&&(s.isNewHall?G.gotoHall():(this.inHallResize(),d.instance.gotoHall())),c.instance.noticeHide()},n(1,a,"instance",function(){return null==a._instance&&(a._instance=new a),a._instance},modules.game.GameModule._$SET_instance),a.inGame=!1,a._instance=null,a}(u),function(e){function a(){a.__super.call(this)}i(a,"modules.xiangshanGame.majiangGame.controller.XiangSMJGameController",e);var n=a.prototype;return n.ACK_TransferHuaResponse=function(e){this.actived&&(this.pauseGameQueue(),0==j.isReplay?t.timer.once(500,this,this.realHuanhua,[e]):this.realHuanhua(e))},n.clearTimeDelay=function(){e.prototype.clearTimeDelay.call(this),t.timer.clear(this,this.realHuanhua)},n.realHuanhua=function(e){j.isReplay&&(void 0==e.index&&(e.index=0),e.huas=e.hua_list,e.cards=e.card_ids),this.model.majiangMsgs.ACK_TransferHuaResponse=e,e.count=e.huas.length,e.pos=e.index,console.log("ACK_TransferHuaResponse"),console.log(e),console.log("ACK_TransferHuaResponse");var a=0,t=e.huas.length;for(e.Huas=[],a=0;t>a;a++)e.Huas[a]=e.huas[a]+1;for(t=e.cards.length,e.Cards=[],a=0;t>a;a++)e.Cards[a]=e.cards[a]+1;for(this.model.updateBuhua(e.pos,e.Huas,e.Cards),t=this.model.huaVec[e.pos].length,this.model.overHuaVec[e.pos]=t,a=0;t>a;a++)this.view.majiangPage.showBuhua(this.model.huaVec[e.pos][a],e.pos,!0);this.view.playerInfoPage.updateHua(e.pos),e.pos==this.model.selfChairPos&&0==j.isReplay&&this.view.majiangPage.handPart.updateOnePosAllCards(e.pos,this.model.allCardsVec[e.pos]),j.isReplay&&this.view.majiangPage.handPart.updateOnePosAllCards(e.pos,this.model.allCardsVec[e.pos]),this.model.leftDesktopCardsNum-=e.count,this.view.majiangPage.clockPart.noticeShowLeftCardsNum(),r.instance.once("GAME_BUHUAN_COMPLETE",this,this.contineGameQueue)},n.seatPingBi=function(e,a){if(1==a.Cards[e].type){var t=this.model.getChiCards(e,a.Cards[e].lastCardId+1);this.view.majiangPage.handPart.canControl(e,!0,this.model.getChiRefCards(t))}else this.view.majiangPage.handPart.canControl(e,!0,[a.Cards[e].lastCardId+1])},n.pingbiChi=function(e){this.view.majiangPage.handPart.canControl(e.pos,!0,this.model.getChiRefCards(e.chicards))},a}(C)),v=function(e){function a(){a.__super.call(this)}i(a,"modules.xiangshanGame.majiangGame.model.XiangSMJModel",e);var t=a.prototype;return t.getChiRefCards=function(e){var a=[];return e.sort(this.compareFunction),e[1]-e[0]==1?a=1==e[0]||10==e[0]||19==e[0]?[e[1]+1]:9==e[1]||18==e[1]||27==e[1]?[e[0]-1]:[e[0]-1,e[1]+1]:e[1]-e[0]==2&&(a=[e[0]+1]),a},a}(f),y=function(e){function a(){a.__super.call(this)}return i(a,"modules.xiangshanGame.majiangGame.controller.ReplayXiangSMJGameController",e),a}(V),x=function(e){function a(){this.isShowOtherCards=!0,a.__super.call(this)}i(a,"modules.xiangshanGame.majiangGame.model.ReplayXiangSMJModel",e);var t=a.prototype;return t.saveStepData=function(){modules.game.majiangGame.model.MajiangModel.prototype.saveStepData.call(this)},t.reset=function(){modules.game.majiangGame.model.MajiangModel.prototype.reset.call(this),this.isStrictShowCalc=!1},t.replayReset=function(){modules.game.majiangGame.model.MajiangModel.prototype.reset.call(this)},t.cutPengCard=function(e,a){if(this.isShowOtherCards){var t=[a,a],i=0,n=t.length,s=0;for(i=0;n>i;i++)s=this.allCardsVec[e].indexOf(t[i]),-1!=s&&this.allCardsVec[e].splice(s,1)}else modules.game.majiangGame.model.MajiangModel.prototype.cutPengCard.call(this,e,a)},t.cutGangCard=function(e,a,t){if(this.isShowOtherCards){var i,n=0,s=0,o=0;switch(1==this.isTingVec[e]&&this.kouVec[e].length>0&&0!=t&&(this.kouVec[e].length-=1),t){case 0:-1!=this.theFourteenCardVec[e]?this.theFourteenCardVec[e]==a?this.theFourteenCardVec[e]=-1:(s=this.allCardsVec[e].indexOf(a),-1!=s&&this.allCardsVec[e].splice(s,1),this.allCardsVec[e].push(this.theFourteenCardVec[e]),this.theFourteenCardVec[e]=-1,this.sortAllCards(e)):(s=this.allCardsVec[e].indexOf(a),-1!=s&&this.allCardsVec[e].splice(s,1),this.sortAllCards(e));break;case 1:for(this.theFourteenCardVec[e]==a?(this.theFourteenCardVec[e]=-1,i=[a,a,a]):(i=[a,a,a,a],this.allCardsVec[e].push(this.theFourteenCardVec[e]),this.theFourteenCardVec[e]=-1,this.sortAllCards(e)),o=i.length,n=0;o>n;n++)s=this.allCardsVec[e].indexOf(i[n]),-1!=s&&this.allCardsVec[e].splice(s,1);break;case 2:for(i=[a,a,a],o=i.length,n=0;o>n;n++)s=this.allCardsVec[e].indexOf(i[n]),-1!=s&&this.allCardsVec[e].splice(s,1)}}else modules.game.majiangGame.model.MajiangModel.prototype.cutGangCard.call(this,e,a,t)},t.outputCard=function(e,a){if(this.curOutPutPos=e,this.isShowOtherCards){if(this.outputCardsVec[e].push(a),-1!=this.theFourteenCardVec[e]&&this.theFourteenCardVec[e]==a)return this.theFourteenCardVec[e]=-1,void 0;var t=this.allCardsVec[e].indexOf(a);-1!=t&&this.allCardsVec[e].splice(t,1),-1!=this.theFourteenCardVec[e]&&(this.allCardsVec[e].push(this.theFourteenCardVec[e]),this.sortAllCards(e),this.theFourteenCardVec[e]=-1)}else modules.game.majiangGame.model.MajiangModel.prototype.outputCard.call(this,e,a)},t.updateAllCardsVecByGameStart=function(e){var a=0,t=e.length;for(a=0;t>a;a++){var i=this.getPlayerPosByUid(e[a].uid);this.updateOneAllCardsVecByGameStart(e[a].nusercard,i)}},t.updateOneAllCardsVecByGameStart=function(e,a){var t=0;this.allCardsVec[a]=[];var i=e.length;for(t=0;i>t;t++)this.allCardsVec[a].push(e[t].card);this.sortAllCards(a)},a}(v),R=function(e){function a(e,t,i){void 0===e&&(e=""),a.__super.call(this,e,t,i)}i(a,"modules.xiangshanGame.majiangGame.context.XiangSMJGameContext",e);var t=a.prototype;return t.initUI=function(){null==this._majiangModel&&(this._majiangModel=new v),null==this._rMajiangModel&&(this._rMajiangModel=new x),null==this._rMajiangGameController&&(this._rMajiangGameController=new y),null==this._majiangGameView&&(this._majiangGameView=new p),null==this._majiangGameController&&(this._majiangGameController=new V)},a}(g)}(window,document,Laya),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function(e,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});for(var t in Laya){var i=Laya[t];i&&i.__isclass&&(a[t]=i)}});