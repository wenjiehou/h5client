!function(i,t,e){var s=(e.un,e.uns,e.static),n=e.class,a=e.getset,o=e.__newvec,h=rb.framework.mvc.AbstractLayer,r=laya.display.Animation,l=e.AppConfig,c=(ui.mainGame.Items.BaidapaiUI,ui.mainGame.Items.BottomHandleItemUI,ui.mainGame.majiangParts.BottomHandlePartUI,ui.mainGame.majiangParts.BottomOutputPartUI,ui.mainGame.Items.BottomPengGangItemUI,ui.mainGame.majiangParts.BottomPengGangPartUI,laya.ui.Box,laya.utils.Browser),d=(laya.ui.Button,ui.mainGame.majiangParts.Newcalculate.CalculatePerItemUI,modules.gameCommon.chat.Chat),u=(modules.gameCommon.chat.ChatPage,ui.mainGame.majiangParts.ChiSelePartUI,ui.mainGame.majiangParts.ClockPartUI,common.CommonModule),g=laya.utils.Ease,m=(laya.events.Event,common.event.EventCenter),f=rb.framework.mvc.GameContext,p=ui.mainGame.GameTableUI,_=ui.gameCommon.items.GiftItemUI,C=hall.HallModule,v=(ui.mainGame.majiangParts.HandleBtnsPartUI,ui.mainGame.Items.HandleEffItemUI,ui.mainGame.majiangParts.HandleEffUI,laya.utils.Handler),P=(laya.ui.Image,laya.ui.Label,rb.framework.mvc.core.LayerTypes,ui.mainGame.Items.LeftHandleItemUI,ui.mainGame.majiangParts.LeftHandlePartUI,ui.mainGame.majiangParts.LeftOutputPartUI,ui.mainGame.majiangParts.LeftPengGangPartUI,ui.mainGame.MajiangPageUI),k=(net.Message,rb.framework.mvc.Message,manager.MessageManager),y=rb.framework.mvc.Module,w=e.ModuleDef,I=laya.ani.swf.MovieClip,b=(ui.mainGame.NewCalculatePageUI,ui.mainGame.majiangParts.Newcalculate.NewCalculatePerItemUI,ui.mainGame.majiangParts.Newcalculate.NewCalculatePerPageUI,ui.mainGame.majiangParts.Newcalculate.NewCalculateRoundPageUI,modules.gameCommon.view.NewDissolvePage),V=(ui.mainGame.Items.OutputLeftItemUI,ui.mainGame.Items.OutputRightItemUI,ui.mainGame.Items.OutputTopItemUI,ui.mainGame.majiangParts.OutputTopPartUI,ui.gameCommon.PiaoSelePartUI,ui.mainGame.PlayerInfoPageUI,laya.maths.Point),T=(common.view.PopBox,net.ProtoMessage),x=e.QuickUtils,B=(laya.maths.Rectangle,modules.gameCommon.view.ReplayControlView),S=(ui.mainGame.Items.RightHandleItemUI,ui.mainGame.majiangParts.RightHandlePartUI,ui.mainGame.majiangParts.RightOutputPartUI,ui.mainGame.majiangParts.RightPengGangPartUI,ui.mainGame.majiangParts.animalEff.ShaiziEffUI,ui.mainGame.Items.ShowContrTipUI,laya.media.SoundManager),G=common.tools.SoundPlay,j=laya.display.Sprite,D=(laya.display.Stage,ui.mainGame.TableInfoPageUI,manager.TextManager),A=laya.utils.TimeLine,R=manager.TimeManager,M=(ui.mainGame.Items.TopHandleItemUI,ui.mainGame.majiangParts.TopHandlePartUI,ui.mainGame.majiangParts.TopPengGangPartUI,laya.utils.Tween),N=manager.UIManager,E=e.UserData,O=ui.gameCommon.UserInfoUI,H=(laya.ui.View,e.WX),F=(ui.mainGame.majiangParts.huaBottomPartUI,ui.mainGame.majiangParts.huaLeftPartUI,ui.mainGame.majiangParts.huaRightPartUI,ui.mainGame.majiangParts.huaTopPartUI,ui.mainGame.majiangParts.shaiziPageUI,function(){function i(){this.chicard=0,this.chicards=[]}return n(i,"modules.game.majiangGame.model.MajiangChiData"),i}()),K=function(){function i(){this.ACKBC_Into_Room=null,this.ACK_RoomInfo=null,this.ACK_Room_User=null,this.ACKBC_Start=null,this.ACK_UserCard=null,this.ACK_User_SeatCard=null,this.ACK_GetCard=null,this.ACKBC_GetCard=null,this.ACKBC_CurPlayer=null,this.ACKBC_PutCard=null,this.ACK_WaitTool=null,this.ACKBC_Chow=null,this.ACKBC_Peng=null,this.ACKBC_Kong=null,this.ACKBC_Sitdown=null,this.ACKBC_Standup=null,this.ACKBC_Ready=null,this.ACKBC_Exit_Room=null,this.NotifyStartGame=null,this.ACKBC_Win=null,this.ACKBC_Draw=null,this.ACKBC_Total=null,this.ACKBC_Card_Init=null,this.MSG_NOTIFY_SUMMARY=null,this.AckDisband=null,this.NotifyDisband=null,this.NotifyUserState=null,this.control_user_enterroom_Info=null,this.control_add_golds_Info=null,this.control_gate_Info=null,this.control_bonus_golds_Info=null,this.control_use_prop_Info=null,this.control_game_msg_Info=null,this.control_player_smile_Info=null,this.control_game_chat_Info=null,this.control_user_list_Info=null,this.control_lottery_award_Info=null,this.control_msg_Info=null,this.control_gameitem_friend_Info=null,this.control_buy_smile_Info=null,this.control_game_offline_Info=null,this.control_game_mjstart_Info=null,this.control_game_mjopration_Info=null,this.control_game_mjcard_Info=null,this.control_game_operation_peng_Info=null,this.control_game_operation_gang_Info=null,this.control_game_operation_pop_Info=null,this.control_game_operation_ting_Info=null,this.control_game_operation_qianggang_Info=null,this.control_game_operation_hu_Info=null,this.control_game_operation_tableinfo_Info=null,this.control_game_operation_userinfo_Info=null,this.control_game_operation_ready_Info=null,this.control_game_settlement_Info=null,this.control_game_mj_msg_Info=null,this.control_game_operation_mopai_info=null,this.control_game_operation_jieshan_info=null,this.control_game_operation_koupai_info=null,this.control_game_operation_hucard_info=null,this.control_game_operation_kill_info=null,this.control_game_operation_exitroom_info=null,this.control_game_operation_chi_info=null,this.ACK_TransferHuaResponse=null,this.control_game_mjmagic_info=null}return n(i,"modules.game.majiangGame.model.MajiangMsgs"),i}(),L=function(){function i(i){this._skin=null,this._huPengCards=null,this._huHandleCards=null,this.headImg=null,this.headw=0,this.headh=0,this._items=o(4,null),this._cardItems=o(3,null),this._skin=i;var t=0,e=this._items.length;for(t=0;e>t;t++)this._items[t]=new W(this._skin["player"+t]);for(e=this._cardItems.length,t=0;e>t;t++)this._cardItems[t]=new z(this._skin["item"+t]);this._skin.hideBtn.on("click",this,this.onClickHideBtn),this._skin.readyBtn.on("click",this,this.onClickReadyBtn),this._skin.confirmBtn.on("click",this,this.onClickConfirmBtn),this._skin.closeBtn.on("click",this,this.onClickCloseBtn),this.headImg=this._skin.headImg,this.headw=this.headImg.width,this.headh=this.headImg.height,this._huPengCards=new Xt(this._skin.pengGangCards),this._huHandleCards=new Ft(this._skin.handCards,!1),this.reset()}n(i,"modules.game.majiangGame.view.calculate.CalculatePerPart");var t=i.prototype;return t.getPiaoSelePart=function(){return null},t.onClickHideBtn=function(){this._skin.visible=!1,this.view.calculatePage.showPerShowBtn()},t.onClickReadyBtn=function(){var i={sid:E.SID};wt.instance.gameContext.controller.sendMsgCommond(T.getProtoMessage(210,i)),this.hide()},t.onClickConfirmBtn=function(){console.log("点击了确定按钮，要跳到总的结算界面啦"),this.view.calculatePage.reset(),x.popMessageBox("房间已结束！","BTN_ENDGAME",this,this.onConfirmEnd)},t.onConfirmEnd=function(i){0==i?l.isNewHall?x.gotoHall(1):(wt.instance.gameContext.controller.endGameGotoHall(),e.timer.callLater(this,this.gotoReport)):l.isNewHall?x.gotoHall():wt.instance.gameContext.controller.endGameGotoHall()},t.gotoReport=function(){C.instance.hallContext.hallView.hallLayer.onRecord({uniqueCode:E.uniqueCode})},t.onClickCloseBtn=function(){this.hide()},t.timeOver=function(){this._skin.visible=!0,this._skin.readyBtn.visible=!1,this._skin.confirmBtn.visible=!1,this._skin.readyImg.visible=!1,this._skin.closeBtn.visible=!1,this._skin.confirmBtn.visible=this.model.isSelfSitDown?!0:!0},t.hideReadyBtn=function(){},t.updateBtns=function(){if(this._skin.hideBtn.alpha=E.isReplay?0:1,0==this.isShow||E.isReplay)return this._skin.readyImg.visible=!1,this._skin.readyBtn.visible=!1,this._skin.confirmBtn.visible=!1,void 0;if(this._skin.readyBtn.visible=!1,this._skin.confirmBtn.visible=!1,this._skin.readyImg.visible=!1,this._skin.closeBtn.visible=!1,this.model.isSelfSitDown){if(void 0==this.model.majiangMsgs.ACKBC_Total.finished&&(this.model.majiangMsgs.ACKBC_Total.finished=!1),1==this.model.majiangMsgs.ACKBC_Total.finished)this._skin.confirmBtn.visible=!0,l.autoPlay&&this.onClickConfirmBtn(null);else if(this._skin.readyBtn.visible=!0,this._skin.readyImg.visible=!0,l.autoPlay){var i=this.model.majiangMsgs.ACKBC_Total;i.Reward[0].score+i.Reward[1].score+i.Reward[2].score+i.Reward[3].score==0&&this.onClickReadyBtn(null)}}else 1==this.model.majiangMsgs.ACKBC_Total.finished?this._skin.confirmBtn.visible=!0:this._skin.closeBtn.visible=!0},t.show=function(){this._skin.visible=!0,this.updateBtns();var i=0;if(this._huPengCards.reset(),this._huHandleCards.reset(),this.model.isLiu)for(this._skin.onePlayerBox.visible=!1,this._skin.playersBox.visible=!1,this._skin.liujuImg.visible=!0,this._skin.headImg.visible=!1,this._skin.paixingTf.visible=!1,this._skin.taishuTf.visible=!1,i=0;i<this._items.length;i++)this._items[i].update(i,!0);else{this._skin.liujuImg.visible=!1,this._skin.headImg.visible=!0,this._skin.paixingTf.visible=!0,this._skin.taishuTf.visible=!0;var t=this.model.majiangMsgs.ACKBC_Total,e=this.model.majiangMsgs.ACKBC_Win,s=this.model.playerByPos(t.WinSeat);if(1==e.Seat.length){if(this._skin.onePlayerBox.visible=!0,this._skin.playersBox.visible=!1,""!=s.Icon){var n=new j;n.loadImage(s.Icon,0,0,this.headw,this.headh),n.mouseEnabled=!0,this.headImg.addChild(n)}this.updateCars(t.WinSeat),this._skin.paixingTf.text=t.Msg&&t.Msg[t.WinSeat]?t.Msg[t.WinSeat]:"",this._skin.taishuTf.text=t.Tai&&t.Tai[t.WinSeat]?"（合计："+t.Tai[t.WinSeat]+"台）":""}else{for(this._skin.onePlayerBox.visible=!1,this._skin.playersBox.visible=!0,i=0;i<this._cardItems.length;i++)this._cardItems[i].reset();var a=e.Seat,o=0;for(i=0;i<a.length-1;i++)for(var h=0;h<a.length-1-i;h++)this.model.getRefZhuangPos(a[h])>this.model.getRefZhuangPos(a[h+1])&&(o=a[h+1],a[h+1]=a[h],a[h]=o);for(i=0;i<e.Seat.length;i++)this._cardItems[i].update(e.Seat[i])}var r;for(i=0;i<this._items.length;i++)r=this.model.playerByPos(i),r.isHu=!1,r.isDianPao=!1,E.isReplay&&(t.Reward[i].total_score=void 0!=t.Reward[i].total_score?t.Reward[i].total_score:0,t.Reward[i].totalScore=t.Reward[i].total_score),r.zongchengji=void 0!=t.Reward[i].score?t.Reward[i].score:0,1==E.Rule[4]&&(r.Coin=void 0!=t.Reward[i].totalScore?t.Reward[i].totalScore:0),r.score=void 0!=t.Reward[i].totalScore?t.Reward[i].totalScore:0,-1!=e.Seat.indexOf(i)?r.isHu=!0:i==e.TSeat&&(r.isDianPao=!0),this._items[this.model.getRefZhuangPos(i)].update(i);this.view.playerInfoPage.updatePlayerInfos(this.model.playerInfoVec,!1)}},t.updateCars=function(i){var t=this.model.majiangMsgs.ACKBC_Total;if(t.attached)var e=JSON.parse(t.attached);var s=0,n=0,a=0;for(a=this.model.anGangVec[i]?this.model.anGangVec[i].length:0,n=0;a>n;n++){var o=(this.model.chairNum+this.model.anGangFromVec[i][n]-i)%this.model.chairNum;this._huPengCards.gang(this.model.anGangVec[i][n],1,o,this.model.anGangFromVec[i][n],i)}for(s+=a,a=this.model.mingGangVec[i]?this.model.mingGangVec[i].length:0,n=0;a>n;n++){var h=(this.model.chairNum+this.model.mingGangFromVec[i][n]-i)%this.model.chairNum;this._huPengCards.gang(this.model.mingGangVec[i][n],2,h,this.model.mingGangFromVec[i][n],i),e&&i==e.index&&parseInt(e.cid)+1==this.model.mingGangVec[i][n]&&this._huPengCards.setChengbaoGang(this.model.mingGangVec[i][n])}for(s+=a,a=this.model.chiVec[i]?this.model.chiVec[i].length:0,n=0;a>n;n++)this._huPengCards.chi(this.model.chiVec[i][n],this.model.chiFromVec[i][n],i);for(s+=a,a=this.model.pengVec[i]?this.model.pengVec[i].length:0,n=0;a>n;n++){var o=(this.model.chairNum+this.model.pengFromVec[i][n]-i)%this.model.chairNum;this._huPengCards.peng(this.model.pengVec[i][n],o,this.model.pengFromVec[i][n],i)}s+=a,this._skin.handCards.x=this._skin.pengGangCards.x+20*s,this._huHandleCards.setPreThirteenCards(this.model.allCardsVec[i],this.model.getChairDirByPos(i),!1,!1),this._huHandleCards.setTheFourteenCard(this.model.majiangMsgs.ACKBC_Total.WinCard+1,this.model.getChairDirByPos(i)),this._huHandleCards.canControl=!1},t.delayPhoto=function(i,t){var e=new j;e.loadImage(t.Icon,0,0,this.headw,this.headh),e.mouseEnabled=!0,this.headImg.addChild(e)},t.reset=function(){var i=0,t=this._items.length;for(i=0;t>i;i++)this._items[i].reset();for(i=0;i<this._cardItems.length;i++)this._cardItems[i].reset();this._skin.visible=!1},t.hide=function(){this._skin.visible=!1},a(0,t,"isShow",function(){return this._skin.visible}),a(0,t,"model",function(){return wt.instance.gameContext.model}),a(0,t,"view",function(){return wt.instance.gameContext.view}),i}(),U=function(){function i(i){this._skin=null,this._items=o(4,null),this._skin=i,this.reset()}n(i,"modules.game.majiangGame.view.calculate.CalculateRoundPart");var t=i.prototype;return t.onClickShareBtn=function(){},t.onClickBackBtn=function(){l.isNewHall?x.gotoHall():wt.instance.gameContext.controller.endGameGotoHall()},t.show=function(){},t.showGetTicketNum=function(){},t.hide=function(){this._skin.visible=!1},t.reset=function(){this._skin.visible=!1},a(0,t,"model",function(){return wt.instance.gameContext.model}),a(0,t,"view",function(){return wt.instance.gameContext.view}),i}(),z=function(){function i(i){this.headImg=null,this.headw=0,this.headh=0,this._skin=null,this._huPengCards=null,this._huHandleCards=null,this._skin=i,this._huPengCards=new Xt(this._skin.pengGangCards),this._huHandleCards=new Ft(this._skin.handCards,!1),this.headImg=this._skin.headImg,this.headw=this.headImg.width,this.headh=this.headImg.height}n(i,"modules.game.majiangGame.view.calculate.item.CalculatePerCardItem");var t=i.prototype;return t.update=function(i){var t=this.model.majiangMsgs.ACKBC_Total,e=this.model.playerByPos(i);if(""!=e.Icon){var s=new j;s.loadImage(e.Icon,0,0,this.headw,this.headh),s.mouseEnabled=!0,this.headImg.addChild(s)}this.updateCars(i),this._skin.paixingTf.text=t.Msg&&t.Msg[i]?t.Msg[i]:"",this._skin.taishuTf.text=t.Tai&&t.Tai[i]?"（合计："+t.Tai[i]+"台）":""},t.updateCars=function(i){this._skin.visible=!0;var t=this.model.majiangMsgs.ACKBC_Total;if(t.attached)var e=JSON.parse(t.attached);var s=0,n=0,a=0;for(a=this.model.anGangVec[i]?this.model.anGangVec[i].length:0,n=0;a>n;n++){var o=(this.model.chairNum+this.model.anGangFromVec[i][n]-i)%this.model.chairNum;this._huPengCards.gang(this.model.anGangVec[i][n],1,o,this.model.anGangFromVec[i][n],i)}for(s+=a,a=this.model.mingGangVec[i]?this.model.mingGangVec[i].length:0,n=0;a>n;n++){var h=(this.model.chairNum+this.model.mingGangFromVec[i][n]-i)%this.model.chairNum;this._huPengCards.gang(this.model.mingGangVec[i][n],2,h,this.model.mingGangFromVec[i][n],i),e&&i==e.index&&parseInt(e.cid)+1==this.model.mingGangVec[i][n]&&this._huPengCards.setChengbaoGang(this.model.mingGangVec[i][n])}for(s+=a,a=this.model.chiVec[i]?this.model.chiVec[i].length:0,n=0;a>n;n++)this._huPengCards.chi(this.model.chiVec[i][n],this.model.chiFromVec[i][n],i);for(s+=a,a=this.model.pengVec[i]?this.model.pengVec[i].length:0,n=0;a>n;n++){var o=(this.model.chairNum+this.model.pengFromVec[i][n]-i)%this.model.chairNum;this._huPengCards.peng(this.model.pengVec[i][n],o,this.model.pengFromVec[i][n],i)}s+=a,this._skin.handCards.x=this._skin.pengGangCards.x+20*s,this._huHandleCards.setPreThirteenCards(this.model.allCardsVec[i],this.model.getChairDirByPos(i),!1,!1),this._huHandleCards.setTheFourteenCard(this.model.majiangMsgs.ACKBC_Total.WinCard+1,this.model.getChairDirByPos(i)),this._huHandleCards.canControl=!1},t.reset=function(){this._skin.visible=!1,this._huPengCards.reset(),this._huHandleCards.reset()},a(0,t,"model",function(){return wt.instance.gameContext.model}),i}(),W=function(){function i(i){this._skin=null,this.headImg=null,this.headw=0,this.headh=0,this._skin=i,this.headImg=this._skin.headImg,this.headw=this.headImg.width,this.headh=this.headImg.height,this._skin.zongchengji.scaleX=this._skin.zongchengji.scaleY=.8}n(i,"modules.game.majiangGame.view.calculate.item.CalculatePerItem");var t=i.prototype;return t.update=function(i,t){void 0===t&&(t=!1);var e=this.model.playerByPos(i);if(null==e&&(e=this.model.playerByUid(this.model.beKickedPlayer[i])),this._skin.visible=null==e?!1:!0,""!=e.Icon){var s=new j;s.loadImage(e.Icon,0,0,this.headw,this.headh),s.mouseEnabled=!0,this.headImg.addChild(s)}return this._skin.chengbaoTf.visible=!1,this._skin.huImg.visible=!1,this._skin.dianPaoImg.visible=!1,this._skin.nicknameTf.text=e.nickname,t?(this._skin.zongchengji.text="",void 0):(e.isHu?this._skin.huImg.visible=!0:e.isDianPao&&(this._skin.dianPaoImg.visible=!0),e.zongchengji>0?(this._skin.zongchengji.font=D.NumberYellowFont,this._skin.zongchengji.text="+"+e.zongchengji):(this._skin.zongchengji.font=D.NumberBlueFont,this._skin.zongchengji.text=e.zongchengji),void 0)},t.delayPhoto=function(i,t){var e=new j;e.loadImage(t.Icon,0,0,this.headw,this.headh),e.mouseEnabled=!0,this.headImg.addChild(e)},t.reset=function(){},a(0,t,"model",function(){return wt.instance.gameContext.model}),a(0,t,"view",function(){return wt.instance.gameContext.view}),i}(),Y=function(){function i(i){this._skin=null,this._perPage=null,this._roundPage=null,this._skin=i,this._perPage=new L(this._skin.perPage),this._roundPage=new U(this._skin.roundPage),this.reset(),this._skin.showBtn.on("click",this,this.showPerCal)}n(i,"modules.game.majiangGame.view.CalculatePage");var t=i.prototype;return t.showPerShowBtn=function(){this._skin.showBtn.visible=!0},t.showPerCal=function(){this._skin.perPage.visible=!0,this._skin.showBtn.visible=!1},t.showGetTicket=function(i){this._roundPage.showGetTicketNum(i)},t.show=function(){E.isReplay&&this.view.replayControlView.moveCalculate(),this._perPage.reset(),this._roundPage.reset(),this._skin.visible=!0,this._perPage.show(),u.instance.commonContext.view.timeWarView.hide()},t.gameTimeOver=function(){this._perPage.timeOver()},t.reset=function(){this._skin.visible=!1,this._skin.showBtn.visible=!1,this._perPage.reset(),this._roundPage.reset()},a(0,t,"perPage",function(){return this._perPage}),a(0,t,"model",function(){return wt.instance.gameContext.model}),a(0,t,"view",function(){return wt.instance.gameContext.view}),i}(),Q=function(){function i(i){this.state=-1,this._cardIdx=0,this._skin=null,this.chiMark=null,this.pengMark=null,this.isShowTingImg=!1,this.showBaidaSimbol=!1,this.huEffAni=null,this._skin=i,this.chiMark=this._skin.chiMark,this.pengMark=this._skin.pengMark,null!=this.chiMark&&(this.chiMark.visible=!1,this.pengMark.visible=!1),this._skin.huEffImg&&this._skin.huEffImg.parent&&this._skin.huEffImg.parent.removeChild(this._skin.huEffImg),this._skin.tingImg&&(this._skin.tingImg.visible=!1)}n(i,"modules.game.majiangGame.view.card.BaseCard");var t=i.prototype;return t.show=function(){},t.hide=function(){},t.showTingState=function(){},t.cancleTingState=function(){},t.showKouState=function(){},t.removeTingEff=function(){},t.showCanTingImg=function(i){this._skin.tingImg&&(this._skin.tingImg.visible=i),this.isShowTingImg=i},t.up=function(){0!=this.state&&(this._skin.tingImg&&(this._skin.tingImg.y=22),this.state=0)},t.down=function(){1!=this.state&&(this._skin.tingImg&&(this._skin.tingImg.y=2),this.state=1)},t.back=function(){2!=this.state&&(this.state=2)},t.setCardImg=function(i){this.showBaidaSimbol&&this.skin.baidaImg&&(this.skin.baidaImg.visible=i==wt.instance.gameContext.model.baida[1]?!0:!1),this.cardIdx!=i&&(this._cardIdx=i)},t.reset=function(){this.hide(),null!=this.chiMark&&(this.chiMark.visible=!1,this.pengMark.visible=!1),0==E.isReplay&&(this._skin.valueImg.skin=""),this._cardIdx=-1,this.showCanTingImg(!1)},t.loadhuEff=function(){var i=this._skin.huEffImg;i&&(this._skin.removeChild(i),this.huEffAni=new ae,i.addChild(this.huEffAni),i.skin="",m.instance.on("MAJIANGPAGE_NOTICE_HUEFF_HIDE",this,this.hideHuEff))},t.hideHuEff=function(){this._skin.removeChild(this._skin.huEffImg)},t.showHuAni=function(i,t,e){void 0===i&&(i=0),void 0===t&&(t=!1),void 0===e&&(e=!1),null==this.huEffAni&&this.loadhuEff(),this._skin.addChild(this._skin.huEffImg),this.huEffAni.play()},a(0,t,"skin",function(){return this._skin}),a(0,t,"canControl",null,function(){}),a(0,t,"cardIdx",function(){return this._cardIdx},function(i){this._cardIdx=i}),a(0,t,"visible",function(){return!1}),a(0,t,"canControlWitchDark",null,function(){}),i.getCardIndex=function(i,t){switch(i){case 0:return t;case 1:return t+9;case 2:return t+18;default:return t+27}return 0},i.getTypeByCardIndex=function(i){return 9>=i?0:18>=i?1:27>=i?2:3},i.getNumByCardIndex=function(i){return 9>=i?i:18>=i?i-9:27>=i?i-18:i-27},i.PREPATH="gametable/mahjongpai/",i.CARCSTATE_UP=0,i.CARCSTATE_DOWN=1,i.CARCSTATE_BACK=2,s(i,["CARD_REFERENCE",function(){return this.CARD_REFERENCE={1:"wan1.png",2:"wan2.png",3:"wan3.png",4:"wan4.png",5:"wan5.png",6:"wan6.png",7:"wan7.png",8:"wan8.png",9:"wan9.png",10:"tong1.png",11:"tong2.png",12:"tong3.png",13:"tong4.png",14:"tong5.png",15:"tong6.png",16:"tong7.png",17:"tong8.png",18:"tong9.png",19:"tiao1.png",20:"tiao2.png",21:"tiao3.png",22:"tiao4.png",23:"tiao5.png",24:"tiao6.png",25:"tiao7.png",26:"tiao8.png",27:"tiao9.png",28:"zdong.png",29:"znan.png",30:"zxi.png",31:"zbei.png",32:"zzhong.png",33:"zfa.png",34:"zbai.png",35:"hchun.png",36:"hxia.png",37:"hqiu.png",38:"hjdong.png",39:"hmei.png",40:"hlan.png",41:"hzhu.png",42:"hju.png"}}]),i}(),X=function(){function i(){this.cardIdx=0,this.fromPos=-1,this.fromDir=-1,this.type=-1,this._cardsVec=o(4,null)}n(i,"modules.game.majiangGame.view.card.pengGangCard.BasePengGangCards");var t=i.prototype;return t.show=function(){},t.hide=function(){},t.setCardImg=function(i){this.cardIdx=i;var t=0,e=this._cardsVec.length;for(t=0;e>t;t++)this._cardsVec[t].setCardImg(i)},t.chi=function(i,t,e){void 0===e&&(e=0),this.type=0,console.log("chi arr::"+i),console.log("arr[0]::"+i[0]),console.log("arr[1]::"+i[1]),console.log("arr[2]::"+i[2]),this._cardsVec[0].show(),this._cardsVec[1].show(),this._cardsVec[2].show(),this._cardsVec[3].hide(),this._cardsVec[0].down(),this._cardsVec[1].down(),this._cardsVec[2].down(),this._cardsVec[0].setCardImg(i[0]),this._cardsVec[1].setCardImg(i[1]),this._cardsVec[2].setCardImg(i[2]);var s=i.indexOf(t);this._cardsVec[s].chiMark.visible=!0,this.fromPos=e,this.fromDir=3,this.show()},t.updateChengbaoColor=function(i,t){if(this.updateAnGangState(i),t==this.fromPos&&-1!=this.fromDir&&0!=this.fromDir){var e="",s="",n=this.model.getChengbaoNumRefNum(i,t);2>n?(e="gametable/chengbao/pengpaijiantou3_lan.png",s="gametable/chengbao/pengpaijiantou"+this.fromDir+"_lan.png"):3>n?(e="gametable/chengbao/pengpaijiantou3_huang.png",s="gametable/chengbao/pengpaijiantou"+this.fromDir+"_huang.png"):(e="gametable/chengbao/pengpaijiantou3_hong.png",s="gametable/chengbao/pengpaijiantou"+this.fromDir+"_hong.png");var a=0,o=this._cardsVec.length;for(a=0;o>a;a++)this._cardsVec[a].chiMark.skin=e,this._cardsVec[a].pengMark.skin=s}},t.setChengbaoGang=function(){if(0!=this.fromDir){var i="",t="";i="gametable/chengbao/pengpaijiantou3_hong.png",t="gametable/chengbao/pengpaijiantou"+this.fromDir+"_hong.png";var e=0,s=this._cardsVec.length;for(e=0;s>e;e++)this._cardsVec[e].chiMark.skin=i,this._cardsVec[e].pengMark.skin=t}},t.peng=function(i,t,e){void 0===i&&(i=0),void 0===t&&(t=-1),void 0===e&&(e=0),this.type=1,this._cardsVec[0].show(),this._cardsVec[1].show(),this._cardsVec[2].show(),this._cardsVec[3].hide(),this._cardsVec[0].down(),this._cardsVec[1].down(),this._cardsVec[2].down(),this.setCardImg(i),(-1!=t||0!=t)&&(this._cardsVec[0].pengMark.visible=!0,this.fromPos=e,this.fromDir=t),this.show()},t.gang=function(i,t,e,s){void 0===i&&(i=0),void 0===t&&(t=!0),void 0===e&&(e=-1),void 0===s&&(s=0),this.type=t?3:2;var n=0,a=this._cardsVec.length;for(n=0;a>n;n++)this._cardsVec[n].pengMark.visible=!1,this._cardsVec[n].show(),3>n?t?(this._cardsVec[n].down(),0==n&&(-1!=e||0!=e)&&(this._cardsVec[n].pengMark.visible=!0,this.fromPos=s,this.fromDir=e)):this._cardsVec[n].back():this._cardsVec[n].down();this.setCardImg(i),this.show()},t.updateAnGangState=function(i){if(2==this.type){{this._cardsVec.length}1==this.model.judgeMenqing(i)?0==this.model.isSelfSitDown?this._cardsVec[3].back():i==this.model.selfChairPos?this._cardsVec[3].down():this._cardsVec[3].back():this._cardsVec[3].down()}},t.showHuAni=function(i){this._cardsVec[3].showHuAni(i,!1,!0)},t.reset=function(){var i=0,t=this._cardsVec.length;for(i=0;t>i;i++)this._cardsVec[i].reset(),this._cardsVec[i].down();this.hide(),this.cardIdx=0,this.fromPos=-1,this.type=-1},t.showPreDiscardEff=function(i){var t=0,e=this._cardsVec.length;for(t=0;e>t;t++)this._cardsVec[t].skin.visible&&this._cardsVec[t].cardIdx==i?(x.addRed(this._cardsVec[t].skin.downImg,!0),x.addRed(this._cardsVec[t].skin.valueImg,!0)):(x.addRed(this._cardsVec[t].skin.downImg,!1),x.addRed(this._cardsVec[t].skin.valueImg,!1))},t.hidePreDiscardEff=function(){var i=0,t=this._cardsVec.length;for(i=0;t>i;i++)x.addRed(this._cardsVec[i].skin.downImg,!1),x.addRed(this._cardsVec[i].skin.valueImg,!1)},a(0,t,"visible",function(){return!1}),a(0,t,"model",function(){return wt.instance.gameContext.model}),i}(),Z=function(){function i(i){this._skin=null,this.handPart=null,this.pengGangPart=null,this.outputPart=null,this.huaPart=null,this.hupaiTipPart=null,this.handleBtns=null,this.clockPart=null,this.handleEffPart=null,this._majiangControlTipPage=null,this.chiSelePage=null,this.baidaPart=null,this.shaiziPart=null,i&&(this._skin=i,this._skin.mouseThrough=!0,this.handPart=new et(this._skin.bottomHandlePart,this._skin.rightHandlePart,this._skin.topHandlePart,this._skin.leftHandlePart),this.pengGangPart=new ct(this._skin.bottomPengGangPart,this._skin.rightPengGangPart,this._skin.topPengGangPart,this._skin.leftPengGangPart),this.outputPart=new lt(this._skin.bottomOutputPart,this._skin.rightOutputPart,this._skin.topOutputPart,this._skin.leftOutputPart,[this._skin.bottomTempPopcard,this._skin.rightTempPopcard,this._skin.topTempPopcard,this._skin.leftTempPopcard]),this.handleBtns=new it(this._skin.handleBtns),this.huaPart=new nt(this._skin.bottomHuaPart,this._skin.rightHuaPart,this._skin.topHuaPart,this._skin.leftHuaPart),this.hupaiTipPart=new ht(this._skin.bottomHuTip,this._skin.rightHuTip,this._skin.tophuTip,this._skin.leftHuTip),this.clockPart=new $(this._skin.clockPart),this.handleEffPart=new tt(this._skin.handleEffPart),this._majiangControlTipPage=new rt(this._skin.controlTip),this.chiSelePage=new J(this._skin.chiSelePart),this.baidaPart=new q(this._skin.baidaPart),this.shaiziPart=new ut(this._skin.shaiziPart))}n(i,"modules.game.majiangGame.view.MajiangPage");var t=i.prototype;return t.showControlTip=function(i){this._majiangControlTipPage&&this._majiangControlTipPage.show(i)},t.hideControlTip=function(){this._majiangControlTipPage.hide()},t.showEffByPos=function(i,t){this.handleEffPart.showEffByPos(i,t)},t.setChairNum=function(i){this.handPart.setChairNum(i),this.pengGangPart.setChairNum(i),this.outputPart.setChairNum(i),this.huaPart.setChairNum(i),this.clockPart.setChairNum(i),this.handleEffPart.setChairNum(i),this.shaiziPart.setChairNum(i)},t.reset=function(){this.handPart.reset(),this.pengGangPart.reset(),this.outputPart.reset(),this.huaPart.reset(),this.clockPart.reset(),this._majiangControlTipPage.reset(),this.handleBtns.reset(),this.hupaiTipPart.reset(),this.chiSelePage.reset(),this.baidaPart.reset(),this.shaiziPart.reset()},t.showZimoAni=function(i){this.handPart.showZimoShandian(i)},t.showDianPaoHuAni=function(){this.outputPart.showDianPaoHuAni()},t.showBuhua=function(i,t,e,s,n){void 0===e&&(e=!0),void 0===s&&(s=!1),void 0===n&&(n=!0),this.huaPart.showBuhuaCard(i,t,e,s,n)},a(0,t,"skin",function(){return this._skin}),i}(),q=function(){function i(i){this._skin=null,this._magicCard=null,this._fanpaiCard=null,this._skin=i,this.init(),this.hide()}n(i,"modules.game.majiangGame.view.majiangPart.BaidaPart");var t=i.prototype;return t.init=function(){this._magicCard=new xt(this._skin.magiccard,!1,!1),this._magicCard.canControl=!1,this._magicCard.show(),this._fanpaiCard=new xt(this._skin.fancard,!1,!1),this._fanpaiCard.canControl=!1,this._fanpaiCard.show()},t.show=function(){this._skin.visible=!0},t.hide=function(){this._skin.visible=!1},t.showBaida=function(i,t){this.show(),this._magicCard.setCardImg(i),this._fanpaiCard.setCardImg(t)},t.reset=function(){this.hide()},i}(),J=function(){function i(i){this.skin=null,this.bgW=0,this.seleCards=o(6,null),this.skin=i,this.bgW=i.backimg.width,this.init(),e.stage.on("click",this,this.onClickthis),this.hide()}n(i,"modules.game.majiangGame.view.majiangPart.ChiSelePart");var t=i.prototype;return t.onClickthis=function(i){console.log("taegt:",i.currentTarget)},t.init=function(){var i=0,t=this.seleCards.length;for(i=0;t>i;i++)this.seleCards[i]=new te(this.skin["card"+i]);this.seleCards[0].skin.on("click",this,this.onClickChi0),this.seleCards[1].skin.on("click",this,this.onClickChi0),this.seleCards[2].skin.on("click",this,this.onClickChi1),this.seleCards[3].skin.on("click",this,this.onClickChi1),this.seleCards[4].skin.on("click",this,this.onClickChi2),this.seleCards[5].skin.on("click",this,this.onClickChi2)},t.onClickChi0=function(){this.chi(this.seleCards[0].cardIdx,this.seleCards[1].cardIdx),this.hide()},t.onClickChi1=function(){this.chi(this.seleCards[2].cardIdx,this.seleCards[3].cardIdx),this.hide()},t.onClickChi2=function(){this.chi(this.seleCards[4].cardIdx,this.seleCards[5].cardIdx),this.hide()},t.chi=function(i,t){var e=this.view.majiangPage.outputPart.getCurOutputCardIdx(),s=this.model.allCardsVec[this.model.selfChairPos].concat(),n=0,a=0,o=s.length;for(a=o-1;o>a;a--)if(s[a]!=i&&s[a]!=t){n=s[a];break}var h={SID:E.SID,CID1:e-1,CID2:i-1,CID3:t-1,DefCID:n-1};this.controller.sendMsgCommond(T.getProtoMessage(290,h)),wt.instance.gameContext.view.majiangPage.handleBtns.reset()},t.showCanChiCards=function(i){this.show();var t=50,e=this.skin.chi0.width,s=0,n=i.length;for(s=0;n>s;s++)this.skin["chi"+s].visible=!0,i[s].sort(this.model.compareFunction),this.seleCards[2*s].setCardImg(i[s][0]),this.skin["chi"+s].x=19+(t+e)*s,this.seleCards[2*s+1].setCardImg(i[s][1]);for(s=n;3>s;s++)this.skin["chi"+s].visible=!1;this.skin.backimg.width=38+e*n+t*(n-1)},t.show=function(){this.skin.visible=!0},t.hide=function(){this.skin.visible=!1},t.reset=function(){this.hide()},a(0,t,"view",function(){return wt.instance.gameContext.view}),a(0,t,"controller",function(){return wt.instance.gameContext.controller}),a(0,t,"model",function(){return wt.instance.gameContext.model}),i}(),$=function(){function i(i){this._skin=null,this._left=null,this._bottom=null,this._top=null,this._right=null,this._clockTf=null,this._leftCardsNumTf=null,this._leftRoundNumTf=null,this._curHandPos=-1,this._leftTime=0,this._PosChairVec=[],this._skin=i,this.init()}n(i,"modules.game.majiangGame.view.majiangPart.ClockPart");var t=i.prototype;return t.init=function(){this._left=this._skin.leftSimbol,this._bottom=this._skin.bottomSimbol,this._top=this._skin.topSimbol,this._right=this._skin.rightSimbol,this._clockTf=this._skin.clockTf,this._clockTf.scaleX=this._clockTf.scaleY=.55,this._clockTf.font=D.NumberYellowFont,this._leftCardsNumTf=this._skin.leftCardsNumTf,this._leftCardsNumTf.scaleX=this._leftCardsNumTf.scaleY=.6,this._leftCardsNumTf.font=D.NumberYellowFont,this._leftRoundNumTf=this._skin.leftRoundNumTf,this._leftRoundNumTf.scaleX=this._leftRoundNumTf.scaleY=.6,this._leftRoundNumTf.font=D.NumberYellowFont,this.allReset()},t.setWenli=function(){switch(E.roomtype){case 3e3:this._skin.wenliImg.skin="gametable/wenli_xizhou.png";break;case 3010:this._skin.wenliImg.skin="gametable/wenli_xiangshan.png"}},t.allReset=function(){this._bottom.visible=!1,this._right.visible=!1,this._top.visible=!1,this._left.visible=!1,this._clockTf.text="00",this._leftCardsNumTf.text="0",this._leftRoundNumTf.text="0"},t.setChairNum=function(i){switch(void 0===i&&(i=3),this._PosChairVec.length=0,i){case 1:this._PosChairVec.push(this._bottom);break;case 2:this._PosChairVec.push(this._bottom,this._top);break;case 3:this._PosChairVec.push(this._bottom,this._right,this._left);break;case 4:this._PosChairVec.push(this._bottom,this._right,this._top,this._left);break;default:this._PosChairVec.push(this._bottom,this._right,this._left)}this.reset()},t.noticeShowClock=function(i,t){this._curHandPos=i,this.model.curHandlePos=i,this._leftTime=t,this._clockTf.text=this._leftTime<10?"0"+this._leftTime:this._leftTime+"",R.instance.timer.clear(this,this.onTime),R.instance.timer.loop(1e3,this,this.onTime),this.showDir(this.model.getChairDirByPos(i))},t.showLeftRoundsNum=function(){var i=this.model.majiangMsgs.ACK_RoomInfo,t=i.Rule,e=l.getRule(t[1]);i.totalRound=e.value,i.RoundCount+1>e.value?(this._leftRoundNumTf.text=""+i.RoundCount,this._leftRoundNumTf.x=i.RoundCount<10?42:32):(this._leftRoundNumTf.text=""+(i.RoundCount+1),this._leftRoundNumTf.x=i.RoundCount+1<10?42:32)
},t.showDir=function(i){var t=0,e=this._PosChairVec.length;for(t=0;e>t;t++)this._PosChairVec[t].visible=t==i?!0:!1},t.onTime=function(){return 0==w.CurGameModule.inGame||0==this.model.isGameStart?(this._leftTime=0,this._clockTf.text=this._leftTime<10?"0"+this._leftTime:this._leftTime+"",R.instance.timer.clear(this,this.onTime),void 0):(this._leftTime-=1,this._leftTime<0&&(this._leftTime=10),this._clockTf.text=this._leftTime<10?"0"+this._leftTime:this._leftTime+"",this._leftTime<5&&G.playEffect("game_warn"),void 0)},t.noticeShowLeftCardsNum=function(){this.model.leftDesktopCardsNum<0&&(this.model.leftDesktopCardsNum=0),this._leftCardsNumTf.text=""+this.model.leftDesktopCardsNum},t.reset=function(){var i=0,t=this._PosChairVec.length;for(i=0;t>i;i++)this._PosChairVec[i].visible=!1;this._clockTf.text="00",this._leftCardsNumTf.text="0"},t.dingDongwei=function(i,t,e){void 0===t&&(t=!1),void 0===e&&(e=!0);var s=this.model.getChairDirByPos(i);e?M.to(this._skin.middleBox,{rotation:modules.game.majiangGame.view.majiangPart.ClockPart.RotationArr[s]},1e3):this._skin.middleBox.rotation=modules.game.majiangGame.view.majiangPart.ClockPart.RotationArr[s],this._PosChairVec.length=0,this._PosChairVec.push(this._bottom,this._right,this._top,this._left);var n=[],a=[],o=0,h=this._PosChairVec.length;for(o=0;h>o;o++)h-s>o?a.push(this._PosChairVec[o]):n.push(this._PosChairVec[o]);this._PosChairVec=n.concat(a)},a(0,t,"model",function(){return wt.instance.gameContext.model}),s(i,["RotationArr",function(){return this.RotationArr=[0,-90,-180,-270]}]),i}(),it=function(){function i(i){this._skin=null,this._skinOrignalX=0,this._singleW=0,this.isZimo=!1,this._skin=i,this._singleW=this._skin.pengBtn.width+2,this._skinOrignalX=this._skin.x,this.add(),this.show(),this.reset()}n(i,"modules.game.majiangGame.view.majiangPart.HandleBtnsPart");var t=i.prototype;return t.show=function(){this._skin.visible=!0},t.hide=function(){this._skin.visible=!1},t.add=function(){this._skin.chiBtn.on("click",this,this.onClickChiBtn),this._skin.pengBtn.on("click",this,this.onClickPengBtn),this._skin.gangBtn.on("click",this,this.onClickGangBtn),this._skin.huBtn.on("click",this,this.onClickHuBtn),this._skin.cancelBtn.on("click",this,this.onClickCancelBtn),this._skin.tingBtn.on("click",this,this.onClickTingBtn),this._skin.kouBtn.on("click",this,this.onClickKouBtn)},t.parseOpration=function(i){var t=0;return i[0]>0&&(t+=32),i[1]>0&&(t+=8),i[2]>0&&(t+=4),i[3]>0&&(t+=2),t},t.showBtnList=function(i){this.show();var t=0;if(null==i){var e=this.model.majiangMsgs.ACK_WaitTool;t=this.parseOpration(e.Type)}else t=this.parseOpration(i);this._skin.chiBtn.visible=!1,this._skin.pengBtn.visible=!1,this._skin.gangBtn.visible=!1,this._skin.huBtn.visible=!1,this._skin.kouBtn.visible=!1,this._skin.tingBtn.visible=!1,this._skin.cancelBtn.visible=!0;var s=0;return 2&t&&(this._skin.chiBtn.visible=!0,this._skin.chiBtn.x=s*this._singleW,s++),4&t&&(this._skin.pengBtn.visible=!0,this._skin.pengBtn.x=s*this._singleW,s++),8&t&&(this._skin.gangBtn.visible=!0,this._skin.gangBtn.x=s*this._singleW,s++),16&t&&(this._skin.tingBtn.visible=!0,this._skin.tingBtn.x=s*this._singleW,s++),32&t&&(this.isZimo=!1,this._skin.huBtn.visible=!0,this._skin.huBtn.x=s*this._singleW,s++),64&t&&(this.isZimo=!0,this._skin.huBtn.visible=!0,this._skin.huBtn.x=s*this._singleW,s++),this._skin.cancelBtn.x=s*this._singleW,this._skin.x=this._skinOrignalX-s*this._singleW,this.model.curOutPutPos==(this.model.selfChairPos-1+4)%4&&1==this.model.checkHaveHua(this.model.selfChairPos)?(console.log("玩家手里有花！！！"),1!=this._skin.huBtn.visible&&this.reset(),void 0):(l.autoPlay&&this.model.isSelfSitDown&&(l.autoDestory&&wt.instance.gameContext.controller.sendRandom(),this._skin.huBtn.visible?this.onClickHuBtn(null):this._skin.gangBtn.visible?this.model.getHuTipArr(-1).length>0?this.onClickCancelBtn(null):this.onClickGangBtn(null):this._skin.pengBtn.visible?this.model.getHuTipArr(-1).length>0?this.onClickCancelBtn(null):this.onClickPengBtn(null):this._skin.chiBtn.visible?this.model.getHuTipArr(-1).length>0?this.onClickCancelBtn(null):this.onClickChiBtn(null):this.onClickCancelBtn(null)),void 0)},t.showCanKouControll=function(){this.show(),this._skin.chiBtn.visible=!1,this._skin.pengBtn.visible=!1,this._skin.gangBtn.visible=!1,this._skin.huBtn.visible=!1,this._skin.kouBtn.visible=!0,this._skin.tingBtn.visible=!1,this._skin.cancelBtn.visible=!0,this._skin.kouBtn.disabled=!0,this._skin.kouBtn.x=0,this._skin.cancelBtn.x=this._singleW,this._skin.x=this._skinOrignalX-this._singleW},t.showCancelLp=function(){this.show(),this._skin.chiBtn.visible=!1,this._skin.pengBtn.visible=!1,this._skin.gangBtn.visible=!1,this._skin.huBtn.visible=!1,this._skin.kouBtn.visible=!1,this._skin.tingBtn.visible=!1,this._skin.cancelBtn.visible=!0,this._skin.cancelBtn.x=0,this._skin.x=this._skinOrignalX},t.showKouBtnEnable=function(){this._skin.kouBtn.disabled=!1},t.onClickChiBtn=function(){if(l.autoPlay)this.onConFirmChi(0);else if(2==this.model.getChengbaoNumRefNum(this.model.selfChairPos,this.view.majiangPage.outputPart.getCurOutIdx())){var i=this.model.warnCThenBaoipStr;x.popMessageBox(i,"BTN_LABEL_QUEDINGQUXIAO",this,this.onConFirmChi,"提示","center",null,33)}else this.onConFirmChi(0);this.reset()},t.onConFirmChi=function(i){if(0==i){var t=this.view.majiangPage.outputPart.getCurOutputCardIdx();if(0==t)return;var e=0,s=0,n=0,a=[],o=this.model.allCardsVec[this.model.selfChairPos].concat(),h=0,r=o.length;if(s=t-1,n=t-2,Q.getTypeByCardIndex(t)==Q.getTypeByCardIndex(s)&&Q.getTypeByCardIndex(t)==Q.getTypeByCardIndex(n)&&-1!=o.indexOf(s)&&-1!=o.indexOf(n)&&a.push([s,n]),s=t-1,n=t+1,Q.getTypeByCardIndex(t)==Q.getTypeByCardIndex(s)&&Q.getTypeByCardIndex(t)==Q.getTypeByCardIndex(n)&&-1!=o.indexOf(s)&&-1!=o.indexOf(n)&&a.push([s,n]),s=t+1,n=t+2,Q.getTypeByCardIndex(t)==Q.getTypeByCardIndex(s)&&Q.getTypeByCardIndex(t)==Q.getTypeByCardIndex(n)&&-1!=o.indexOf(s)&&-1!=o.indexOf(n)&&a.push([s,n]),1==a.length||l.autoPlay){for(l.autoDestory&&wt.instance.gameContext.controller.sendRandom(),h=r-1;r>h;h--)if(o[h]!=s&&o[h]!=n){e=o[h];break}var c={SID:E.SID,CID1:t-1,CID2:a[0][0]-1,CID3:a[0][1]-1,DefCID:e-1};this.controller.sendMsgCommond(T.getProtoMessage(290,c)),this.reset()}else this.view.majiangPage.chiSelePage.showCanChiCards(a),this.reset()}else this.showBtnList()},t.onClickPengBtn=function(){if(l.autoPlay)this.onConFirmPeng(0);else if(2==this.model.getChengbaoNumRefNum(this.model.selfChairPos,this.view.majiangPage.outputPart.getCurOutIdx())){var i=this.model.warnCThenBaoipStr;x.popMessageBox(i,"BTN_LABEL_QUEDINGQUXIAO",this,this.onConFirmPeng,"提示","center",null,33)}else this.onConFirmPeng(0);this.reset()},t.onConFirmPeng=function(i){if(0==i){var t=this.view.majiangPage.outputPart.getCurOutputCardIdx();if(0==t)return;var e=0,s=this.model.allCardsVec[this.model.selfChairPos].concat(),n=0,a=s.length;for(n=a-1;a>n;n--)if(s[n]!=t){e=s[n];break}var o={SID:E.SID,CID:t-1,DefCID:e-1};this.controller.sendMsgCommond(T.getProtoMessage(300,o))}else this.showBtnList()},t.compareFunction=function(i,t){return t>i?-1:i==t?0:1},t.onClickGangBtn=function(){this.model.tempGangCards=[];var i=this.model.allCardsVec[this.model.selfChairPos];-1!=this.model.theFourteenCardVec[this.model.selfChairPos]&&(i=i.concat(this.model.theFourteenCardVec[this.model.selfChairPos]));var t=0,e=i.length;if(i.sort(this.compareFunction),-1==this.model.theFourteenCardVec[this.model.selfChairPos]&&i.length%3!=2){if(l.autoPlay)this.onConFirmMingGang(0);else if(2==this.model.getChengbaoNumRefNum(this.model.selfChairPos,this.view.majiangPage.outputPart.getCurOutIdx())){var s=this.model.warnCThenBaoipStr;x.popMessageBox(s,"BTN_LABEL_QUEDINGQUXIAO",this,this.onConFirmMingGang,"提示","center",null,33)}else this.onConFirmMingGang(0);return this.reset(),void 0}for(t=0;e>t;t++)i[t]==i[t+1]&&i[t+1]==i[t+2]&&i[t+2]==i[t+3]&&(this.model.tempGangCards.push({type:1,card:i[t]}),t+=3);for(e=this.model.pengVec[this.model.selfChairPos].length,t=0;e>t;t++)-1!=i.indexOf(this.model.pengVec[this.model.selfChairPos][t])&&(console.log("zhaodaole gang!!"),this.model.tempGangCards.push({type:0,card:this.model.pengVec[this.model.selfChairPos][t]}));if(1==this.model.tempGangCards.length||l.autoPlay){var n=this.model.tempGangCards[0].card,a=(this.model.tempGangCards[0].type,{SID:E.SID,CID:n-1});this.controller.sendMsgCommond(T.getProtoMessage(310,a))}else this.model.isNextGang=!0,this.view.majiangPage.handPart.showCanGangCards(this.model.tempGangCards);this.reset()},t.onConFirmMingGang=function(i){if(0==i){var t=this.view.majiangPage.outputPart.getCurOutputCardIdx(),e=this.model.allCardsVec[this.model.selfChairPos].concat(this.model.theFourteenCardVec[this.model.selfChairPos]),s=0;for(s=0;s<e.length;s++)if(e[s]==e[s+1]&&e[s+1]==e[s+2]&&t==e[s]){this.model.tempGangCards.push({type:2,card:e[s]});break}if(1==this.model.tempGangCards.length||l.autoPlay){var n=this.model.tempGangCards[0].card,a=(this.model.tempGangCards[0].type,{SID:E.SID,CID:n-1});this.controller.sendMsgCommond(T.getProtoMessage(310,a))}else this.model.isNextGang=!0,this.view.majiangPage.handPart.showCanGangCards(this.model.tempGangCards)}else this.showBtnList()},t.onClickHuBtn=function(){var i=0;i=-1!=this.model.theFourteenCardVec[this.model.selfChairPos]?this.model.theFourteenCardVec[this.model.selfChairPos]-1:this.view.majiangPage.outputPart.getCurOutputCardIdx()-1,-1==i&&(i=this.model.lastHuanHuaCard-1);var t={SID:E.SID,CID:i};console.log(t,"-------------------------------"),this.controller.sendMsgCommond(T.getProtoMessage(320,t)),this.reset()},t.onClickCancelBtn=function(){if(this.model.isNextCancelBtnKou){this.model.tempKouCards.length=0,this.model.koupaiwancheng?(this.model.isCancelTingp=!1,this.showBtnList(),this.view.majiangPage.handPart.showCancelKouCards(),this.model.isNextCancelBtnKou=!1,this.view.majiangPage.handPart.cancelTingpai(),this.view.majiangPage.hideControlTip()):(this.showCancelLp(),this.model.isCancelTingp=!0,this.view.majiangPage.handPart.showCancelKouCards(),this.view.majiangPage.handPart.showCanTingCards(this.model.tingCardsOfCancelBtn),this.model.isNextCancelBtnKou=!1,this.view.majiangPage.hideControlTip()),this.model.koupaiwancheng=!1;var i={cmd:"KPQX"};return this.controller.sendMsgCommond(i,!1),void 0}if(this.model.isCancelTingp)return this.model.isCancelTingp=!1,this.view.majiangPage.handPart.cancelTingpai(),this.showBtnList(),void 0;this.view.majiangPage.chiSelePage.hide();var t={SID:E.SID};if(this.controller.sendMsgCommond(T.getProtoMessage(330,t),!1),1==l.autoPlay&&-1!=this.model.theFourteenCardVec[this.model.selfChairPos]){var e=this.model.allCardsVec[this.model.selfChairPos].concat(this.model.theFourteenCardVec[this.model.selfChairPos]);e.length%3==2&&this.controller.autoDiscard()}this.reset()},t.onClickTingBtn=function(){var i=this.model.majiangMsgs.control_game_mjopration_Info.nopercard;console.log("ting .............."),console.log(this.model.majiangMsgs.control_game_mjopration_Info),console.log("ting ..............");var t=[],e=[],s=0,n=i.length;for(s=0;n>s;s++)1==i[s].type&&(t.push(i[s].card),e=e.concat(i[s].nkoucard));var a=[];for(s=0;s<e.length;s++)a.push(e[s].card);return this.model.tingCardsOfCancelBtn=t,console.log("tingCards ::"+t),console.log("kouCards ::"+e.length),e.length>0?(console.log("kouCards :: "+e),this.view.majiangPage.handPart.showCanKouCards(a),this.view.majiangPage.showControlTip("请选择要扣的牌"),this.model.isNextCancelBtnKou=!0,this.view.majiangPage.handleBtns.showCanKouControll(),void 0):(this.view.majiangPage.handPart.showCanTingCards(this.model.tingCardsOfCancelBtn),this.model.isCancelTingp=!0,this.showCancelLp(),void 0)},t.onCancelTingPaiBtn=function(){this.view.majiangPage.handPart.cancelTingpai(),this.showBtnList()},t.onClickKouBtn=function(){this.view.majiangPage.handPart.showCanTingCards(this.model.tingCardsOfKouBtn),this.view.majiangPage.hideControlTip();var i={cmd:"KPWC"};this.controller.sendMsgCommond(i,!1),this.showCancelLp(),this.model.isCancelTingp=!0},t.remove=function(){},t.reset=function(){this._skin.chiBtn.visible=!1,this._skin.pengBtn.visible=!1,this._skin.gangBtn.visible=!1,this._skin.huBtn.visible=!1,this._skin.kouBtn.visible=!1,this._skin.tingBtn.visible=!1,this._skin.cancelBtn.visible=!1,this.isZimo=!1,this.show()},a(0,t,"model",function(){return wt.instance.gameContext.model}),a(0,t,"controller",function(){return wt.instance.gameContext.controller}),a(0,t,"view",function(){return wt.instance.gameContext.view}),i}(),tt=function(){function i(i){this._skin=null,this._items=o(4,null),this._PosChairVec=[],this._skin=i,this.init()}n(i,"modules.game.majiangGame.view.majiangPart.HandleEffPart");var t=i.prototype;return t.setChairNum=function(i){switch(void 0===i&&(i=3),this._PosChairVec.length=0,i){case 1:this._PosChairVec.push(this._items[0]);break;case 2:this._PosChairVec.push(this._items[0],this._items[1]);break;case 3:this._PosChairVec.push(this._items[0],this._items[1],this._items[3]);break;case 4:this._PosChairVec.push(this._items[0],this._items[1],this._items[2],this._items[3]);break;default:this._PosChairVec.push(this._items[0],this._items[1],this._items[3])}},t.init=function(){var i=0,t=this._items.length;for(i=0;t>i;i++)this._items[i]=new gt(this._skin["item"+i])},t.showEffByPos=function(i,t){var e=this.model.getChairDirByPos(i);this._PosChairVec[e].showEff(t)},a(0,t,"model",function(){return wt.instance.gameContext.model}),i}(),et=function(){function i(i,t,e,s){this._bottom=null,this._right=null,this._top=null,this._left=null,this._PosChairVec=[],this._bottom=new Ft(i),this._right=new Lt(t),this._top=new Ut(e),this._left=new Kt(s),this.allReset()}n(i,"modules.game.majiangGame.view.majiangPart.HandlePart");var t=i.prototype;return t.allReset=function(){this._bottom.reset(),this._right.reset(),this._top.reset(),this._left.reset()},t.setChairNum=function(i){switch(void 0===i&&(i=3),this._PosChairVec.length=0,i){case 1:this._PosChairVec.push(this._bottom);break;case 2:this._PosChairVec.push(this._bottom,this._top);break;case 3:this._PosChairVec.push(this._bottom,this._right,this._left);break;case 4:this._PosChairVec.push(this._bottom,this._right,this._top,this._left);break;default:this._PosChairVec.push(this._bottom,this._right,this._left)}this.reset()},t.reset=function(){var i=0,t=this._PosChairVec.length;for(i=0;t>i;i++)this._PosChairVec[i].reset();this.canControl(this.model.selfChairPos,!1)},t.updateAllCards=function(i){var t=0,e=i.length;for(t=0;e>t;t++){var s=this.model.getChairDirByPos(t);0!=s&&0==E.isReplay&&this._PosChairVec[s].playQipaiEff(),this._PosChairVec[s].setPreThirteenCards(i[t],s)}},t.updateOnePosAllCards=function(i,t){console.log("pos ::"+i);var e=this.model.getChairDirByPos(i);console.log("dir ::"+e),console.log("_PosChairVec[dir] ::"+this._PosChairVec[e]),this._PosChairVec[e].setPreThirteenCards(t,e)},t.updateTheFourteenCard=function(i,t){var e=this.model.getChairDirByPos(i);this._PosChairVec[e].setTheFourteenCard(t,e)},t.updateTheFourteenCards=function(i){var t=0,e=i.length;for(t=0;e>t;t++)this.updateTheFourteenCard(t,i[t])},t.showCanKouCards=function(i){this._PosChairVec[0].showCanKouCards(i)},t.showCancelKouCards=function(){this._PosChairVec[0].showCancelKouCards()},t.showTempKouCards=function(i){this._PosChairVec[0].showTempKouCards(i)},t.showCanTingCards=function(i){this.model.koupaiwancheng=!0,this._PosChairVec[0].showCanTingCards(i)},t.cancelTingpai=function(){this.model.koupaiwancheng=!1,this._PosChairVec[0].cancelTingpai(),wt.instance.gameContext.view.majiangPage.hupaiTipPart.cancelTingpai(this.model.selfChairPos),this._PosChairVec[0].canControl=!0},t.canControl=function(i,t,e){this._PosChairVec[this.model.getChairDirByPos(i)].canControl=t,t&&i==this.model.selfChairPos&&this.model.isSelfSitDown&&e&&this.canControlWitchDark(i,t,e)},t.canControlWitchDark=function(i,t,e){this._PosChairVec[this.model.getChairDirByPos(i)].canControlWitchDark(e)},t.showTinged=function(i){var t=this.model.getChairDirByPos(i);this._PosChairVec[t].showTinged()},t.showCanGangCards=function(i){this._PosChairVec[0].showCanGangCards(i)},t.showZimoShandian=function(i){var t=this.model.getChairDirByPos(i);this._PosChairVec[t].showHuAni(i)},t.movePeng=function(i,t){var e=this.model.getChairDirByPos(i);this._PosChairVec[e].movePeng(t)},t.showPreDiscardEff=function(i){var t=0;for(t=0;t<this.model.chairNum;t++)this._PosChairVec[t].showPreDiscardEff(i)},t.hidePreDiscardEff=function(){var i=0;for(i=0;i<this.model.chairNum;i++)this._PosChairVec[i].hidePreDiscardEff()},a(0,t,"model",function(){return wt.instance.gameContext.model}),i}(),st=function(){function i(i){this._skin=null,this._curIdx=0,this._itemClip=null,this._tweenArr=null,this._huaBg=null,this._isPlayIng=!1,this._oldPt=null,this._haveHuaIndex=0,this._isOverHua=!1,this._cardsVec=o(15,null),this._skin=i,this._tweenArr=[],this._huaBg=this._skin.huaBg,this._huaBg.visible=!1,this._itemClip=new jt(this._skin.huaAnim),this._itemClip.skin.visible=!1,this._oldPt=new V(this._itemClip.skin.x,this._itemClip.skin.y);var t=0,e=this._cardsVec.length;for(t=0;e>t;t++)this._skin instanceof ui.mainGame.majiangParts.huaBottomPartUI?this._cardsVec[t]=new jt(this._skin["hua"+t]):this._skin instanceof ui.mainGame.majiangParts.huaRightPartUI?this._cardsVec[t]=new jt(this._skin["hua"+t]):this._skin instanceof ui.mainGame.majiangParts.huaTopPartUI?this._cardsVec[t]=new jt(this._skin["hua"+t]):this._skin instanceof ui.mainGame.majiangParts.huaLeftPartUI&&(this._cardsVec[t]=new jt(this._skin["hua"+t]))}n(i,"modules.game.majiangGame.view.majiangPart.huaPart.BaseBuhuaPart");var t=i.prototype;return t.showOneCard=function(i,t,e,s,n){void 0===s&&(s=!1),void 0===n&&(n=0);var a=new at;a.pos=i,a.cardIdx=t,a.isMopai=s,e?(this._tweenArr.push(a),this.startTween()):this.showhua(t)},t.startTween=function(){if(1!=this._isPlayIng)if(this._tweenArr.length>0){this._isPlayIng=!0;var i=this._tweenArr.shift();this.playAnimation(i.cardIdx,i.pos,i.isMopai)}else this._isPlayIng=!1},t.playAnimation=function(i,t,e){var s;this.checkHaveHuaForId(i)?(s=this._cardsVec[this._haveHuaIndex],this._itemClip.setCardImg(i)):(s=this._cardsVec[this._curIdx],this._itemClip.setCardImg(i)),e?(this._itemClip.skin.visible=!0,M.to(this._huaBg,{alpha:.3},200,g.cubicOut,v.create(this,this.tweenBgHander,[s,t,i]),0)):(this._itemClip.skin.visible=!0,this.tweenBgHander(s,t,i))},t.tweenBgHander=function(i,t,e){this._huaBg.visible=!1,this._huaBg.alpha=1,M.to(this._itemClip.skin,{x:i.skin.x,y:i.skin.y,scaleX:1,scaleY:1},300,g.cubicOut,v.create(this,this.tweenHander,[t,e]),0)},t.tweenHander=function(i,t){console.log("tweenHander"+i+"---"+t);var e=new at;e.pos=i,e.cardIdx=t,this._isPlayIng=!1,this._itemClip.skin.visible=!1,this._itemClip.skin.x=this._oldPt.x,this._itemClip.skin.y=this._oldPt.y,this._itemClip.skin.scaleX=2,this._itemClip.skin.scaleY=2,this._isOverHua||(this.model.overHuaVec[e.pos]--,this.checkIsOverHua(e.pos)),this.showhua(e.cardIdx),this.startTween()},t.checkIsOverHua=function(i){{var t=this.model.overHuaVec;t.length}t[i]>0?this._isOverHua=!1:(this._isOverHua=!0,m.instance.event("GAME_BUHUAN_COMPLETE",null)),this.model.checkAllBuhuaComp()},t.showhua=function(i){this.checkHaveHuaForId(i)?this._cardsVec[this._haveHuaIndex].setNum():this._curIdx<this._cardsVec.length&&(this._cardsVec[this._curIdx].setCardImg(i),this._cardsVec[this._curIdx].show(),this._curIdx++)},t.checkHaveHuaForId=function(i){for(var t=0;t<this._cardsVec.length;t++)if(this._cardsVec[t].cardIdx==i)return this._haveHuaIndex=t,!0;return!1},t.reset=function(){console.log("重置了！！！basehua"),this._curIdx=0;var i=0,t=this._cardsVec.length;for(i=0;t>i;i++)this._cardsVec[i].hide();this._tweenArr=[],this._isOverHua=!1},a(0,t,"view",function(){return wt.instance.gameContext.view}),a(0,t,"model",function(){return wt.instance.gameContext.model}),a(0,t,"controller",function(){return wt.instance.gameContext.controller}),a(0,t,"isOverHua",function(){return this._isOverHua}),i}(),nt=function(){function i(i,t,e,s){this._bottom=null,this._right=null,this._top=null,this._left=null,this._PosChairVec=[],this._bottom=new st(i),this._right=new st(t),this._top=new st(e),this._left=new st(s),this.allReset()}n(i,"modules.game.majiangGame.view.majiangPart.huaPart.HuaPart");var t=i.prototype;return t.allReset=function(){this._bottom.reset(),this._right.reset(),this._top.reset(),this._left.reset()},t.setChairNum=function(i){switch(void 0===i&&(i=3),this._PosChairVec.length=0,i){case 1:this._PosChairVec.push(this._bottom);break;case 2:this._PosChairVec.push(this._bottom,this._top);break;case 3:this._PosChairVec.push(this._bottom,this._right,this._left);break;case 4:this._PosChairVec.push(this._bottom,this._right,this._top,this._left);break;default:this._PosChairVec.push(this._bottom,this._right,this._left)}},t.reset=function(){var i=0,t=this._PosChairVec.length;for(i=0;t>i;i++)this._PosChairVec[i].reset()},t.showBuhuaCard=function(i,t,e,s,n){void 0===s&&(s=!1),void 0===n&&(n=!0);var a=this.model.getChairDirByPos(t);this._PosChairVec[a].showOneCard(t,i,e,s),1==n&&S.playSound(G.instance.getBuhua(this.model.playerByPos(this.model.selfChairPos).sex),1)},t.showBuhuaCards=function(i,t){var e=0,s=i.length;for(e=0;s>e;e++)this.showBuhuaCard(i[e],t,!1,!1,!1)},a(0,t,"model",function(){return wt.instance.gameContext.model}),a(0,t,"PosChairVec",function(){return this._PosChairVec}),i}(),at=function(){function i(){this.cardIdx=0,this.pos=0,this.isMopai=!1}return n(i,"modules.game.majiangGame.view.majiangPart.huaPart.HuaVo"),i}(),ot=function(){function i(i){this._skin=null,this.SingleCardW=0,this.SingleCardH=0,this.allCards=o(9,null),this._skin=i,this.SingleCardW=this._skin.card0.width,this.SingleCardH=this._skin.card0.height}n(i,"modules.game.majiangGame.view.majiangPart.hupaiTip.BaseSingleHupaiTipPart");var t=i.prototype;return t.showHuTip=function(i){this._skin.visible=!0;for(var t=0;t<i.length;t++)this.allCards[t].setCardImg(i[t]),this.allCards[t].show();for(t=i.length;t<this.allCards.length;t++)this.allCards[t].hide();this.setBackSize(i.length),this._skin.liangImg.visible=!0},t.showCanHuCards=function(i){this._skin.visible=!0;for(var t=0;t<i.length;t++)this.allCards[t].setCardImg(i[t]),this.allCards[t].show();for(t=i.length;t<this.allCards.length;t++)this.allCards[t].hide();this.setBackSize(i.length),this._skin.liangImg.visible=!1},t.setBackSize=function(){},t.reset=function(){this._skin.visible=!1},i}(),ht=function(){function i(i,t,e,s){this._bottom=null,this._right=null,this._top=null,this._left=null,this._PosChairVec=[],this._bottom=new Et(i),this._right=new Ht(t),this._top=new ot(e),this._left=new Ot(s),this.setChairNum(this.model.chairNum),this.allReset()}n(i,"modules.game.majiangGame.view.majiangPart.HupaiTipPart");var t=i.prototype;return t.setChairNum=function(i){switch(void 0===i&&(i=3),this._PosChairVec.length=0,i){case 1:this._PosChairVec.push(this._bottom);break;case 2:this._PosChairVec.push(this._bottom,this._top);break;case 3:this._PosChairVec.push(this._bottom,this._right,this._left);break;case 4:this._PosChairVec.push(this._bottom,this._right,this._top,this._left);break;default:this._PosChairVec.push(this._bottom,this._right,this._left)}},t.cancelShowHuTip=function(i){this._PosChairVec[this.model.getChairDirByPos(i)].reset()},t.reset=function(){var i=0,t=this._PosChairVec.length;for(i=0;t>i;i++)this._PosChairVec[i].reset()},t.showHuTip=function(i,t){11==E.roomtype?this._PosChairVec[this.model.getChairDirByPos(i)].showHuTip(t):0==this.model.getChairDirByPos(i)&&this._PosChairVec[this.model.getChairDirByPos(i)].showHuTip(t)},t.showCanHuCards=function(i,t){this._PosChairVec[this.model.getChairDirByPos(i)].showCanHuCards(t)},t.cancelTingpai=function(i){this._PosChairVec[this.model.getChairDirByPos(i)].reset()},t.allReset=function(){this._bottom.reset(),this._right.reset(),this._top.reset(),this._left.reset()},a(0,t,"model",function(){return wt.instance.gameContext.model}),i}(),rt=function(){function i(i){this._skin=null,this._skin=i}n(i,"modules.game.majiangGame.view.majiangPart.MajiangControlTipPage");var t=i.prototype;return t.show=function(i){this._skin.visible=!0,i!=this._skin.messageTf.text&&(this._skin.messageTf.text=i)},t.hide=function(){this._skin.visible=!1},t.reset=function(){this.hide()},i}(),lt=function(){function i(i,t,e,s,n){this._bottom=null,this._right=null,this._top=null,this._left=null,this._bottomTemp=null,this._rightTemp=null,this._topTemp=null,this._leftTemp=null,this._PosChairVec=[],this._posChairTemVec=[],this._bottom=new zt(i),this._right=new Yt(t),this._top=new Qt(e),this._left=new Wt(s),this._bottomTemp=new xt(n[0],!1,!1),this._bottomTemp.canControl=!1,this._rightTemp=new xt(n[1],!1,!1),this._rightTemp.canControl=!1,this._topTemp=new xt(n[2],!1,!1),this._topTemp.canControl=!1,this._leftTemp=new xt(n[3],!1,!1),this._leftTemp.canControl=!1,this.allReset()}n(i,"modules.game.majiangGame.view.majiangPart.OutputPart");var t=i.prototype;return t.allReset=function(){this._bottom.reset(),this._right.reset(),this._top.reset(),this._left.reset(),this._bottomTemp.reset(),this._rightTemp.reset(),this._topTemp.reset(),this._leftTemp.reset()},t.setChairNum=function(i){switch(void 0===i&&(i=3),this._PosChairVec.length=0,this._posChairTemVec.length=0,i){case 1:this._PosChairVec.push(this._bottom),this._posChairTemVec.push(this._bottomTemp);break;case 2:this._PosChairVec.push(this._bottom,this._top),this._posChairTemVec.push(this._bottomTemp,this._topTemp);break;case 3:this._PosChairVec.push(this._bottom,this._right,this._left),this._posChairTemVec.push(this._bottomTemp,this._rightTemp,this._leftTemp);break;case 4:this._PosChairVec.push(this._bottom,this._right,this._top,this._left),this._posChairTemVec.push(this._bottomTemp,this._rightTemp,this._topTemp,this._leftTemp);break;default:this._PosChairVec.push(this._bottom,this._right,this._left)}},t.reset=function(){var i=0,t=this._PosChairVec.length;for(i=0;t>i;i++)this._PosChairVec[i].reset(),this._posChairTemVec[i].reset()},t.showOneCard=function(i,t,e,s,n){void 0===s&&(s=!0),void 0===n&&(n=!0);var a=0,o=this._PosChairVec.length;for(a=0;o>a;a++)a==t?(this._PosChairVec[a].showOneCard(i,e,this.model.getChairPosByDir(a),n),s&&this._PosChairVec[a].showCurSimbol(s)):this._PosChairVec[a].isCurOutput&&this._PosChairVec[a].showCurSimbol(!1)},t.hideTemp=function(){var i=0,t=this._posChairTemVec.length;for(i=0;t>i;i++)this._posChairTemVec[i].hide()},t.showOneCardByPos=function(i,t,e,s){void 0===e&&(e=!0),void 0===s&&(s=!0);var n=this.model.getChairDirByPos(i),a=this._PosChairVec[n].curIdx+1;this.showOneCard(t,n,a,e,s)},t.showCardsByPos=function(i,t){var e=0,s=t.length;for(e=0;s>e;e++)this.showOneCardByPos(i,t[e],!1,!1)},t.toPre=function(){var i=0,t=this._PosChairVec.length;for(i=0;t>i;i++)this._PosChairVec[i].isCurOutput&&this._PosChairVec[i].toPre()},t.showCurSimbol=function(i){var t=0,e=this._PosChairVec.length;for(t=0;e>t;t++)this._PosChairVec[t].isCurOutput&&this._PosChairVec[t].showCurSimbol(i)},t.showStartImg=function(){var i=0,t=this._PosChairVec.length;for(i=0;t>i;i++)this._PosChairVec[i].showStartImg(!0)},t.showCurSimbolByPos=function(i){var t=this.model.getChairDirByPos(i);this._PosChairVec[t]&&this._PosChairVec[t].showCurSimbol(!0)},t.noticeHasPengGang=function(i){void 0===i&&(i=-1);var t=!1,e=0,s=this._PosChairVec.length;for(e=0;s>e;e++)if(this._PosChairVec[e].isCurOutput){this.model.pengGangStepObj[this.model.replayCurStep]=e,t=!0,this._PosChairVec[e]&&(this.model.cutOutput(this.model.getChairPosByDir(e),this._PosChairVec[e].curCardIdx),this._PosChairVec[e].curCardHasPengGang());break}if(0==t)if(E.isReplay){if(this.model.pengGangStepObj.hasOwnProperty(this.model.replayCurStep)){var n=this.model.getChairPosByDir(this.model.pengGangStepObj[this.model.replayCurStep]);this.model.cutOutput(n,this._PosChairVec[this.model.pengGangStepObj[this.model.replayCurStep]].curCardIdx),this._PosChairVec[this.model.pengGangStepObj[this.model.replayCurStep]].curCardHasPengGang()}}else if(-1!=i){var a=this.model.getChairDirByPos(i);this.model.pengGangStepObj[this.model.replayCurStep]=a,this._PosChairVec[a]&&(this.model.cutOutput(i,this._PosChairVec[a].curCardIdx),this._PosChairVec[a].curCardHasPengGang())}},t.noticeHasPengGangByPos=function(i){this.model.cutOutput(i,this._PosChairVec[this.model.getChairDirByPos(i)].curCardIdx),this._PosChairVec[this.model.getChairDirByPos(i)].curCardHasPengGang()},t.noticeHasTingByPos=function(i){this._PosChairVec[this.model.getChairDirByPos(i)].noticeHasTing()},t.getCurOutputCardIdx=function(){var i=0,t=this._PosChairVec.length;for(i=0;t>i;i++)if(this._PosChairVec[i].isCurOutput)return this._PosChairVec[i].curCardIdx;return 0},t.getCurOutIdx=function(){var i=0,t=this._PosChairVec.length;for(i=0;t>i;i++)if(this._PosChairVec[i].isCurOutput)return this.model.getChairPosByDir(i);return 0},t.showDianPaoHuAni=function(){var i=0,t=this._PosChairVec.length;for(i=0;t>i;i++)this._PosChairVec[i].isCurOutput&&this._PosChairVec[i].showHuAni(i)},t.showPreDiscardEff=function(i){var t=0;for(t=0;t<this.model.chairNum;t++)this._PosChairVec[t].showPreDiscardEff(i)},t.hidePreDiscardEff=function(){var i=0;for(i=0;i<this.model.chairNum;i++)this._PosChairVec[i].hidePreDiscardEff()},a(0,t,"controller",function(){return wt.instance.gameContext.controller}),a(0,t,"model",function(){return wt.instance.gameContext.model}),i.PERDIR_CARD_NUM=23,i}(),ct=function(){function i(i,t,e,s){this._bottom=null,this._right=null,this._top=null,this._left=null,this._PosChairVec=[],this._bottom=new Xt(i),this._right=new qt(t),this._top=new Jt(e),this._left=new Zt(s),this.allReset()}n(i,"modules.game.majiangGame.view.majiangPart.PengGangPart");var t=i.prototype;return t.allReset=function(){this._bottom.reset(),this._right.reset(),this._top.reset(),this._left.reset()},t.setChairNum=function(i){switch(void 0===i&&(i=3),this._PosChairVec.length=0,i){case 1:this._PosChairVec.push(this._bottom);break;case 2:this._PosChairVec.push(this._bottom,this._top);break;case 3:this._PosChairVec.push(this._bottom,this._right,this._left);break;case 4:this._PosChairVec.push(this._bottom,this._right,this._top,this._left);break;default:this._PosChairVec.push(this._bottom,this._right,this._left)}},t.reset=function(){var i=0,t=this._PosChairVec.length;for(i=0;t>i;i++)this._PosChairVec[i].reset()},t.chi=function(i,t){this._PosChairVec[this.model.getChairDirByPos(t)].chi(i,(this.model.chairNum+t-1)%this.model.chairNum,t)},t.recoveryChi=function(i,t){for(var e=0;e<i.length;e++)this.chi(i[e],t)},t.peng=function(i,t,e){void 0===e&&(e=0);var s=(this.model.chairNum+e-t)%this.model.chairNum;this._PosChairVec[this.model.getChairDirByPos(t)].peng(i,s,e,t)},t.recoveryPeng=function(i,t,e){for(var s=0;s<i.length;s++)this.peng(i[s],t,e[s])},t.gang=function(i,t,e,s){void 0===s&&(s=0);var n=(this.model.chairNum+s-t)%this.model.chairNum;this._PosChairVec[this.model.getChairDirByPos(t)].gang(i,e,n,s,t)},t.recoveryGang=function(i,t,e,s){for(var n=0;n<i.length;n++)this.gang(i[n],t,e,s[n])},t.setChengbaoGang=function(i,t){this._PosChairVec[this.model.getChairDirByPos(t)].setChengbaoGang(i)},t.showHuAni=function(i,t){var e=this.model.getChairDirByPos(i);this._PosChairVec[e].showHuAni(e,t)},t.showPreDiscardEff=function(i){var t=0,e=this.model.chairNum;for(t=0;e>t;t++)this._PosChairVec[t].showPreDiscardEff(i)},t.hidePreDiscardEff=function(){var i=0,t=this.model.chairNum;for(i=0;t>i;i++)this._PosChairVec[i].hidePreDiscardEff()},a(0,t,"model",function(){return wt.instance.gameContext.model}),i}(),dt=function(){function i(i){this._skin=null,this._value=0,this._shaizi0Time=0,this._shaizi1Time=0,this._skin=i,this._skin.shaizi0.interval=this._skin.shaizi1.interval=50}n(i,"modules.game.majiangGame.view.majiangPart.shaizi.ShaiziEffPage");var t=i.prototype;return t.onPlayComp=function(){this._skin.shaizi0.stop(),this._skin.shaizi1.stop(),this._skin.shaizi0.visible=!1,this._skin.shaizi1.visible=!1,this._skin.value0.visible=!0,this._skin.value1.visible=!0;var i=Math.max(this._value-6,1),t=i+Math.round((6-i)*Math.random());t>=this._value&&(t=this._value-1);var s=this._value-t;this._skin.value0.skin="gametable/shaizi/shaizi0"+t+".png",this._skin.value1.skin="gametable/shaizi/shaizi0"+s+".png",e.timer.once(2e3,this,this.onComp)
},t.onComp=function(){this.hide(),m.instance.event("GAME_START_SHAIZI_DONGFENG_COMP")},t.play=function(i){return console.log("playshazi/////////////"+i),this.show(),this._skin.shaizi0.visible=!0,this._skin.shaizi1.visible=!0,this._skin.value0.visible=!1,this._skin.value1.visible=!1,this._value=i,this._value<2||this._value>12?(x.popMessageBox("筛子值小于2或者大于12  "+this._value,"BTN_QUEREN",null,null,"错误"),void 0):(this._skin.shaizi0.play(Math.round(Math.random()*this._skin.shaizi0.count),!0),this._skin.shaizi1.play(Math.round(Math.random()*this._skin.shaizi1.count),!0),e.timer.once(1e3,this,this.onPlayComp),void 0)},t.reset=function(){this.hide()},t.show=function(){this._skin.visible=!0},t.hide=function(){this._skin.visible=!1},i}(),ut=function(){function i(i){this._bottom=null,this._right=null,this._top=null,this._left=null,this._middle=null,this._PosChairVec=[],this._bottom=new dt(i.bootomShaizi),this._right=new dt(i.rightShaizi),this._top=new dt(i.topShaizi),this._left=new dt(i.leftShaizi),this._middle=new dt(i.middleShaizi),this.allReset()}n(i,"modules.game.majiangGame.view.majiangPart.ShaiziPart");var t=i.prototype;return t.allReset=function(){this._bottom.reset(),this._right.reset(),this._top.reset(),this._left.reset(),this._middle.reset()},t.setChairNum=function(i){switch(void 0===i&&(i=3),this._PosChairVec.length=0,i){case 1:this._PosChairVec.push(this._bottom);break;case 2:this._PosChairVec.push(this._bottom,this._top);break;case 3:this._PosChairVec.push(this._bottom,this._right,this._left);break;case 4:this._PosChairVec.push(this._bottom,this._right,this._top,this._left);break;default:this._PosChairVec.push(this._bottom,this._right,this._left)}},t.reset=function(){var i=0,t=this._PosChairVec.length;for(i=0;t>i;i++)this._PosChairVec[i].reset();this._middle.reset()},t.play=function(i,t){if(-1==i)this._middle.play(t);else{var e=this.model.getChairDirByPos(i);if(null==this._PosChairVec[e])return x.popMessageBox("给的玩家的位置不在0到3！！","BTN_QUEREN",null,null,"错误"),void 0;this._PosChairVec[e].play(t)}},a(0,t,"model",function(){return wt.instance.gameContext.model}),i}(),gt=function(){function i(i){this._skin=null,this.expressUrl="res/swfs/",this._liangpaiMc=null,this._chiMc=null,this._pengMc=null,this._gangMc=null,this._huMc=null,this._zimoMc=null,this._dianpaoMc=null,this._curMc=null,this._curImg=null,this.loadedArr=[],this._skin=i,this.init(),this.hide()}n(i,"modules.game.majiangGame.view.majiangPart.singlePart.BaseHandleEffItem");var t=i.prototype;return t.init=function(){},t.show=function(){this._skin.visible=!0},t.hide=function(){this._skin.visible=!1},t.showEff=function(i){switch(console.log("showEff::"+i),this.show(),this._skin.pengImg.visible=!1,this._skin.gangImg.visible=!1,this._skin.huImg.visible=!1,this._skin.liangpaiImg.visible=!1,this._skin.chiImg.visible=!1,this._skin.dianpaoImg.visible=!1,this._skin.zimoImg.visible=!1,i){case 0:this._pengMc?this.onLoaded(this._pengMc):(this._pengMc=new I,this._pengMc.load(this.expressUrl+"peng.swf",!0),this._skin.pengImg.addChild(this._pengMc),this._pengMc.on("loaded",this,this.onLoaded,[this._pengMc])),this._curMc=this._pengMc,this._curImg=this._skin.pengImg,this._skin.pengImg.visible=!0;break;case 1:this._gangMc?this.onLoaded(this._gangMc):(this._gangMc=new I,this._gangMc.load(this.expressUrl+"gang.swf",!0),this._skin.gangImg.addChild(this._gangMc),this._gangMc.on("loaded",this,this.onLoaded,[this._gangMc])),this._curMc=this._gangMc,this._curImg=this._skin.gangImg,this._skin.gangImg.visible=!0;break;case 2:this._huMc?this.onLoaded(this._huMc):(this._huMc=new I,this._huMc.load(this.expressUrl+"hu.swf",!0),this._skin.huImg.addChild(this._huMc),this._huMc.on("loaded",this,this.onLoaded,[this._huMc])),this._curMc=this._huMc,this._curImg=this._skin.huImg,this._skin.huImg.visible=!0;break;case 3:this._skin.liangpaiImg.visible=!0,this.hide();break;case 4:this._chiMc?this.onLoaded(this._chiMc):(this._chiMc=new I,this._chiMc.load(this.expressUrl+"chi.swf",!0),this._skin.chiImg.addChild(this._chiMc),this._chiMc.on("loaded",this,this.onLoaded,[this._chiMc])),this._curMc=this._chiMc,this._curImg=this._skin.chiImg,this._skin.chiImg.visible=!0;break;case 5:this._dianpaoMc?this.onLoaded(this._dianpaoMc):(this._dianpaoMc=new I,this._dianpaoMc.load(this.expressUrl+"dianpao.swf",!0),this._skin.dianpaoImg.addChild(this._dianpaoMc),this._dianpaoMc.on("loaded",this,this.onLoaded,[this._dianpaoMc])),this._curMc=this._dianpaoMc,this._curImg=this._skin.dianpaoImg,this._skin.dianpaoImg.visible=!0;break;case 6:this._zimoMc?this.onLoaded(this._zimoMc):(this._zimoMc=new I,this._zimoMc.load(this.expressUrl+"zimo.swf",!0),this._skin.zimoImg.addChild(this._zimoMc),this._zimoMc.on("loaded",this,this.onLoaded,[this._zimoMc])),this._curMc=this._zimoMc,this._curImg=this._skin.zimoImg,this._skin.zimoImg.visible=!0}e.timer.once(800,this,this.playEnd)},t.onLoaded=function(i){i.loop=!1,this._curMc=i,i.playTo(0,i.count,v.create(this,this.playEnd)),e.timer.frameLoop(1,this,this.onCheck)},t.onCheck=function(){this._curMc?0==this._curMc.playing&&(this.hide(),e.timer.clear(this,this.onCheck)):(this.hide(),e.timer.clear(this,this.onCheck))},t.playEnd=function(){this._curMc&&this._curMc.stop(),this.hide()},i.HANDLEEFF_TYPE_PENG=0,i.HANDLEEFF_TYPE_GANG=1,i.HANDLEEFF_TYPE_HU=2,i.HANDLEEFF_TYPE_LIANGPAI=3,i.HANDLEEFF_TYPE_CHI=4,i.HANDLEEFF_TYPE_DIANPAO=5,i.HANDLEEFF_TYPE_ZIMO=6,i}(),mt=function(){function i(i){this._theFourteenCard=null,this._OrignalX=0,this._OrignalY=0,this._SingleCardW=0,this._SingleCardH=0,this.skin=null,this.tingImg=null,this.needTingEff=!1,this._preThirteenCards=o(13,null),this.skin=i}n(i,"modules.game.majiangGame.view.majiangPart.singlePart.BaseSingleHandlePart");var t=i.prototype;return t.up=function(){var i=0,t=this._preThirteenCards.length;for(i=0;t>i;i++)this._preThirteenCards[i].up();this._theFourteenCard.up()},t.down=function(){var i=0,t=this._preThirteenCards.length;for(i=0;t>i;i++)this._preThirteenCards[i].down();this._theFourteenCard.down()},t.back=function(){var i=0,t=this._preThirteenCards.length;for(i=0;t>i;i++)this._preThirteenCards[i].back();this._theFourteenCard.back()},t.setPreThirteenCards=function(i,t,e,s){if(void 0===e&&(e=!0),void 0===s&&(s=!0),l.autoPlay){var n=0;-1!=this.model.theFourteenCardVec[this.model.getChairPosByDir(t)]&&(n=1),3*this.model.getPengGangNum(this.model.getChairPosByDir(t))+i.length+n>14}var a=0,o=this.model.getChairPosByDir(t),h=this.model.TingDownCardVec[o],r=this.model.kouVec[this.model.getChairPosByDir(t)],c=this._preThirteenCards.length,d=i.length;if(console.log("cardArr.length::"+i.length),11==E.roomtype)for(a=0;c>a;a++)c-d>a?this._preThirteenCards[a].hide():(this.model.isTingVec[this.model.getChairPosByDir(t)]||this.model.isHu||E.isReplay?this.model.isHu||E.isReplay?(this._preThirteenCards[a].down(),this._preThirteenCards[a].removeTingEff()):this.model.isTingVec[this.model.getChairPosByDir(t)]&&(this._preThirteenCards[a].removeTingEff(),a<c-d+h.length?this._preThirteenCards[a].down():a<c-d+h.length+3*r.length?e&&(0!=t?this._preThirteenCards[a].back():this.model.isSelfSitDown||0!=t?this._preThirteenCards[a].up():this._preThirteenCards[a].back()):this.model.isSelfSitDown||0!=t?this._preThirteenCards[a].up():this._preThirteenCards[a].back()):this.model.isSelfSitDown||0!=t?this._preThirteenCards[a].up():this._preThirteenCards[a].back(),this._preThirteenCards[a].show(),this._preThirteenCards[a].setCardImg(i[a-(c-d)]));else for(a=0;c>a;a++)c-d>a?this._preThirteenCards[a].hide():(this.model.isHu||E.isReplay?(this._preThirteenCards[a].down(),a<c-d+3*r.length&&e&&this._preThirteenCards[a].back()):this.model.isTingVec[this.model.getChairPosByDir(t)]?(this._preThirteenCards[a].removeTingEff(),this.model.getChairPosByDir(t)==this.model.selfChairPos?this.model.isSelfSitDown||0!=t?this._preThirteenCards[a].up():this._preThirteenCards[a].back():this._preThirteenCards[a].back()):this.model.isSelfSitDown||0!=t?this._preThirteenCards[a].up():this._preThirteenCards[a].back(),this._preThirteenCards[a].show(),this._preThirteenCards[a].setCardImg(i[a-(c-d)]));s&&(d%3==2?this.movePeng(!0):this.movePeng(!1)),this.setTingImgXAndW(d)},t.playQipaiEff=function(){var i=0,t=this._preThirteenCards.length;for(i=0;t>i;i++)this._preThirteenCards[i].skin.alpha=0,e.timer.frameOnce(i,this,this.onSingleQiEff,[i],!1);this._theFourteenCard.skin.alpha=0,e.timer.frameOnce(14,this,this.onSingleFQiEff,null)},t.onSingleQiEff=function(i){M.to(this._preThirteenCards[i].skin,{alpha:1},100)},t.onSingleFQiEff=function(){this._theFourteenCard.skin.alpha=1},t.setTheFourteenCard=function(i,t){return-1==i?(this._theFourteenCard.hide(),void 0):(this.model.isTingVec[this.model.getChairPosByDir(t)]||this.model.isHu||E.isReplay?(this.model.isHu||E.isReplay?this._theFourteenCard.down():this.model.isTingVec[this.model.getChairPosByDir(t)]?0!=t?this.model.isSelfSitDown||0!=t?this._theFourteenCard.up():this._theFourteenCard.back():this._theFourteenCard.back():this._theFourteenCard.down(),this._theFourteenCard.removeTingEff()):this.model.isSelfSitDown||0!=t?this._theFourteenCard.up():this._theFourteenCard.back(),console.log("cardIdx ::"+i),this._theFourteenCard.setCardImg(i),this._theFourteenCard.show(),void 0)},t.canControlWitchDark=function(){},t.reset=function(){var i=0,t=this._preThirteenCards.length;for(i=0;t>i;i++)this._preThirteenCards[i].reset();this._theFourteenCard.reset(),null!=this.tingImg&&(this.tingImg.visible=!1),this.movePeng(!1)},t.show=function(){},t.hide=function(){},t.showCanTingCards=function(i){console.log("showCanTingCards .... jinlaila");var t=0,e=0,s=i.length,n=this._preThirteenCards.concat(this._theFourteenCard),a=n.length;for(console.log("newArr.length :: "+a),t=0;a>t;t++)console.log("newArr[i].visible ::"+n[t].visible+"i"+t),n[t].visible&&2!=n[t].state&&(n[t].down(),n[t].showTingState(!1),console.log("newArr  i:: "+t)+"  down");for(t=0;s>t;t++)for(e=a-1;e>=0;e--)if(n[e].visible&&n[e].cardIdx==i[t]&&2!=n[e].state){0==this.judegCanTingOut(n[e].cardIdx)&&n[e].showTingState(!0);break}},t.judegCanTingOut=function(){return!1},t.cancelTingpai=function(){console.log("showCanTingCards .... jinlaila");var i=0,t=this._preThirteenCards.concat(this._theFourteenCard),e=t.length;for(console.log("newArr.length :: "+e),i=0;e>i;i++)console.log("newArr[i].visible ::"+t[i].visible+"i"+i),t[i].visible&&2!=t[i].state&&(t[i].up(),t[i].cancleTingState(),console.log("newArr  i:: "+i)+"  down")},t.showCanKouCards=function(i){var t=0,e=0,s=i.length,n=this._preThirteenCards.concat(this._theFourteenCard),a=n.length;for(t=0;a>t;t++)n[t].visible&&2!=n[t].state&&(n[t].down(),n[t].showKouState(!1));for(t=0;s>t;t++)for(e=0;a>e;e++)n[e].visible&&n[e].cardIdx==i[t]&&(console.log("显示 showKouState ：：："),n[e].showKouState(!0))},t.showCancelKouCards=function(){var i=0,t=this._preThirteenCards.concat(this._theFourteenCard),e=t.length;for(i=0;e>i;i++)t[i].visible&&(t[i].down(),t[i].showKouState(!1))},t.showTempKouCards=function(i){var t=0,e=this._preThirteenCards.concat(this._theFourteenCard),s=e.length,n=0,a=3;for(t=0;s>t;t++)e[t].visible&&e[t].cardIdx==i&&(a>n&&e[t].back(),e[t].canControl=!1,n++)},t.showTinged=function(){null!=this.tingImg&&this.needTingEff&&(this.tingImg.visible=!0)},t.setTingImgXAndW=function(){},t.showCanGangCards=function(i){var t=0,e=0,s=[];for(t=0;t<i.length;t++)console.log("showCanGangCards cards.card::"+i[t].card),s.push(i[t].card);var n=this._preThirteenCards.concat(this._theFourteenCard);for(e=n.length,t=0;e>t;t++)n[t].visible&&(n[t].canControlWitchDark=-1!=s.indexOf(n[t].cardIdx)?!0:!1)},t.showHuAni=function(i){this._theFourteenCard.showHuAni(this.model.getChairDirByPos(i))},t.movePeng=function(){},t.judgeEveryCanTing=function(){},t.showPreDiscardEff=function(i){var t=0,e=this._preThirteenCards.concat(this._theFourteenCard),s=e.length;for(t=0;s>t;t++)e[t].visible&&e[t].cardIdx==i&&0==e[t].skin.y?x.addRed(e[t].skin,!0):x.addRed(e[t].skin,!1)},t.hidePreDiscardEff=function(){var i=0,t=this._preThirteenCards.concat(this._theFourteenCard),e=t.length;for(i=0;e>i;i++)x.addRed(t[i].skin,!1)},a(0,t,"canControl",null,function(){}),a(0,t,"visible",function(){return!1}),a(0,t,"model",function(){return wt.instance.gameContext.model}),i}(),ft=function(){function i(){this._curIdx=-1,this._isCurOutput=!1,this._cardsVec=o(27,null)}n(i,"modules.game.majiangGame.view.majiangPart.singlePart.BaseSingleOutputPart");var t=i.prototype;return t.toPre=function(){this._cardsVec[this._curIdx].hide(),this._curIdx-=1,this.showCurSimbol(!0)},t.show=function(){},t.hide=function(){},t.showOneCard=function(i,t,s,n){if(void 0===n&&(n=!0),t<this._cardsVec.length){if(this._cardsVec[t].setCardImg(i),this._cardsVec[t].down(),this._curIdx=t,n){var a,o=this.model.getChairDirByPos(s),h=0,r=0,l=this._cardsVec[t].skin;switch(o){case 0:E.isReplay?(h=535,r=181):null==this.model.selfOutputCardPos?(h=535,r=181):-1!=this.model.selfOutputCardPos.x?(a=x.globalToLocal(l,this.model.selfOutputCardPos,!0),h=a.x,r=a.y):(h=535,r=181);break;case 1:h=160,r=-67;break;case 2:3==this.model.chairNum&&(h=-53,r=276);break;case 3:}this._cardsVec[t].skin.alpha=1,M.from(this._cardsVec[t].skin,{alpha:0},700,g.cubicOut),e.timer.frameOnce(2,this,this.showCard)}else this._cardsVec[this._curIdx]&&this._cardsVec[this._curIdx].show();this.model.selfOutputCardPos.x=-1,this.model.selfOutputCardPos.y=-1}},t.showCard=function(){this._cardsVec[this._curIdx]&&this._cardsVec[this._curIdx].show()},t.reset=function(){this._curIdx=-1;var i=0,t=this._cardsVec.length;for(i=0;t>i;i++)this._cardsVec[i].hide(),this._cardsVec[i].skin.alpha=1,this._cardsVec[i].makeTingState(!1);this.showCurSimbol(!1)},t.showCurSimbol=function(i){var t=0,e=this._cardsVec.length;if(i)for(t=0;e>t;t++)t==this._curIdx?this._cardsVec[t].showCurOutputSimbol(i):this._cardsVec[t].showCurOutputSimbol(!i);else for(t=0;e>t;t++)this._cardsVec[t].showCurOutputSimbol(i);this._isCurOutput=i},t.curCardHasPengGang=function(){this._cardsVec[this._curIdx].hide(),this._cardsVec[this._curIdx].makeTingState(!1),this._curIdx-=1},t.noticeHasTing=function(){this._cardsVec[this._curIdx].makeTingState(!0)},t.showStartImg=function(i){void 0===i&&(i=!0)},t.showHuAni=function(i){this._cardsVec[this._curIdx].showHuAni(i,!0)},t.showPreDiscardEff=function(i){var t=0,e=this._cardsVec.length;for(t=0;e>t;t++)this._cardsVec[t].skin.visible&&this._cardsVec[t].cardIdx==i&&t<=this._curIdx?x.addRed(this._cardsVec[t].skin,!0):x.addRed(this._cardsVec[t].skin,!1)},t.hidePreDiscardEff=function(){var i=0,t=this._cardsVec.length;for(i=0;t>i;i++)x.addRed(this._cardsVec[i].skin,!1)},a(0,t,"curIdx",function(){return this._curIdx},function(i){this._curIdx=i}),a(0,t,"isCurOutput",function(){return this._isCurOutput}),a(0,t,"model",function(){return wt.instance.gameContext.model}),a(0,t,"curCardIdx",function(){return-1==this._curIdx?0:this._cardsVec[this._curIdx].cardIdx}),i}(),pt=function(){function i(){this._curIdx=-1,this._cardsVec=o(4,null)}n(i,"modules.game.majiangGame.view.majiangPart.singlePart.BaseSinglePengGangPart");var t=i.prototype;return t.show=function(){},t.hide=function(){},t.chi=function(i,t,e){if(void 0===t&&(t=0),void 0===e&&(e=0),!(this._curIdx>=this._cardsVec.length)){var s=[];s.push(i.chicard),s=s.concat(i.chicards),s.sort(this.compareFunction),this._curIdx+=1,this._cardsVec[this._curIdx].chi(s,i.chicard,t);for(var n=0;n<this._cardsVec.length;n++)this._cardsVec[n].updateChengbaoColor(e,t)}},t.compareFunction=function(i,t){return t>i?-1:i==t?0:1},t.peng=function(i,t,e,s){if(void 0===i&&(i=0),void 0===t&&(t=-1),void 0===e&&(e=0),void 0===s&&(s=0),!(this._curIdx>=this._cardsVec.length)){this._curIdx+=1,this._cardsVec[this._curIdx].peng(i,t,e);for(var n=0;n<this._cardsVec.length;n++)this._cardsVec[n].updateChengbaoColor(s,e)}},t.gang=function(i,t,e,s,n){void 0===e&&(e=-1),void 0===s&&(s=0),void 0===n&&(n=0);var a=1==t?!1:!0,o=0;if(0!=t){for(o=0;o<this._curIdx+1;o++)if(this._cardsVec[o].cardIdx==i)return;if(this._curIdx>=this._cardsVec.length)return;this._curIdx+=1,this._cardsVec[this._curIdx].gang(i,a,e,s)}else{for(o=0;o<this._curIdx+1;o++)if(this._cardsVec[o].cardIdx==i)return this._cardsVec[o].gang(i,a,e,s),void 0;if(this._curIdx>=this._cardsVec.length)return;this._curIdx+=1,this._cardsVec[o].gang(i,a,e,s)}for(o=0;o<this._cardsVec.length;o++)this._cardsVec[o].updateChengbaoColor(n,s)},t.setChengbaoGang=function(i){var t=0,e=this._cardsVec.length;for(t=0;e>t;t++)3==this._cardsVec[t].type&&this._cardsVec[t].cardIdx==i&&this._cardsVec[t].setChengbaoGang()},t.setCardImg=function(i){this._cardsVec[this._curIdx].setCardImg(i)},t.update=function(){this.reset()},t.reset=function(){var i=0,t=this._cardsVec.length;for(i=0;t>i;i++)this._cardsVec[i].reset();this._curIdx=-1},t.showHuAni=function(i,t){var e=0;for(e=0;e<this._curIdx+1;e++)if(this._cardsVec[e].cardIdx==t){this._cardsVec[e].showHuAni(i),console.log("penggang showHuAni:: i"+e+" dir::"+i);break}},t.showPreDiscardEff=function(i){var t=0,e=this._cardsVec.length;for(t=0;e>t;t++)0==this._cardsVec[t].type||1==this._cardsVec[t].type?this._cardsVec[t].showPreDiscardEff(i):this._cardsVec[t].hidePreDiscardEff()},t.hidePreDiscardEff=function(){var i=0,t=this._cardsVec.length;for(i=0;t>i;i++)this._cardsVec[i].hidePreDiscardEff()},a(0,t,"visible",function(){return!1}),a(0,t,"model",function(){return wt.instance.gameContext.model}),i}(),_t=function(){function i(i){this._skin=null,this._bottom=null,this._right=null,this._top=null,this._left=null,this._PiaoSelePart=null,this._PosChairVec=[],this._skin=i,this._skin.mouseThrough=!0,this._bottom=new Ct(i.playerInfo0),this._right=new Ct(i.playerInfo1),this._top=new Ct(i.playerInfo2),this._left=new Ct(i.playerInfo3),this._PiaoSelePart=new Pt(this._skin.piaoPart),this._skin.startBtn.visible=!1,this._skin.startBtn.on("click",this,this.onClickStartBtn),this.allReset()}n(i,"modules.game.majiangGame.view.PlayerInfoPage");var t=i.prototype;return t.onClickStartBtn=function(){this.showStartBtn(!1);var i={SID:E.SID};this.controller.sendMsgCommond(T.getProtoMessage(220,i))},t.showStartBtn=function(i){void 0===i&&(i=!0),this._skin.startBtn.visible=i},t.onClickReadyBtn=function(){var i={sid:E.SID};this.controller.sendMsgCommond(T.getProtoMessage(210,i))},t.hideBtnsByGameStart=function(){this._skin.startBtn.visible=!1,this._PiaoSelePart.hide()},t.updateStartBtn=function(){this._skin.startBtn.visible=!1},t.updateSitDownUpBtn=function(i){void 0===i&&(i=!0),i?this.model.isSelfSitDown&&0==this.model.isGameStart?u.instance.commonContext.view.functionOption.onClickBtn(!1):u.instance.commonContext.view.functionOption.onClickBtn(!0):this.model.isSelfSitDown?u.instance.commonContext.view.functionOption.onClickBtn(!1):u.instance.commonContext.view.functionOption.onClickBtn(!0)},t.showZhuang=function(){var i=0,t=this._PosChairVec.length;for(i=0;t>i;i++)this._PosChairVec[i].showZhuang(this.model.getChairPosByDir(i))},t.hideZhuang=function(){var i=0,t=this._PosChairVec.length;for(i=0;t>i;i++)this._PosChairVec[i].hideZhuang()},t.hideReadyBtn=function(){},t.allReset=function(){this._bottom.reset(),this._right.reset(),this._top.reset(),this._left.reset(),this._PiaoSelePart.reset()},t.setChairNum=function(i){switch(void 0===i&&(i=3),this._PosChairVec.length=0,console.log("playerinfo setChairNum::"+i),i){case 1:this._PosChairVec.push(this._bottom),this._bottom.dir=0;break;case 2:this._PosChairVec.push(this._bottom,this._top),this._bottom.dir=0,this._top.dir=1;break;case 3:this._PosChairVec.push(this._bottom,this._right,this._left),this._bottom.dir=0,this._right.dir=1,this._left.dir=2;break;case 4:this._PosChairVec.push(this._bottom,this._right,this._top,this._left),this._bottom.dir=0,this._right.dir=1,this._top.dir=2,this._left.dir=3;break;default:this._PosChairVec.push(this._bottom,this._right,this._left)}this.bigReset()},t.bigReset=function(){this._skin.startBtn.visible=!1},t.reset=function(){var i=0,t=this._PosChairVec.length;for(i=0;t>i;i++)this._PosChairVec[i].reset();this.updateSitDownUpBtn()},t.havePiaoReset=function(){var i=0,t=this._PosChairVec.length;for(i=0;t>i;i++)this._PosChairVec[i].reset(!0);this._PiaoSelePart.reset()},t.resetOnePos=function(i){var t=this.model.getChairDirByPos(i);this._PosChairVec[t].reset()},t.hideReadySimbol=function(){var i=0,t=this._PosChairVec.length;for(i=0;t>i;i++)this._PosChairVec[i].hideReadySimbol()},t.showVoice=function(i){var t=this.model.getPlayerPosByUid(i),e=this.model.getChairDirByPos(t);console.log(e),-1==e?(this._skin.laba.visible=!0,this._skin.labaTip.play()):(this._PosChairVec[e].voice.visible=!0,this._PosChairVec[e].voice.ani.play())},t.hideVoice=function(i){var t=this.model.getPlayerPosByUid(i),e=this.model.getChairDirByPos(t);-1==e?(this._skin.laba.visible=!1,this._skin.labaTip.stop()):(this._PosChairVec[e].voice.visible=!1,this._PosChairVec[e].voice.ani.stop())},t.showReady=function(i){var t=this.model.getChairDirByPos(i);this._PosChairVec[t].showReady()},t.updateOnePlayerInfo=function(i,t){if(void 0===t&&(t=!1),-1!=i.pos){var e=this.model.getChairDirByPos(i.pos);e<this._PosChairVec.length&&this._PosChairVec[e].update(i,t)}},t.updateOnePlayerGolds=function(i){var t=this.model.getChairDirByPos(i.pos);t<this._PosChairVec.length&&(console.log("   updateOnePlayerInfo ::"+t+" obj.pos::"+i.pos),this._PosChairVec[t].updateGolds(i))},t.updatePlayerInfos=function(i,t,e){void 0===t&&(t=!0),void 0===e&&(e=!1),console.log("updatePlayerInfos ::"+i.length),this.reset(),t&&this._PiaoSelePart.reset();var s=0,n=i.length;for(s=0;n>s;s++)i[s]&&(console.log("updatePlayerInfos i::"+s),this.updateOnePlayerInfo(i[s],e))},t.updateHua=function(i){if(-1!=i){var t=this.model.getChairDirByPos(i);this._PosChairVec[t].updateHua(i)}},t.updateGolds=function(i){console.log("updatePlayerInfos ::"+i.length),console.log(i);var t=0,e=i.length;for(t=0;e>t;t++)i[t]&&(console.log("updatePlayerInfos i::"+t),this.updateOnePlayerGolds(i[t]))},t.updateTingImg=function(i){var t=this.model.getChairDirByPos(i);this._PosChairVec[t].showTingImg()},t.updateTirenBtn=function(){var i=0,t=this._PosChairVec.length;for(i=0;t>i;i++)this._PosChairVec[i].updateTirenBtn()},t.showExpress=function(i,t){this._PosChairVec[i].showExpress(t)},t.setGrayhead=function(i,t,e,s){this._PosChairVec[i].setHeadGray(t,e,s)},a(0,t,"model",function(){return wt.instance.gameContext.model}),a(0,t,"controller",function(){return wt.instance.gameContext.controller}),i}(),Ct=function(){function i(i){this.needPiao=!1,this._skin=null,this.zhenghuaBox=null,this.yehuaBox=null,this.huaTf_z=null,this.huaTf_y=null,this.huaImg_z=null,this.huaImg_y=null,this.headImg=null,this.nameTf=null,this.recordTf=null,this.readyImg=null,this.tingpaiImg=null,this.gangEff=null,this.tirenBtn=null,this.sitDownBtn=null,this.offlineTf=null,this.fenshuTf=null,this.voice=null,this.headw=0,this.headh=0,this.dir=0,this.expressImg=null,this.expressMov=null,this.expressUrl="res/swfs/Emoticon_",this.piaoImg=null,this.playingPiaoImg=null,this.offlineimg=null,this.gangAni=null,this._skin=i,this.init()}n(i,"modules.game.majiangGame.view.playerInfoPart.BasePlayerInfoItem");var t=i.prototype;return t.init=function(){this._skin.mouseThrough=!0,this._skin.haveBox.mouseThrough=!0,this.zhenghuaBox=this._skin.zhenghuaBox,this.yehuaBox=this._skin.yehuaBox,this.huaTf_z=this._skin.huaTf_z,this.huaTf_y=this._skin.huaTf_y,this.huaImg_z=this._skin.huaZhenhua,this.huaImg_y=this._skin.huaYehua,this.zhenghuaBox.visible=!1,this.yehuaBox.visible=!1,this.huaTf_z.visible=!0,this.huaTf_y.visible=!0,this.huaImg_y.visible=!1,this.huaImg_z.visible=!0,this.offlineTf=this._skin.offlineTf,this.offlineTf.overflow="visible",this.piaoImg=this._skin.piaoImg,this.playingPiaoImg=this._skin.playingPiaoImg,this.headImg=this._skin.headImg,this.nameTf=this._skin.nameTf,this.recordTf=this._skin.recordTf,this.readyImg=this._skin.readyImg,this.voice=this._skin.voice,this.tingpaiImg=this._skin.mingpaiPic,this.gangEff=this._skin.gangEff,this.fenshuTf=this._skin.fenshuTf,this.tirenBtn=this._skin.tirenBtn,this.expressImg=this._skin.express,this.offlineimg=this._skin.offline,this.sitDownBtn=this._skin.sitdownBtn,this.tirenBtn.visible=!1,this.voice.visible=!1,this.offlineimg.visible=!1,this.headw=this.headImg.width,this.headh=this.headImg.height,this.loadGangEff(),this.loadExpressMov(),this.tirenBtn.on("click",this,this.onClickTiren),this.sitDownBtn.on("click",this,this.onClickSitdown)},t.onClickSitdown=function(){if(E.isCanSitdown){if(this.model.isSelfSitDown)return this.onConFirm(0),void 0;if(this.model.majiangMsgs.ACK_RoomInfo.RoundCount>0)return x.popMessage("接替之前的玩家进行游戏不收费，祝您游戏愉快！"),this.onConFirm(0),void 0;var i=this.model.majiangMsgs.ACK_RoomInfo,t=i.Rule,e=l.getRule(t[1]),s="";s=0==e.type?"局数":"时间";var n="本游戏工具为收费软件，按游戏"+s+"扣除钻石。坐下不扣钱，开始游戏后才会扣钱，开始游戏后不予退还。是否花费"+l.costRule[E.roomtype][t[1]]/4+"钻石加入牌局？";x.popMessageBox(n,"BTN_LABEL_QUEDINGQUXIAO",this,this.onConFirm,"提示","left")}},t.onConFirm=function(i){if(0==i){if(!E.isCanSitdown)return;var t={sid:E.SID,index:this.model.getChairPosByDir(this.dir)};this.controller.sendMsgCommond(T.getProtoMessage(195,t)),E.isCanSitdown=!1,e.timer.once(400,this,this.restCanSitdown)}},t.restCanSitdown=function(){E.isCanSitdown=!0,e.timer.clear(this,this.restCanSitdown)},t.onClickTiren=function(){return 0==this.model.isSelfSitDown?(x.popMessage("围观用户没有权限踢人"),void 0):(this.model.isGameStart?x.popMessageBox("踢人会导致当前游戏流局，确认踢人吗？","BTN_LABEL_QUEDINGQUXIAO",this,this.onConFirmTiren,"提示","left"):this.onConFirmTiren(0),void 0)},t.onConFirmTiren=function(i){if(0==i){var t={pos:this.model.getChairPosByDir(this.dir)};this.controller.sendMsgCommond(T.getProtoMessage(405,t))}},t.loadGangEff=function(){this.gangEff.removeChildren(),this.gangEff.skin="",this.gangAni=new r,this.gangAni.loadAtlas("res/animations/gangaddEff.json"),console.log("loadGangEff///////////////"),this.gangAni.stop(),this.gangEff.addChild(this.gangAni),this.gangAni.on("complete",this,this.onGangAniComp)},t.loadExpressMov=function(){this.expressImg.removeChildren(),this.expressImg.skin="",this.expressMov=new I,this.expressMov.width=200,this.expressMov.height=200,this.expressImg.addChild(this.expressMov),this.expressMov.on("complete",this,this.onCompleteMov)},t.showExpress=function(i){null!=this.expressMov&&(this.expressMov.alpha=1,M.clearAll(this.expressMov),this.expressMov.parent&&this.expressMov.removeSelf()),this.expressMov=new I,this.expressMov.width=200,this.expressMov.height=200,this.expressMov.x=-85,this.expressMov.y=-85,this.expressImg.addChild(this.expressMov),this.expressMov.visible=!0,this.expressMov.alpha=1,10>i?this.expressMov.load(this.expressUrl+"0"+i+".swf",!0):this.expressMov.load(this.expressUrl+i+".swf",!0),M.to(this.expressMov,{alpha:.3},500,null,new v(this,this.onCompeteTween,[null]),2500)},t.onCompeteTween=function(){null!=this.expressMov&&(this.expressMov.visible=!1,this.expressMov.alpha=1,this.expressMov.parent&&this.expressMov.removeSelf(),this.expressMov=null)},t.onCompleteMov=function(){},t.onGangAniComp=function(){this.gangEff.visible=!1,this.gangAni.stop()},t.playGangEff=function(i){0!=i&&(i>0?(this.gangEff.visible=!0,this.gangAni.play(0,!1),this.fenshuTf.color="#00ff00"):(this.gangEff.visible=!1,this.gangAni.stop(),this.fenshuTf.color="#ff0000"),this.fenshuTf.visible=!0,this.fenshuTf.text=i>0?"+"+i:i+"",this.fenshuTf.y=104,M.to(this.fenshuTf,{y:64},2e3,null,v.create(this,this.onFenshuEffComp),2))},t.onFenshuEffComp=function(){this.fenshuTf.visible=!1},t.update=function(i,t){void 0===t&&(t=!1),this.sitDownBtn.visible=!1,this._skin.haveBox.visible=!0,void 0==i.score&&(i.score=0),this.nameTf.text=i.nickname,this.recordTf.text=1==E.Rule[4]?i.Coin:""+i.score,E.uid==i.uid&&(E.Diamond=i.Diamond,E.score=i.score,E.Coin=i.Coin),1==i.readystate?(0==this.model.isGameStart&&(this.readyImg.visible=!0),this.setPiaoValue(i.piao),console.log("obj.piao::"+i.piao),this.showPiaoImage(this.model.isGameStart)):(this.readyImg.visible=!1,this.hidePiaoImage());var e=wt.instance.gameContext.model.getPlayerPosByUid(i.uid);if(this.tingpaiImg.visible=wt.instance.gameContext.model.isTingVec[e],this._skin.chairPos.text="座位号："+e,this._skin.chairPos.visible=!1,this.headImg.width=this.headw,this.headImg.height=this.headh,this.headImg.on("click",this,this.onShowUserInfo,[i]),"h"==H.splitStr(i.Icon,"")[0]){var s=new j;s.loadImage(i.Icon,0,0,this.headw,this.headh,v.create(this,this.delayPhotoPhoto,[s,s])),s.mouseEnabled=!0,this.headImg.addChild(s)}var n=!1;2==i.state&&(n=!0),this.setHeadGray(n,!0,i.offlineTime),this.updateTirenBtn(),t&&this.playFlyHeadImg(this.model.getChairDirByPos(i.prePos))},t.onShowUserInfo=function(i){kt.instance.show(i.uid,i.ip,i.Icon)},t.delayPhotoPhoto=function(){},t.updateGolds=function(i){this.recordTf.x=0,this.recordTf.y=1;var t=this.recordTf.text;this.recordTf.scaleX=this.recordTf.scaleY=.6,this.recordTf.x=0,this.recordTf.y=-2,i.score>=0?(this.recordTf.font=D.NumberYellowFont,this.recordTf.text=""+i.score,i.score/10<1?this.recordTf.x+=14:i.score/10<10?this.recordTf.x+=6:i.score/10<100?this.recordTf.x+=-2:i.score/10<1e3&&(this.recordTf.x+=-10)):(this.recordTf.font=D.NumberYellowFont,this.recordTf.text=i.score+"",i.score/10>-1?this.recordTf.x+=2:i.score/10>-10?this.recordTf.x+=-4:i.score/10>-100?this.recordTf.x+=-12:i.score/10>-1e3&&(this.recordTf.x+=-22)),this.playGangEff(i.score-t)},t.updateHua=function(i){this.zhenghuaBox.visible=!1,this.yehuaBox.visible=!1,this.huaTf_z.scaleX=this.huaTf_z.scaleY=.8,this.huaTf_y.scaleX=this.huaTf_y.scaleY=.8,this.huaTf_z.font=D.NumberFlowerFont,this.huaTf_y.font=D.NumberFlowerFont,this.model.getHuaArr(0,i).length>0&&this.model.getHuaArr(1,i).length>0?(this.huaImg_z.visible=!0,this.huaImg_y.visible=!1,this.zhenghuaBox.visible=!0,this.huaTf_z.text="x"+this.model.getHuaArr(0,i).length,this.yehuaBox.visible=!0,this.huaTf_y.text="x"+this.model.getHuaArr(1,i).length):this.model.getHuaArr(0,i).length>0?(this.huaImg_z.visible=!0,this.huaImg_y.visible=!1,this.zhenghuaBox.visible=!0,this.huaTf_z.text="x"+this.model.getHuaArr(0,i).length):this.model.getHuaArr(1,i).length>0&&(this.huaImg_z.visible=!1,this.huaImg_y.visible=!0,this.zhenghuaBox.visible=!0,this.huaTf_z.text="x"+this.model.getHuaArr(1,i).length)},t.show=function(){this._skin.visible=!0},t.hide=function(){this._skin.visible=!1},t.reset=function(i){void 0===i&&(i=!1),this._skin.haveBox.visible=!1,this.sitDownBtn.visible=!0,this._skin.zhuangImg.visible=!1,this.readyImg.visible=!1,this.tingpaiImg.visible=!1,this.gangEff.visible=!1,this.fenshuTf.visible=!1,i&&(this.zhenghuaBox.visible=!1,this.yehuaBox.visible=!1),this.gangAni.stop(),this.piaoImg.visible=!1,this.playingPiaoImg.visible=!1,this._skin.notPiaoTf.visible=!1,this.tirenBtn.visible=!1,this.voice.visible=!1,this.voice.ani.stop(),this._skin.jiabeiImg.visible=!1},t.showZhuang=function(i){this._skin.zhuangImg.visible=!0;var t="",e=this.model.getRefZhuangPos(i);switch(e){case 0:t="gameCommon/zhuang.png";break;case 1:break;case 2:break;case 3:}this._skin.zhuangImg.skin=t,11!=E.roomtype&&0!=e&&(this._skin.zhuangImg.visible=!1)},t.hideZhuang=function(){this._skin.zhuangImg.visible=!1},t.hideReadySimbol=function(){this.readyImg.visible=!1},t.showTingImg=function(){this.tingpaiImg.visible=!0},t.showReady=function(){this.readyImg.visible=!0},t.setPiaoValue=function(){this.needPiao},t.showPiaoImage=function(i){this.needPiao&&(i?(this.playingPiaoImg.visible=!0,this.piaoImg.visible=!1):(this.playingPiaoImg.visible=!1,this.piaoImg.visible=!0),this._skin.notPiaoTf.visible=!1)},t.hidePiaoImage=function(){this.needPiao&&(this.playingPiaoImg.visible=!1,this.piaoImg.visible=!1,this._skin.notPiaoTf.visible=!0)},t.updateTirenBtn=function(){var i=this.model.playerByPos(this.model.getChairPosByDir(this.dir));null!=i&&(this.tirenBtn.visible=i.canKick)},t.setHeadGray=function(i,t,s){void 0===s&&(s=0),i&&t?(this._skin.offLineSp.visible=!0,this.headImg.filters=[x.grayscaleFilter],this.offlineimg.visible=!0,this.offlineTf.visible=!0,this.offlineTf.text=s+"",this.startCutDownOffline()):i&&!t?(this._skin.offLineSp.visible=!0,e.timer.once(1e4,this,this.setGrayhead)):(this._skin.offLineSp.visible=!1,this.tirenBtn.visible=!1,this.headImg.filters=null,this.offlineimg.visible=!1,this.offlineTf.visible=!1,e.timer.clear(this,this.setGrayhead),this.model.playerByPos(this.model.getChairPosByDir(this.dir)).canKick=!1,this.stopCutDownOffline())
},t.startCutDownOffline=function(){m.instance.on("ON_LITTLETIMEER",this,this.onCutdown)},t.stopCutDownOffline=function(){m.instance.off("ON_LITTLETIMEER",this,this.onCutdown),this.offlineTf.visible=!1},t.onCutdown=function(){null!=this.model.playerByPos(this.model.getChairPosByDir(this.dir))&&(this.model.playerByPos(this.model.getChairPosByDir(this.dir)).offlineTime--,this.model.playerByPos(this.model.getChairPosByDir(this.dir)).offlineTime<=0&&(this.model.playerByPos(this.model.getChairPosByDir(this.dir)).offlineTime=0,this.stopCutDownOffline()),(0/0==this.model.playerByPos(this.model.getChairPosByDir(this.dir)).offlineTime||void 0==this.model.playerByPos(this.model.getChairPosByDir(this.dir)).offlineTime)&&(this.model.playerByPos(this.model.getChairPosByDir(this.dir)).offlineTime=0),this.offlineTf.text=this.model.playerByPos(this.model.getChairPosByDir(this.dir)).offlineTime+"")},t.setGrayhead=function(){this.headImg.filters=[x.grayscaleFilter],this.offlineimg.visible=!0},t.playFlyHeadImg=function(i){var t=500;switch(this.dir){case 0:switch(i){case 1:M.from(this._skin,{x:946,y:150},t);break;case 2:M.from(this._skin,{x:199,y:47},t);break;case 3:M.from(this._skin,{x:12,y:150},t)}break;case 1:switch(i){case 0:M.from(this._skin,{x:12,y:378},t);break;case 2:M.from(this._skin,{x:202,y:46},t);break;case 3:M.from(this._skin,{x:12,y:150},t)}break;case 2:switch(i){case 0:M.from(this._skin,{x:-116,y:324},t);break;case 1:M.from(this._skin,{x:820,y:96},t);break;case 3:M.from(this._skin,{x:-116,y:96},t)}break;case 3:switch(i){case 0:M.from(this._skin,{x:12,y:378},t);break;case 1:M.from(this._skin,{x:946,y:150},t);break;case 2:M.from(this._skin,{x:199,y:47},t)}}},a(0,t,"model",function(){return wt.instance.gameContext.model}),a(0,t,"controller",function(){return wt.instance.gameContext.controller}),i}(),vt=function(){function i(){this.expressUrl="res/swfs/",this.loadedArr=[]}var t;n(i,"modules.game.majiangGame.view.playerInfoPart.GiftEff");var s=i.prototype;return s.showGiftEff=function(i,t,e){var s=new I;s.load(this.expressUrl+l.giftConfig[e-1].name+".swf",!0);var n=l.giftConfig[e-1].sound,a=parseInt(l.giftConfig[e-1].sounddelay);-1!=this.loadedArr.indexOf(s.basePath)?this.onLoaded(s,i,t,n,a):s.on("loaded",this,this.onLoaded,[s,i,t,n,a])},s.onLoaded=function(i,t,e,s,n){switch(-1==this.loadedArr.indexOf(i.basePath)&&this.loadedArr.push(i.basePath),i.stop(),N.instance.popLayer.addChild(i),t){case 0:i.x=-50,i.y=318;break;case 1:i.x=880,i.y=70;break;case 2:i.x=130,i.y=-40;break;case 3:i.x=-50,i.y=90;break;default:i.x=820,i.y=-50}var a=0,o=0;switch(e){case 0:a=-50,o=318;break;case 1:a=880,o=70;break;case 2:a=130,o=-40;break;case 3:a=-50,o=90;break;default:a=820,o=-50}M.to(i,{x:a,y:o},400,null,new v(this,this.onCompeteTween,[i,s,n]))},s.onCompeteTween=function(i,t,s){i.playTo(0,i.count-2,v.create(this,this.playEnd,[i])),e.timer.once(3e3,this,this.playEnd,[i]),0==s?G.playEffect(t):e.timer.once(s,this,this.playSound,[t],!1)},s.playSound=function(i){G.playEffect(i)},s.playEnd=function(i){i&&i.removeSelf()},a(1,i,"instance",function(){return null==i._instance&&(i._instance=new i(new t)),i._instance}),i._instance=null,i.__init$=function(){t=function(){function i(){}return n(i,""),i}()},i}(),Pt=function(){function i(i){this.needPiao=!0,this.skin=null,this.curPiaoValue=0,this.piaoCheckBoxVec=o(3,null),this.skin=i,this.init()}n(i,"modules.game.majiangGame.view.playerInfoPart.PiaoSelePart");var t=i.prototype;return t.init=function(){var i=0,t=this.piaoCheckBoxVec.length;for(i=0;t>i;i++)this.piaoCheckBoxVec[i]=this.skin["piao"+i],this.piaoCheckBoxVec[i].on("click",this,this.onClickCheckBox,[i,i]);this.seleIdx(0),this.hide()},t.onClickCheckBox=function(i,t){var e=t;console.log("onClickCheckBox::"+t),this.seleIdx(e)},t.seleIdx=function(i){var t=0,e=this.piaoCheckBoxVec.length;for(t=0;e>t;t++)this.piaoCheckBoxVec[t].selected=t==i?!0:!1;this.curPiaoValue=i},t.getCurPiaoValue=function(){return this.curPiaoValue},t.reset=function(){this.seleIdx(0),this.needPiao=11==E.roomtype?!0:!1},t.show=function(){this.skin.visible=this.needPiao?!0:!1},t.hide=function(){this.skin.visible=!1},i}(),kt=function(){function i(){this.uid=0,this._skin=null,this._skin=new O,this._skin.giftList.itemRender=oe,this._skin.giftList.spaceX=10,this._skin.giftList.selectEnable=!0,this._skin.giftList.selectHandler=new v(this,this.onSelectRound),this._skin.giftList.renderHandler=new v(this,this.updateRoundItem),this._skin.giftList.dataSource=l.giftConfig,this._skin.giftList.refresh()}var t;n(i,"modules.game.majiangGame.view.playerInfoPart.UserInfoPage");var e=i.prototype;return e.show=function(i,t,e){this.uid=i,this._skin.idTf.text="ID: "+i,this._skin.nickName.text=wt.instance.gameContext.model.playerByUid(i).nickname,this._skin.diamondTf.text=E.Diamond+"",x.AddCenter(this._skin,N.instance.popLayer);var s=new j;s.loadImage(e,0,0,this._skin.imgPhoto.width,this._skin.imgPhoto.height),this._skin.imgPhoto.addChild(s),this._skin.mouseEnabled=!0,this._skin.clickBg.once("click",this,this.onCloseUserInfo),this._skin.giftList.refresh(),i==E.uid?(this._skin.diamond.visible=!0,this._skin.diamondTf.visible=!0):(this._skin.diamond.visible=!1,this._skin.diamondTf.visible=!1)},e.onCloseUserInfo=function(i){this._skin&&i.target==this._skin.clickBg&&this._skin&&this._skin.removeSelf()},e.hide=function(){this._skin&&this._skin.removeSelf()},e.onSelectRound=function(i){console.log("当前选择的索引："+i)},e.updateRoundItem=function(i){i.setData(i.dataSource,this.uid)},a(1,i,"instance",function(){return null==i._instance&&(i._instance=new i(new t)),i._instance}),i._instance=null,i.__init$=function(){t=function(){function i(){}return n(i,""),i}()},i}(),yt=function(){function i(i){this._skin=null,this._PowerBarOrignalW=0/0,this._infosimbol=null,this._skin=i,this._infosimbol=this._skin.infoSImg,this._infosimbol.visible=!1,i.mouseThrough=!0,this._skin.option.on("click",this,this.onClickSetBtn),this._skin.scoreList.on("click",this,this.onClickScoreListBtn),this._skin.infoListBtn.on("click",this,this.onClickInfoListBtn),m.instance.on("COMMON_INFOLIST_NOTICE",this,this.onGotInfo)}n(i,"modules.game.majiangGame.view.TableInfoPage");var t=i.prototype;return t.playVoicePlay=function(){e.timer.frameLoop(1,this,this.onTimeLoop)},t.onTimeLoop=function(){this._skin.voicePlay.rotation%360==0&&(this._skin.voicePlay.rotation=0),this._skin.voicePlay.rotation+=10},t.stopVoicePlay=function(){e.timer.clear(this,this.onTimeLoop)},t.onGotInfo=function(){this._infosimbol.visible=!0},t.updateRoomId=function(){Number(this._skin.roomNumTf.text)!=E.roomid&&(this._skin.roomNumTf.text=""+E.roomid),this.updateTime()},t.onClickScoreListBtn=function(i){var t={uniqueCode:E.uniqueCode};console.log(E.roomid),m.instance.event("SOCKET_SEND",T.getProtoMessage(404,t)),G.instance.playClickBtnSound(),u.instance.commonContext.view.timeWarView.showOrHide(),i.stopPropagation()},t.onClickSetBtn=function(i){i.stopPropagation(),G.instance.playClickBtnSound(),u.instance.commonContext.view.functionOption.showOrHide(-350,0)},t.onClickInfoListBtn=function(i){this._infosimbol.visible=!1,G.instance.playClickBtnSound(),u.instance.commonContext.view.infoListView.showOrHide(),i.stopPropagation()},t.updateTime=function(){var i=R.instance.date,t=(i.getHours(),i.getMinutes(),"");0==this.model.fengquan?t="东风圈":1==this.model.fengquan?t="南风圈":2==this.model.fengquan?t="西风圈":3==this.model.fengquan&&(t="北风圈"),this._skin.fengquanTf.text=t,this._skin.difenTf.text="1"},t.updateLeftRound=function(i){void 0===i&&(i=!0);var t=this.model.majiangMsgs.ACK_RoomInfo,e=t.Rule,s=l.getRule(e[1]);wt.instance.gameContext.view.majiangPage.clockPart.showLeftRoundsNum(),0==s.type?(t.totalRound=s.value,this._skin.leftTf.text=t.RoundCount+1>s.value?"当前"+(t.RoundCount+"/"+s.value)+"局":"当前"+(t.RoundCount+1+"/"+s.value)+"局",this._skin.ruleTimeTf.text="本局局数："+s.value+"局"):(this._skin.ruleTimeTf.text="本局时长："+s.value+"分钟",1==this.model.isGameStart||t.RoundCount>=1?this.startCutdown():(t.leftTime=60*s.value,this.stopCutDown()),i&&(E.leftTime=t.leftTime),E.leftTime<0&&(E.leftTime=0),this._skin.leftTf.text=l.getTFmt(E.leftTime)),1==this.model.isGameStart||t.RoundCount>=1?this._skin.weikaishiBox.visible=!1:(E.leftDissolveTime=t.disbandLeftTime,this._skin.leftDissolveTf.text=l.getTFmt(E.leftDissolveTime,!0),this._skin.weikaishiBox.visible=!0,this.startDissolveCutdown())},t.updateKaijuren=function(i){(null==i||""==i)&&(i="无"),this._skin.kaijuTf.text="开局人："+i},t.startDissolveCutdown=function(){m.instance.on("ON_LITTLETIMEER",this,this.onCutDown1)},t.stopDissolveCutdown=function(){m.instance.off("ON_LITTLETIMEER",this,this.onCutDown1)},t.onCutDown1=function(i){E.leftDissolveTime-=i,E.leftDissolveTime<0&&(E.leftDissolveTime=0,this.stopDissolveCutdown()),this._skin.leftDissolveTf.text=l.getTFmt(E.leftDissolveTime,!0)},t.startCutdown=function(){m.instance.on("ON_LITTLETIMEER",this,this.onCutDown)},t.stopCutDown=function(){m.instance.off("ON_LITTLETIMEER",this,this.onCutDown)},t.onCutDown=function(i){E.leftTime-=i,E.leftTime<0&&(E.leftTime=0,this.stopCutDown()),this._skin.leftTf.text=l.getTFmt(E.leftTime)},t.reset=function(){},a(0,t,"model",function(){return wt.instance.gameContext.model}),i}(),wt=function(i){function t(){this.needResize=!0,this._main=null,this._majiangGameContext=null,this._mainContext=null,t.__super.call(this)}n(t,"modules.game.GameModule",i);var s=t.prototype;return s.startup=function(){null==this._mainContext&&(this._mainContext=new f("GameMainmain",this),this._main=new he("GameMain",this,this._mainContext),this._majiangGameContext=new re("MajiangGame",this,this._main)),this.switchState(this._mainContext)},s.stopGame=function(i,e){void 0===i&&(i=!0),void 0===e&&(e=!1),e&&this._majiangGameContext.controller.clear(),t.inGame=!1,t.isSettlement=!1,this.switchState(this._mainContext),i&&(l.isNewHall?x.gotoHall():(this.inHallResize(),C.instance.gotoHall())),ae.instance.noticeHide()},s.startGame=function(){1!=t.inGame&&(C.instance.goEmpty(),t.inGame=!0,u.instance.gotoCommonContext(),this.switchState(this.gameContext),this.inGameResize(),H.onMenuShareTimeline(E.nickname+"-一乐西周麻将 【房间号："+E.roomid+"】",E.roomid+"--"+E.uniqueCode),H.onMenuShareAppMessage(E.nickname+"-一乐西周麻将 【房间号："+E.roomid+"】","房主创建了西周麻将 【房间号:"+E.roomid+"】"+l.getRule(E.Rule[1]).desc+"局",E.roomid+"--"+E.uniqueCode),console.log("startMajiangGame..........."))},s.inGameResize=function(i){void 0===i&&(i=!0),"windows"!=x.sysem()&&(e.stage.screenMode="horizontal"),e.stage.size(1038,640),modules.game.GameModule.instance.gameContext.view.gui.visible=!1,1==i?e.timer.once(200,this,this.onCheckInGameResize):e.timer.frameOnce(1,this,this.onCheckInGameResize)},s.onCheckInGameResize=function(){if(1==w.CurGameModule.inGame){var i=c.getElementById("layaCanvas");i.width<i.height?(x.showChScreenGuideView(),this.inGameResize(!1)):(x.hideChScreenGuideView(),modules.game.GameModule.instance.gameContext.view.gui.visible=!0)}else x.hideChScreenGuideView()},s.inHallResize=function(){"windows"==x.sysem()||(e.stage.screenMode="ipad"==x.sysem()||"mac"==x.sysem()?"vertical":"vertical"),e.stage.size(640,1038)},a(0,s,"main",function(){return this._main}),a(0,s,"gameContext",function(){return this._majiangGameContext}),a(1,t,"instance",function(){return w.CurGameModule.instance},rb.framework.mvc.Module._$SET_instance),t.isPauseGameQueue=!1,t.inGame=!1,t.isSettlement=!1,t}(y),It=function(i){function t(){t.__super.call(this)}n(t,"modules.game.controller.MJGameSocketController",i);var e=t.prototype;return e.onAdd=function(){console.log("GameSocketController onAdd"),E.isReplay?(m.instance.on("REPLAY_getAllReplayMsgs",this,this.onGotAllReplayMsgs),m.instance.on("REPLAY_play",this,this.replay_play),m.instance.on("REPLAY_pause",this,this.replay_pause),m.instance.on("REPLAY_up",this,this.replay_up),m.instance.on("REPLAY_down",this,this.replay_down),m.instance.on("REPLAY_back",this,this.replay_back),m.instance.on("REPLAY_skip",this,this.replay_skip)):m.instance.on("MESSAGE_GAME",this,this.onMsg)},e.onRemove=function(){E.isReplay?(m.instance.off("REPLAY_getAllReplayMsgs",this,this.onGotAllReplayMsgs),m.instance.off("REPLAY_play",this,this.replay_play),m.instance.off("REPLAY_pause",this,this.replay_pause),m.instance.off("REPLAY_up",this,this.replay_up),m.instance.off("REPLAY_down",this,this.replay_down),m.instance.off("REPLAY_back",this,this.replay_back),m.instance.off("REPLAY_skip",this,this.replay_skip)):m.instance.off("MESSAGE_GAME",this,this.onMsg)},e.replay_play=function(){this.model.replayState=1,this.onplay()},e.replay_pause=function(){this.model.replayState=0},e.replay_up=function(){if(console.log("model.replayCurStep::"+this.model.replayCurStep),this.model.replayState=0,!(this.model.replayCurStep<this.model.preStepNum+1)){wt.instance.gameContext.view.replayup_reset(),this.model.replayReset(),wt.instance.gameContext.controller.ACK_RoomInfo(this.model.majiangMsgs.ACK_RoomInfo);var i=this.model.replayAllStepData[this.model.replayCurStep-2];console.log("replayAllStepData[model.replayCurStep-2]"),console.log(i),console.log("replayAllStepData[model.replayCurStep-2]"),this.model.playerInfoVec=i.userData.concat(),wt.instance.gameContext.view.playerInfoPage.updatePlayerInfos(this.model.playerInfoVec),wt.instance.gameContext.controller.recoveryByReplayData(i),this.model.replayCurStep-=2,this.onplay()}},e.replay_down=function(){this.model.needCutdownReplay||(this.model.replayState=0,this.model.replayCurStep+=1,this.model.replayCurStep>this.model.replayData.length-1||(this.model.replayCurStep==this.model.replayData.length-1&&m.instance.event("REPLAY_over",null),this.onMsg(this.model.replayData[this.model.replayCurStep])))},e.replay_back=function(){this.replay_pause(),ae.instance.noticeHide(),wt.instance.gameContext.controller.clearTimeDelay(),R.instance.timer.clear(this,this.onplay),this.endGame()},e.endGame=function(){wt.instance.gameContext.controller.endGameGotoHall()},e.replay_skip=function(){ae.instance.noticeHide(),wt.instance.gameContext.controller.clearTimeDelay(),wt.instance.gameContext.controller.contineGameQueue(),this.model.isStrictShowCalc=!0,this.model.replayState=1,this.model.replayCurStep=this.model.replayData.length-3,this.onplay()},e.onplay=function(){return this.model.needCutdownReplay?(R.instance.timer.once(1e3,this,this.onplay),void 0):(this.model.replayCurStep+=1,this.model.replayCurStep>this.model.replayData.length-1||(this.model.replayCurStep==this.model.replayData.length-1&&m.instance.event("REPLAY_over",null),this.onMsg(this.model.replayData[this.model.replayCurStep]),1==this.model.replayState&&R.instance.timer.once(500,this,this.onplay)),void 0)},e.onGotAllReplayMsgs=function(i){this.model.replayData=[],this.model.replayCurStep=0,this.model.replayState=0,this.model.replayAllStepData=[],E.replayUid=i.uid;var t=i.list,e=0,s=t.length;for(e=0;s>e;e++)this.model.replayData.push(this.processSingleReplayData(t[e]));for(wt.instance.gameContext.controller.contineGameQueue(),e=0;e<this.model.preStepNum;e++)this.model.replayCurStep=e,this.procMsg(this.model.replayData[this.model.replayCurStep]);this.replay_play()},e.processSingleReplayData=function(i){var t=new Object;for(var e in i.C)t.messageId=parseInt(e),t.body=i.C[e];return t},e.onMsg=function(i){1!=wt.isPauseGameQueue&&this.procMsg(i)},e.procMsg=function(i){i instanceof net.Message&&i.complete(),console.log("acc msgId::"+i.messageId);var t;switch(i.messageId){case 560:t=E.isReplay?i.body:l.proto.ACKBC_Into_Room.decode(i.params[0]),wt.instance.gameContext.controller.ACKBC_Into_Room(t);break;case 607:t=E.isReplay?i.body:l.proto.ACKBC_Sitdown.decode(i.params[0]),wt.instance.gameContext.controller.ACKBC_Sitdown(t);break;case 608:t=E.isReplay?i.body:l.proto.ACKBC_Standup.decode(i.params[0]),wt.instance.gameContext.controller.ACKBC_Standup(t);break;case 520:t=E.isReplay?i.body:l.proto.ACK_RoomInfo.decode(i.params[0]),wt.instance.gameContext.controller.ACK_RoomInfo(t);break;case 525:t=E.isReplay?i.body:l.proto.ACK_Room_User.decode(i.params[0]),wt.instance.gameContext.controller.ACK_Room_User(t);break;case 620:t=E.isReplay?i.body:l.proto.ACKBC_Start.decode(i.params[0]),wt.instance.gameContext.controller.ACKBC_Start(t);break;case 650:t=E.isReplay?i.body:l.proto.ACK_UserCard.decode(i.params[0]),wt.instance.gameContext.controller.ACK_UserCard(t);break;case 615:t=E.isReplay?i.body:l.proto.ACK_User_SeatCard.decode(i.params[0]),wt.instance.gameContext.controller.ACK_User_SeatCard(t);break;case 710:if(E.isReplay){t={};var e=i.body;t.Seat=e[0],t.CID=e[1],t.FromLast=e[2],t.Type=[0,0,0,0],5==e.length&&(t.Type=[e[3],e[4],0,0])}else t=l.proto.ACKBC_GetCard.decode(i.params[0]);wt.instance.gameContext.controller.ACKBC_GetCard(t);break;case 720:if(E.isReplay){t={};var e=i.body;t.Seat=e[0],t.CID=e[1]}else t=l.proto.ACKBC_PutCard.decode(i.params[0]);wt.instance.gameContext.controller.ACKBC_PutCard(t);break;case 730:t=E.isReplay?i.body:l.proto.ACK_WaitTool.decode(i.params[0]),wt.instance.gameContext.controller.ACK_WaitTool(t);break;case 740:t=E.isReplay?i.body:l.proto.ACKBC_Chow.decode(i.params[0]),wt.instance.gameContext.controller.ACKBC_Chow(t);break;case 750:t=E.isReplay?i.body:l.proto.ACKBC_Peng.decode(i.params[0]),wt.instance.gameContext.controller.ACKBC_Peng(t);break;case 760:t=E.isReplay?i.body:l.proto.ACKBC_Kong.decode(i.params[0]),wt.instance.gameContext.controller.ACKBC_Kong(t);break;case 600:t=E.isReplay?i.body:l.proto.ACKBC_Ready.decode(i.params[0]),wt.instance.gameContext.controller.ACKBC_Ready(t);break;case 580:t=E.isReplay?i.body:l.proto.ACKBC_Exit_Room.decode(i.params[0]),wt.instance.gameContext.controller.ACKBC_Exit_Room(t);break;case 900:t=E.isReplay?i.body:l.proto.NotifyStartGame.decode(i.params[0]),wt.instance.gameContext.controller.NotifyStartGame(t);break;case 880:t=E.isReplay?i.body:l.proto.ACKBC_SendMsg.decode(i.params[0]),wt.instance.gameContext.view.onRecChat(t);break;case 770:t=E.isReplay?i.body:l.proto.ACKBC_Win.decode(i.params[0]),wt.instance.gameContext.controller.ACKBC_Win(t);break;case 780:t=E.isReplay?i.body:l.proto.ACKBC_Draw.decode(i.params[0]),wt.instance.gameContext.controller.ACKBC_Draw(t);break;case 610:t=E.isReplay?i.body:l.proto.ACKBC_Card_Init.decode(i.params[0]),wt.instance.gameContext.controller.ACKBC_Card_Init(t);break;case 790:t=E.isReplay?i.body:l.proto.ACKBC_Total.decode(i.params[0]),wt.instance.gameContext.controller.ACKBC_Total(t);break;case 920:t=E.isReplay?i.body:l.proto.TotalSummary.decode(i.params[0]),wt.instance.gameContext.controller.NOTIFY_Summary(t);break;case 800:t=E.isReplay?i.body:l.proto.AckDisband.decode(i.params[0]),wt.instance.gameContext.controller.AckDisband(t);break;case 940:t=E.isReplay?i.body:l.proto.NotifyDisband.decode(i.params[0]),wt.instance.gameContext.controller.NotifyDisband(t);break;case 960:t=E.isReplay?i.body:l.proto.NotifyUserState.decode(i.params[0]),wt.instance.gameContext.controller.NotifyUserState(t);break;case 972:t=E.isReplay?i.body:l.proto.NotifyDestoryRoom.decode(i.params[0]),wt.instance.gameContext.controller.NotifyDestoryRoom(t);break;case 971:t=E.isReplay?i.body:l.proto.NotifyKick.decode(i.params[0]),wt.instance.gameContext.controller.NotifyKick(t);break;case 980:t=E.isReplay?i.body:l.proto.KickResponse.decode(i.params[0]),wt.instance.gameContext.controller.KickResponse(t);break;case 992:t=E.isReplay?i.body:l.proto.ACK_TransferHuaResponse.decode(i.params[0]),wt.instance.gameContext.controller.ACK_TransferHuaResponse(t);break;case 1e3:t=E.isReplay?i.body:l.proto.MSG_ACK_Gift.decode(i.params[0]),wt.instance.gameContext.controller.MSG_ACK_Gift(t);break;case 330:E.isReplay&&(t=i.body,console.log("Message.Pass",t),wt.instance.gameContext.controller.pass(t));break;case"":break;case"":}E.isReplay&&this.model.replayCurStep>=this.model.preStepNum-1&&this.model.saveStepData()},a(0,e,"model",function(){return wt.instance.gameContext.model}),t}(h),bt=function(i){function t(){this.pop=null,this.dissolvePage=null,t.__super.call(this),this.setType(2)}n(t,"modules.game.majiangGame.controller.MajiangGameController",i);var s=t.prototype;return s.onAdd=function(){i.prototype.onAdd.call(this)},s.onRemove=function(){i.prototype.onRemove.call(this)},s.discard=function(i){var t=this.model.getHuTipArr(i),e={SID:E.SID,CID:i-1,Ting:t.length};console.log("discard:::"+e),this.sendMsgCommond(T.getProtoMessage(270,e)),l.autoPlay||(this.model.outputCard(this.model.selfChairPos,i),this.view.majiangPage.handPart.updateOnePosAllCards(this.model.selfChairPos,this.model.allCardsVec[this.model.selfChairPos]),this.view.majiangPage.handPart.updateTheFourteenCard(this.model.selfChairPos,this.model.theFourteenCardVec[this.model.selfChairPos]),this.view.majiangPage.outputPart.showOneCardByPos(this.model.selfChairPos,i),this.view.majiangPage.handPart.canControl(this.model.selfChairPos,!1),this.view.majiangPage.handleBtns.reset(),this.view.majiangPage.handPart.movePeng(this.model.selfChairPos,!1),G.playEffect("audio_card_out"),S.playSound(G.instance.getCardPath(this.model.playerByPos(this.model.selfChairPos).sex,i),1),this.model.isClientPrePop=!0,this.model.isClientPrePopCard=i,this.model.isCancelTingp=!1)},s.ACKBC_Into_Room=function(i){console.log("ACKBC_Into_Room"),console.log(i),console.log("ACKBC_Into_Room"),this.model.majiangMsgs.ACKBC_Into_Room=i,E.roomid=i.RID,this.view.tableInfoPage.updateRoomId(),i.nickname=i.Name,i.uid=i.UID,i.ip=i.IP,i.pos=i.Index,i.golds=i.Coin,this.model.updateOnePlayerInfo(i),this.view.playerInfoPage.updateOnePlayerInfo(i),this.view.playerInfoPage.updateSitDownUpBtn(),m.instance.event("COMMON_INFOLIST_NOTICE",{color:0,msg:"玩家["+i.nickname+"]进入了房间！"})},s.ACKBC_Sitdown=function(i){if(this._actived){if(console.log("MSG_ACKBC_Sitdown",i),this.model.majiangMsgs.ACKBC_Sitdown=i,this.model.sitDown(i.uid,i.index,i.score),this.view.playerInfoPage.updatePlayerInfos(this.model.playerInfoVec),this.view.playerInfoPage.updateSitDownUpBtn(),this.view.tableInfoPage.updateKaijuren(i.nickName),i.uid==E.selfuid){var t={sid:E.SID};this.sendMsgCommond(T.getProtoMessage(210,t)),m.instance.event("COMMON_INFOLIST_NOTICE",{color:0,msg:"玩家["+this.model.getPlayerNicknameByUid(i.uid)+"]坐下了"+i.index+"号座位！"})}this.view.calculatePage.perPage&&this.view.calculatePage.perPage.updateBtns()}},s.ACKBC_Standup=function(i){this._actived&&(console.log("MSG_ACKBC_Standup",i),this.model.majiangMsgs.ACKBC_Standup=i,this.model.standup(i.uid,i.index),this.view.playerInfoPage.updatePlayerInfos(this.model.playerInfoVec),this.view.playerInfoPage.updateSitDownUpBtn(),this.view.playerInfoPage.updateStartBtn(),this.view.tableInfoPage.updateKaijuren(i.nickName),this.view.calculatePage.perPage&&this.view.calculatePage.perPage.updateBtns(),m.instance.event("COMMON_INFOLIST_NOTICE",{color:0,msg:"玩家["+this.model.getPlayerNicknameByUid(i.uid)+"]站起了！"}))},s.ACK_RoomInfo=function(i){console.log("ACK_Room_Info",i,"ACK_Room_Info"),this.model.majiangMsgs.ACK_RoomInfo=i,E.uniqueCode=i.uniqueCode,E.roomtype=i.Type,E.Rule=i.Rule,E.isReplay&&(E.roomid=i.RID),console.log(E.uniqueCode),1==i.gameState&&(this.model.isGameStart=!0,this.view.playerInfoPage.hideBtnsByGameStart(),this.view.playerInfoPage.hideReadySimbol()),E.isReplay&&(this.model.majiangMsgs.ACK_RoomInfo.isGameStart=1),this.view.tableInfoPage.updateLeftRound(),this.view.tableInfoPage.updateKaijuren(i.nickName),i.direction||(i.direction=0),this.model.fengquan=i.direction,this.view.tableInfoPage.updateRoomId(),this.view.majiangPage.clockPart.setWenli()},s.ACK_Room_User=function(i){console.log("ACK_Room_User",i,"ACK_Room_User"),this.model.majiangMsgs.ACK_Room_User=i,this.model.updatePlayerInfoVec(i.Users),this.view.playerInfoPage.updatePlayerInfos(this.model.playerInfoVec)},s.ACKBC_Start=function(i){this._actived&&(console.log("ACKBC_Start"),console.log(i),console.log("ACKBC_Start"),E.isReplay&&(void 0==i.zhuang_index&&(i.zhuang_index=0),i.ZhuangIndex=i.zhuang_index,i.direction||(i.direction=0),i.rollIndex||(i.rollIndex=0),i.leftTime=i.left_time,i.roundCount||(i.roundCount=0)),this.model.majiangMsgs.ACKBC_Start=i,this.resetSelf(),this.model.isGameStart=!0,this.model.majiangMsgs.control_game_mjstart_Info=i,this.model.zhuangpos=i.ZhuangIndex,this.model.fengquan=i.direction,this.view.startGame(),this.view.playerInfoPage.hideReadySimbol(),this.view.playerInfoPage.hideBtnsByGameStart(),this.view.majiangPage.outputPart.showStartImg(),this.view.tableInfoPage.updateRoomId(),i.points=void 0!=i.points?i.points:0,0!=i.points?(this.pauseGameQueue(),m.instance.once("GAME_START_SHAIZI_DONGFENG_COMP",this,this.onFirstShaiziComp),this.view.majiangPage.shaiziPart.play(i.rollIndex,i.points),G.playEffect("dice")):this.view.majiangPage.clockPart.dingDongwei(this.model.zhuangpos,!0),E.isReplay&&(i.round_count=void 0!=i.round_count?i.round_count:0,i.left_time=void 0!=i.left_time?i.left_time:0,i.roundCount=i.round_count,i.leftTime=i.left_time),this.model.majiangMsgs.ACK_RoomInfo.RoundCount=i.roundCount,this.model.majiangMsgs.ACK_RoomInfo.leftTime=i.leftTime,this.view.tableInfoPage.updateLeftRound())},s.onFirstShaiziComp=function(){console.log("diyici ..................bobbo onFirstShaiziComp"),this.view.playerInfoPage.showZhuang(),this.view.majiangPage.clockPart.dingDongwei(this.model.zhuangpos),e.timer.once(1e3,this,this.playEachShaiziEff)},s.playEachShaiziEff=function(){var i=this.model.majiangMsgs.ACKBC_Start,t=this.model.getRandomFourValue(),s=i.Users;if(void 0!=i.Users){var n=0,a=s.length;for(n=0;a>n;n++)E.isReplay&&(s[n].Index=void 0!=s[n].index?s[n].index:0,s[n].UID=void 0!=s[n].uid?s[n].uid:0),this.view.majiangPage.shaiziPart.play(this.model.getPlayerPosByUid(s[n].UID),t[this.model.getshaiziIdxByPos(s[n].Index)]);G.playEffect("dice"),e.timer.once(3e3,this,this.onEachEffEnd)}},s.onEachEffEnd=function(){this.model.updatePlayerInfoVec(this.model.majiangMsgs.ACKBC_Start.Users),this.view.playerInfoPage.updatePlayerInfos(this.model.playerInfoVec,!0,!0),this.view.playerInfoPage.showZhuang(),this.view.majiangPage.clockPart.dingDongwei(this.model.zhuangpos,!0),e.timer.once(1e3,this,this.contineGameQueue)},s.ACK_UserCard=function(i){if(this._actived){l.autoDestory&&this.sendRandom(),console.log("ACK_UserCard"),console.log(i),console.log("ACK_UserCard"),this.model.majiangMsgs.ACK_UserCard=i;var t=[],e=0,s=i.Cards.length;for(e=0;s>e;e++)t.push({card:i.Cards[e].CID});this.model.updateAllCardsVecByGameStart(t),this.view.majiangPage.handPart.updateAllCards(this.model.allCardsVec),this.view.majiangPage.clockPart.noticeShowLeftCardsNum()}},s.ACK_User_SeatCard=function(i){if(this._actived){l.autoDestory&&this.sendRandom(),this.model.isClientPrePop=!1,console.log("ACK_User_SeatCard",i,"ACK_User_SeatCard"),console.log(this.model.majiangMsgs.ACKBC_Start,"----------------------------------"),this.model.majiangMsgs.ACK_User_SeatCard=i,this.model.resetCard(),this.view.majiangPage.handPart.reset(),this.view.majiangPage.pengGangPart.reset(),this.view.majiangPage.huaPart.reset(),this.view.majiangPage.outputPart.reset();var t,e=[],s=0,n=0,a=0,o=0;for(s=0;s<i.Cards.length;s++){if(e.length=0,i.Cards[s].List.length!=i.Cards[s].ListLen)for(o=0;o<i.Cards[s].ListLen;o++)i.Cards[s].List.push({CID:-1});for(a=0;a<i.Cards[s].List.length;a++)E.isReplay&&(i.Cards[s].List[a].CID=i.Cards[s].List[a].cid,void 0==i.Cards[s].List[a].CID&&(i.Cards[s].List[a].CID=0)),e.push({card:i.Cards[s].List[a].CID+1});if(this.model.updateAllCards(s,e),this.view.majiangPage.handPart.updateOnePosAllCards(s,this.model.allCardsVec[s]),this.view.majiangPage.handPart.updateTheFourteenCard(s,this.model.theFourteenCardVec[s]),i.Cards[s].Hua){for(a=0;a<i.Cards[s].Hua.length;a++)E.isReplay&&(i.Cards[s].Hua[a].CID=i.Cards[s].Hua[a].cid,void 0==i.Cards[s].Hua[a].CID&&(i.Cards[s].Hua[a].CID=0)),n=i.Cards[s].Hua[a].CID+1,this.model.huaVec[s].push(n),0==this.model.majiangMsgs.ACK_RoomInfo.gameState?this.view.majiangPage.showBuhua(n,s,!0,!1):this.view.majiangPage.showBuhua(n,s,!1,!1,!1);this.view.playerInfoPage.updateHua(s)}if(i.Cards[s].Chow)for(a=0;a<i.Cards[s].Chow.length;a+=3){for(t=new F,o=0;3>o;o++)1==i.Cards[s].Chow[a+o].type?t.chicard=i.Cards[s].Chow[a+o].CID+1:t.chicards.push(i.Cards[s].Chow[a+o].CID+1);this.model.updateChiVec(s,t.chicard,t.chicards,(this.model.chairNum+s-1)%this.model.chairNum),this.view.majiangPage.pengGangPart.chi(t,s)}if(i.Cards[s].Peng)for(a=0;a<i.Cards[s].Peng.length;a++)this.model.updatePengVec(s,i.Cards[s].Peng[a].CID+1,i.Cards[s].Peng[a].TIndex),this.view.majiangPage.pengGangPart.peng(i.Cards[s].Peng[a].CID+1,s,i.Cards[s].Peng[a].TIndex);if(i.Cards[s].Kong)for(a=0;a<i.Cards[s].Kong.length;a++)2==i.Cards[s].Kong[a].type?(this.model.updateGangVec(s,i.Cards[s].Kong[a].CID+1,0,i.Cards[s].Kong[a].TIndex,i.Cards[s].Kong[a]),this.view.majiangPage.pengGangPart.gang(i.Cards[s].Kong[a].CID+1,s,0,i.Cards[s].Kong[a].TIndex)):1==i.Cards[s].Kong[a].type?(this.model.updateGangVec(s,i.Cards[s].Kong[a].CID+1,1,i.Cards[s].Kong[a].TIndex),this.view.majiangPage.pengGangPart.gang(i.Cards[s].Kong[a].CID+1,s,1,i.Cards[s].Kong[a].TIndex)):0==i.Cards[s].Kong[a].type&&(this.model.updateGangVec(s,i.Cards[s].Kong[a].CID+1,2,i.Cards[s].Kong[a].TIndex),this.view.majiangPage.pengGangPart.gang(i.Cards[s].Kong[a].CID+1,s,2,i.Cards[s].Kong[a].TIndex));if(i.Cards[s].Out)for(a=0;a<i.Cards[s].Out.length;a++)this.model.outputCardsVec[s].push(i.Cards[s].Out[a].CID+1),this.view.majiangPage.outputPart.showOneCardByPos(s,i.Cards[s].Out[a].CID+1,!1,!1);-1!=this.model.theFourteenCardVec[s]&&0==E.isReplay&&(this.model.getPengGangNum(s)<4?this.seatPingBi(s,i):this.view.majiangPage.handPart.canControl(s,!0))}this.model.majiangMsgs.ACKBC_Card_Init&&this.model.majiangMsgs.ACKBC_Card_Init.show&&0==E.isReplay&&this.view.majiangPage.outputPart.showCurSimbolByPos(this.model.majiangMsgs.ACKBC_Card_Init.lastPutIndex),this.view.majiangPage.clockPart.noticeShowLeftCardsNum(),this.model.isGameStart=!0,this.view.playerInfoPage.hideBtnsByGameStart()}},s.seatPingBi=function(i,t){this.view.majiangPage.handPart.canControl(i,!0,[t.Cards[i].lastCardId+1])},s.ACKBC_GetCard=function(i){if(this._actived){l.autoDestory&&this.sendRandom(),this.view.majiangPage.handleBtns.hide(),this.view.majiangPage.outputPart.hideTemp(),console.log("ACKBC_GetCard",i,"ACKBC_GetCard"),this.model.majiangMsgs.ACKBC_GetCard=i,this.model.leftDesktopCardsNum-=1;var t=i.CID+1;if(i.pos=i.Seat,1==this.model.judgeHua(t))return this.pauseGameQueue(),e.timer.once(600,this,this.buHuaDelay,[i,t]),void 0;if(this.model.theFourteenCardVec[i.pos]=t,this.model.allCardsVec[i.pos].length%3==0)return;if(this.view.majiangPage.handPart.updateTheFourteenCard(i.pos,this.model.theFourteenCardVec[i.pos]),this.view.majiangPage.handPart.canControl(i.pos,!0),this.view.majiangPage.clockPart.noticeShowClock(i.pos,10),this.view.majiangPage.clockPart.noticeShowLeftCardsNum(),i.pos==this.model.selfChairPos&&this.model.isSelfSitDown){if(!i.Type)return;if(i.Type[0]||i.Type[1]||i.Type[2]||i.Type[3])return this.view.majiangPage.handleBtns.showBtnList(i.Type),void 0}l.autoPlay&&i.pos==this.model.selfChairPos&&this.model.isSelfSitDown&&(1==this.model.judgeHu(this.model.allCardsVec[i.pos].concat(this.model.theFourteenCardVec[i.pos])),console.log("不可以胡 model.isSelfSitDown：："+this.model.isSelfSitDown+"  model.selfChairPos::"+this.model.selfChairPos),e.timer.once(80,this,this.autoDiscard))}},s.autoDiscard=function(){var i=this.model.getUseless();console.log("来自机器人自动出牌：：："+i),this.discard(i),l.autoDestory&&this.sendRandom()},s.buHuaDelay=function(i,t){this.view.majiangPage.clockPart.noticeShowLeftCardsNum(),this.model.huaVec[i.pos].push(t),this.view.majiangPage.showBuhua(t,i.pos,!0,!0),this.view.playerInfoPage.updateHua(i.pos),e.timer.once(800,this,this.contineGameQueue)},s.ACKBC_PutCard=function(i){if(this._actived){if(l.autoDestory&&this.sendRandom(),console.log("ACKBC_PutCard"),console.log(i),console.log("ACKBC_PutCard"),this.model.majiangMsgs.ACKBC_PutCard=i,i.pos=i.Seat,i.card=i.CID+1,i.pos==this.model.selfChairPos&&1==this.model.isClientPrePop)return this.model.isClientPrePop=!1,void 0;this.model.outputCard(i.pos,i.card),this.view.majiangPage.handPart.updateOnePosAllCards(i.pos,this.model.allCardsVec[i.pos]),this.view.majiangPage.handPart.updateTheFourteenCard(i.pos,this.model.theFourteenCardVec[i.pos]),this.view.majiangPage.outputPart.showOneCardByPos(i.pos,i.card),this.view.majiangPage.handPart.canControl(i.pos,!1),this.model.isSelfSitDown&&i.pos==this.model.selfChairPos,E.isReplay?this.view.majiangPage.handleBtns.reset():i.pos==this.model.selfChairPos&&this.view.majiangPage.handleBtns.reset(),this.view.majiangPage.handPart.movePeng(i.pos,!1),G.playEffect("audio_card_out"),S.playSound(G.instance.getCardPath(this.model.playerByPos(i.pos).sex,i.card),1)
}},s.ACK_WaitTool=function(i){if(this._actived){if(l.autoDestory&&this.sendRandom(),void 0==i.Seat&&(i.Seat=0),void 0==i.Type&&(i.Type=[0,0,0,0]),void 0==i.TimeOut&&(i.TimeOut=10),console.log("ACK_WaitCheckTool"),console.log(i),console.log("ACK_WaitCheckTool"),this.model.majiangMsgs.ACK_WaitTool=i,i.Seat==this.model.selfChairPos){var t=i.Seat;this.view.majiangPage.handleBtns.showBtnList(),this.view.majiangPage.clockPart.noticeShowClock(t,i.TimeOut)}console.log("通知操作！！！！")}},s.ACKBC_Chow=function(i){if(this.actived){l.autoDestory&&this.sendRandom(),console.log("ACKBC_Chow::"+i),this.view.majiangPage.outputPart.hideTemp(),this.model.majiangMsgs.ACKBC_Chow=i,void 0==i.CID1&&(i.CID1=0),void 0==i.CID2&&(i.CID2=0),void 0==i.CID3&&(i.CID3=0),void 0==i.Seat&&(i.Seat=0),void 0==i.TSeat&&(i.TSeat=(this.model.chairNum+i.Seat-1)%this.model.chairNum),i.pos=i.Seat,i.chicard=i.CID1+1,i.chicards=[i.CID2+1,i.CID3+1],this.model.updateChiVec(i.pos,i.chicard,i.chicards,i.TSeat),this.model.cutChiCard(i.pos,i.chicards);var t=new F;t.chicard=i.chicard,t.chicards=i.chicards,this.view.majiangPage.pengGangPart.chi(t,i.pos),this.view.majiangPage.outputPart.noticeHasPengGang(),this.view.majiangPage.handPart.updateOnePosAllCards(i.pos,this.model.allCardsVec[i.pos]);var s=this.model.getChengbaoNumRefNum(i.pos,(this.model.chairNum+i.pos-1)%this.model.chairNum);3>s&&this.model.getPengGangNum(i.pos)<4?this.pingbiChi(i):this.view.majiangPage.handPart.canControl(i.pos,!0),this.popChengbaoMsg(s,(this.model.chairNum+i.pos-1)%this.model.chairNum,i.pos),this.view.majiangPage.clockPart.noticeShowClock(i.pos,10),this.view.majiangPage.showEffByPos(i.pos,4),this.view.majiangPage.handPart.movePeng(i.pos,!0),this.view.majiangPage.handleBtns.reset(),S.playSound(G.instance.getCardPath(this.model.playerByPos(i.pos).sex,"chi"),1),l.autoPlay&&i.pos==this.model.selfChairPos&&this.model.isSelfSitDown&&e.timer.once(80,this,this.autoDiscard)}},s.pingbiChi=function(i){this.view.majiangPage.handPart.canControl(i.pos,!0,[i.chicard])},s.popChengbaoMsg=function(i,t,e){if(!(2>i||i>3)){var s="";2==i?s="["+this.model.playerByPos(t).nickname+"]请注意，你已经被["+this.model.playerByPos(e).nickname+"]吃（碰、杠）了两口！":3==i&&(s="["+this.model.playerByPos(t).nickname+"]请注意，你已经跟["+this.model.playerByPos(e).nickname+"]做生意了！"),x.popMessage(s)}},s.ACKBC_Peng=function(i){if(this.actived){if(l.autoDestory&&this.sendRandom(),console.log("ACKBC_Peng"),console.log(i),console.log("ACKBC_Peng"),this.view.majiangPage.outputPart.hideTemp(),this.model.majiangMsgs.ACKBC_Peng=i,i.Seat=void 0!=i.Seat?i.Seat:0,i.TSeat=void 0!=i.TSeat?i.TSeat:0,i.CID=void 0!=i.CID?i.CID:0,i.pos=i.Seat,i.card=i.CID+1,-1==i.CID&&alert("碰的牌为-1"),-1!=this.model.pengVec[i.pos].indexOf(i.card))return;this.model.updatePengVec(i.pos,i.card,i.TSeat),this.model.cutPengCard(i.pos,i.card),this.view.majiangPage.pengGangPart.peng(i.card,i.pos,i.TSeat),this.view.majiangPage.outputPart.noticeHasPengGang(),this.view.majiangPage.chiSelePage.hide(),this.view.majiangPage.handPart.updateOnePosAllCards(i.pos,this.model.allCardsVec[i.pos]),this.model.getChengbaoNumRefNum(i.pos,i.TSeat)<3&&this.model.getPengGangNum(i.pos)<4?this.view.majiangPage.handPart.canControl(i.pos,!0,[i.card]):this.view.majiangPage.handPart.canControl(i.pos,!0),this.popChengbaoMsg(this.model.getChengbaoNumRefNum(i.pos,i.TSeat),i.TSeat,i.pos),this.view.majiangPage.clockPart.noticeShowClock(i.pos,10),this.view.majiangPage.handleBtns.reset(),this.view.majiangPage.showEffByPos(i.pos,0),this.view.majiangPage.handPart.movePeng(i.pos,!0),S.playSound(G.instance.getCardPath(this.model.playerByPos(i.pos).sex,"peng"),1),l.autoPlay&&i.pos==this.model.selfChairPos&&this.model.isSelfSitDown&&e.timer.once(80,this,this.autoDiscard)}},s.ACKBC_Kong=function(i){if(this.actived){switch(l.autoDestory&&this.sendRandom(),console.log("ACKBC_Kong",i,"ACKBC_Kong"),this.view.majiangPage.outputPart.hideTemp(),this.model.majiangMsgs.ACKBC_Kong=i,i.Seat=void 0!=i.Seat?i.Seat:0,i.TSeat=void 0!=i.TSeat?i.TSeat:0,i.KongType=void 0!=i.KongType?i.KongType:0,i.CID=void 0!=i.CID?i.CID:0,i.pos=i.Seat,i.KongType){case 80:i.type=0;break;case 70:i.type=1;break;case 60:i.type=2}i.card=i.CID+1,i.nMoneryOp=[],this.view.majiangPage.chiSelePage.hide();{this.model.updateGangVec(i.pos,i.card,i.type,i.TSeat,i)}this.model.cutGangCard(i.pos,i.card,i.type),this.view.majiangPage.pengGangPart.gang(i.card,i.pos,i.type,i.TSeat),0!=i.type&&this.popChengbaoMsg(this.model.getChengbaoNumRefNum(i.pos,i.TSeat),i.TSeat,i.pos),2==i.type&&this.view.majiangPage.outputPart.noticeHasPengGang(),this.view.majiangPage.handPart.updateOnePosAllCards(i.pos,this.model.allCardsVec[i.pos]),this.view.majiangPage.handPart.updateTheFourteenCard(i.pos,this.model.theFourteenCardVec[i.pos]),this.view.majiangPage.handPart.movePeng(i.pos,!1),this.view.majiangPage.showEffByPos(i.pos,1),this.view.majiangPage.handleBtns.reset(),S.playSound(G.instance.getCardPath(this.model.playerByPos(i.pos).sex,"gang"),1)}},s.ACKBC_Ready=function(i){if(this.actived){if(console.log("ACKBC_Ready"),console.log(i),console.log("ACKBC_Ready"),1==this.model.isGameStart)return;G.instance.playReadySound(),this.model.majiangMsgs.ACKBC_Ready=i,i.uid=i.UID,i.pos=this.model.getPlayerPosByUid(i.uid),this.model.updateReadyState(i.pos,!0,0),this.view.playerInfoPage.updatePlayerInfos(this.model.playerInfoVec,!1),i.pos==this.model.selfChairPos&&(this.view.playerInfoPage.hideReadyBtn(),this.view.playerInfoPage.hideZhuang(),console.log("ready.........."),this.view.calculatePage.reset(),this.view.calculatePage.reset(),this.model.reset(),this.view.majiangPage.reset())}},s.ACKBC_Exit_Room=function(i){if(this.actived){if(console.log("ACKBC_Exit_Room"),console.log(i),console.log("ACKBC_Exit_Room"),this.model.majiangMsgs.ACKBC_Exit_Room=i,i.uid=i.UID,i.uid==E.selfuid)return l.isNewHall?x.gotoHall():this.endGameGotoHall(!0),void 0;m.instance.event("COMMON_INFOLIST_NOTICE",{color:1,msg:"玩家["+this.model.getPlayerNicknameByUid(i.uid)+"]离开了房间！"});var t=this.model.getPlayerPosByUid(i.uid);this.model.leavePlayer(i.uid),-1!=t&&(this.view.playerInfoPage.updatePlayerInfos(this.model.playerInfoVec),this.view.playerInfoPage.showStartBtn(!1)),(this.model.isGameStart||0!=this.model.majiangMsgs.ACK_RoomInfo.RoundCount)&&this.view.playerInfoPage.showZhuang()}},s.NotifyStartGame=function(i){this.actived&&(console.log("NotifyStartGame::"+i+"NotifyStartGame"),this.model.majiangMsgs.NotifyStartGame=i,i.uid==E.selfuid&&this.view.playerInfoPage.showStartBtn())},s.ACKBC_Win=function(i){if(this.actived){this.view.majiangPage.outputPart.hideTemp(),console.log("ACKBC_Win::",i,"ACKBC_Win"),i.Seat=void 0!=i.Seat?i.Seat:[],i.TSeat=void 0!=i.TSeat?i.TSeat:0,i.CID=void 0!=i.CID?i.CID:0,i.Cards=void 0!=i.Cards?i.Cards:[],this.model.majiangMsgs.ACKBC_Win=i,this.view.majiangPage.handleBtns.hide(),this.model.isHu=!0,this.model.isLiu=!1,this.gameOverDownCards(i);var t=i.Seat;if(this.model.huArr=t.concat(),E.isReplay&&1==this.model.isStrictShowCalc)return;this.pauseGameQueue();var s=!1,n=0,a=0;if(-1!=i.TSeat){var o=i.CID+1;o!=this.view.majiangPage.outputPart.getCurOutputCardIdx()?this.view.majiangPage.pengGangPart.showHuAni(i.TSeat,o):(this.view.majiangPage.showDianPaoHuAni(),this.view.majiangPage.showEffByPos(i.TSeat,5),a=1)}for(n=0;n<t.length;n++)if(t[n]==this.model.selfChairPos&&(s=!0),1==a?this.view.majiangPage.showEffByPos(t[n],2):this.view.majiangPage.showEffByPos(t[n],6),-1==i.TSeat){this.view.majiangPage.showZimoAni(t[n]);try{S.playSound(G.instance.getCardPath(this.model.playerByPos(t[n]).sex,"zimo"),1)}catch(h){}}else try{S.playSound(G.instance.getCardPath(this.model.playerByPos(t[n]).sex,"hu"),1)}catch(h){}var r;r=1==s?"js_win":"js_fail",G.playEffect(r),e.timer.once(2e3,this,this.contineGameQueue)}},s.ACKBC_Draw=function(i){if(this.actived){if(console.log("ACKBC_Draw::",i,"ACKBC_Draw------------------------------------"),this.view.majiangPage.outputPart.hideTemp(),this.model.majiangMsgs.ACKBC_Draw=i,E.isReplay&&(i.RID=void 0!=i.RID?i.RID:0,i.Cards=void 0!=i.Cards?i.Cards:[]),this.view.majiangPage.handleBtns.hide(),this.model.isHu=!0,this.model.isLiu=!0,this.gameOverDownCards(i),E.isReplay&&1==this.model.isStrictShowCalc)return;var t="audio_liuju";G.playEffect(t),this.pauseGameQueue(),e.timer.once(4e3,this,this.contineGameQueue)}},s.gameOverDownCards=function(i){this.view.majiangPage.handleBtns.hide(),this.model.isHu=!0;var t,e=[],s=0,n=0,a=0,o=0;if(E.isReplay){var h=this.model.chairNum;for(s=0;h>s;s++)this.model.huaVec[s].length=0,this.model.chiVec[s].length=0,this.model.chiFromVec[s].length=0,this.model.pengVec[s].length=0,this.model.pengFromVec[s].length=0,this.model.mingGangVec[s].length=0,this.model.mingGangFromVec[s].length=0,this.model.anGangVec[s].length=0,this.model.anGangFromVec[s].length=0;this.view.majiangPage.pengGangPart.reset(),this.view.majiangPage.huaPart.reset()}for(s=0;s<i.Cards.length;s++){if(e.length=0,i.Cards[s].List.length!=i.Cards[s].ListLen)for(a=0;a<i.Cards[s].ListLen;a++)i.Cards[s].List.push({CID:-1});for(n=0;n<i.Cards[s].List.length;n++)E.isReplay&&(void 0==i.Cards[s].List[n].cid&&i.Cards[s].List[n].cid,i.Cards[s].List[n].CID=i.Cards[s].List[n].cid),e.push({card:i.Cards[s].List[n].CID+1});if(this.model.updateAllCards(s,e),this.view.majiangPage.handPart.updateOnePosAllCards(s,this.model.allCardsVec[s]),this.view.majiangPage.handPart.updateTheFourteenCard(s,this.model.theFourteenCardVec[s]),E.isReplay){if(i.Cards[s].Hua){for(n=0;n<i.Cards[s].Hua.length;n++)E.isReplay&&(i.Cards[s].Hua[n].CID=i.Cards[s].Hua[n].cid,void 0==i.Cards[s].Hua[n].CID&&(i.Cards[s].Hua[n].CID=0)),o=i.Cards[s].Hua[n].CID+1,this.model.huaVec[s].push(o),0==this.model.majiangMsgs.ACK_RoomInfo.gameState?this.view.majiangPage.showBuhua(o,s,!0,!1):this.view.majiangPage.showBuhua(o,s,!1,!1,!1);this.view.playerInfoPage.updateHua(s)}if(i.Cards[s].Chow)for(n=0;n<i.Cards[s].Chow.length;n+=3){for(t=new F,a=0;3>a;a++)i.Cards[s].Chow[n+a].CID=void 0!=i.Cards[s].Chow[n+a].cid?i.Cards[s].Chow[n+a].cid:0,1==i.Cards[s].Chow[n+a].type?t.chicard=i.Cards[s].Chow[n+a].CID+1:t.chicards.push(i.Cards[s].Chow[n+a].CID+1);this.model.updateChiVec(s,t.chicard,t.chicards,(this.model.chairNum+s-1)%this.model.chairNum),this.view.majiangPage.pengGangPart.chi(t,s)}if(i.Cards[s].Peng)for(n=0;n<i.Cards[s].Peng.length;n++)i.Cards[s].Peng[n].CID=void 0!=i.Cards[s].Peng[n].cid?i.Cards[s].Peng[n].cid:0,i.Cards[s].Peng[n].TIndex=void 0!=i.Cards[s].Peng[n].target_index?i.Cards[s].Peng[n].target_index:0,this.model.updatePengVec(s,i.Cards[s].Peng[n].CID+1,i.Cards[s].Peng[n].TIndex),this.view.majiangPage.pengGangPart.peng(i.Cards[s].Peng[n].CID+1,s,i.Cards[s].Peng[n].TIndex);if(i.Cards[s].Kong)for(n=0;n<i.Cards[s].Kong.length;n++)i.Cards[s].Kong[n].CID=void 0!=i.Cards[s].Kong[n].cid?i.Cards[s].Kong[n].cid:0,i.Cards[s].Kong[n].type=void 0!=i.Cards[s].Kong[n].type?i.Cards[s].Kong[n].type:0,i.Cards[s].Kong[n].TIndex=void 0!=i.Cards[s].Kong[n].target_index?i.Cards[s].Kong[n].target_index:0,2==i.Cards[s].Kong[n].type?(this.model.updateGangVec(s,i.Cards[s].Kong[n].CID+1,0,i.Cards[s].Kong[n].TIndex,i.Cards[s].Kong[n]),this.view.majiangPage.pengGangPart.gang(i.Cards[s].Kong[n].CID+1,s,0,i.Cards[s].Kong[n].TIndex)):1==i.Cards[s].Kong[n].type?(this.model.updateGangVec(s,i.Cards[s].Kong[n].CID+1,1,i.Cards[s].Kong[n].TIndex),this.view.majiangPage.pengGangPart.gang(i.Cards[s].Kong[n].CID+1,s,1,i.Cards[s].Kong[n].TIndex)):0==i.Cards[s].Kong[n].type&&(this.model.updateGangVec(s,i.Cards[s].Kong[n].CID+1,2,i.Cards[s].Kong[n].TIndex),this.view.majiangPage.pengGangPart.gang(i.Cards[s].Kong[n].CID+1,s,2,i.Cards[s].Kong[n].TIndex))}}},s.ACKBC_Total=function(i){if(this.actived){if(console.log("ACKBC_Total::",i,"ACKBC_Total"),this.model.majiangMsgs.ACKBC_Total=i,E.isReplay&&(i.WinSeat=void 0!=i.WinSeat?i.WinSeat:0,i.WinCard=void 0!=i.WinCard?i.WinCard:0,i.round_count=void 0!=i.round_count?i.round_count:0,i.RoundCount=i.round_count),this.model.majiangMsgs.ACK_RoomInfo.RoundCount=i.RoundCount,this.view.tableInfoPage.updateLeftRound(!1),i.attached){var t=JSON.parse(i.attached);t&&this.view.majiangPage.pengGangPart.setChengbaoGang(parseInt(t.cid)+1,t.index)}this.view.playerInfoPage.updateSitDownUpBtn(!1);var e=x.getLocalVar("hasConcern",0);0==e?(x.setLocalVar("hasConcern",1),u.instance.commonContext.view.showNotice("       微信搜索公众号<span style='color:#f6d368;'> "+l.nameTitle+"麻将  </span>关注后即可获得更多福利哦！<br />",this,this.showCalculate)):this.showCalculate(),this.showCalculate()}},s.showCalculate=function(){this.model.isGameStart=!1,this.view.calculatePage.show(),this.model.setPlayerReadyFalse(),ae.instance.noticeHide()},s.NOTIFY_Summary=function(i){this.actived&&(console.log("MSG_NOTIFY_SUMMARY::",i,"大结算"),this.model.majiangMsgs.MSG_NOTIFY_SUMMARY=i)},s.AckDisband=function(i){this.actived&&(console.log("AckDisband::",i,"解散相关"),this.model.majiangMsgs.AckDisband=i,this.popDissolveRoomDetail(i))},s.NotifyDisband=function(i){if(this.actived){console.log("NotifyDisband::",i,"解散相关"),this.model.majiangMsgs.NotifyDisband=i,this.hideDissolveRoomDetail();var t="";1==i.result?t="解散成功！":(t="解散失败！",x.popMessageBox(t,"BTN_NONE",this,null))}},s.ACKBC_Card_Init=function(i){this.actived&&(console.log("ACKBC_Card_Init",i,"ACKBC_Card_Init"),this.model.majiangMsgs.ACKBC_Card_Init=i,void 0==i.CurIndex&&(i.CurIndex=0),void 0==i.ZhuangIndex&&(i.ZhuangIndex=0),void 0==i.CardLeft&&(i.CardLeft=0),this.model.leftDesktopCardsNum=i.CardLeft,this.model.zhuangpos=i.ZhuangIndex,this.view.majiangPage.clockPart.noticeShowLeftCardsNum(),this.view.playerInfoPage.showZhuang(),this.view.majiangPage.clockPart.dingDongwei(this.model.zhuangpos,!0,!1),0==E.isReplay&&this.view.majiangPage.clockPart.noticeShowClock(i.CurIndex,10))},s.NotifyUserState=function(i){if(this.actived){console.log("NotifyUserState",i,"NotifyUserState"),this.model.majiangMsgs.NotifyUserState=i;var t=this.model.playerByUid(i.id);t.state=i.state,t.offlineTime=i.offlineTime;var e=this.model.getPlayerPosByUid(parseInt(i.id)),s=this.model.getChairDirByPos(e),n=!1;2==i.state&&(n=!0),this.view.playerInfoPage.setGrayhead(s,n,!0,i.offlineTime)}},s.NotifyKick=function(i){if(this.actived){console.log("NotifyKick",i,"NotifyKick");var t,e=0,s=i.indexs.length;for(e=0;s>e;e++)t=this.model.playerByPos(i.indexs[e]),t.offlineTime=0,t.canKick=!0;this.view.playerInfoPage.updateTirenBtn()}},s.KickResponse=function(i){this.actived&&(x.popBox&&x.popBox.onhide(),this.model.standup(i.uid,-1),this.model.beKickedPlayer[i.pos]=i.uid,this.model.playerByUid(i.uid).offlineTime=0,this.view.playerInfoPage.updatePlayerInfos(this.model.playerInfoVec),this.view.playerInfoPage.updateSitDownUpBtn(),this.view.playerInfoPage.updateStartBtn(),this.view.tableInfoPage.updateKaijuren(i.nickName),m.instance.event("COMMON_INFOLIST_NOTICE",{color:0,msg:"玩家["+this.model.getPlayerNicknameByUid(i.uid)+"]站起了！"}),x.popMessageBox("玩家["+this.model.getPlayerNicknameByUid(i.uid)+"]被其他玩家请离座位!","BTN_QUEREN",this,this.onQuerenBeiTi))},s.onQuerenBeiTi=function(){},s.NotifyDestoryRoom=function(i){this.actived&&(console.log("NotifyDestoryRoom",i,"NotifyDestoryRoom"),this.pop=x.popMessageBox("由于在规定时间内未开始游戏，房间已经强制解散！","BTN_QUEREN",this,this.onQueRenExit,"提示","left"))},s.onQueRenExit=function(){l.isNewHall?x.gotoHall():this.endGameGotoHall()},s.onPopPanelCallBack=function(){l.isNewHall?x.gotoHall():this.endGameGotoHall()},s.endGameGotoHall=function(i){void 0===i&&(i=!0),console.log("send MsgTypes.BASE_QUEUE,PomeloMessage.hall_g_o..."),null!=this.pop&&this.pop.onhide(),this.hideDissolveRoomDetail(),this.contineGameQueue(),this.model.reset(),this.view.reset(),this.model.playerInfoVec.length=0,E.isReplay&&(E.isPreReplay=!0),u.instance.regotoCommonText(),wt.instance.stopGame(i),E.isReplay=!1,0==this.model.isGameStart},s.clear=function(){this.model.reset(),this.view.reset(),this.model.playerInfoVec.length=0,E.isReplay&&m.instance.event("REPLAY_back",null),E.isReplay=!1,0==this.model.isGameStart},s.ACK_TransferHuaResponse=function(){},s.MSG_ACK_Gift=function(i){if(this.actived){console.log("MSG_ACK_Gift",i,"MSG_ACK_Gift");var t=this.model.playerByUid(i.uid),e=this.model.playerByUid(i.tUid);t.Diamond=i.diamond;var s=this.model.getChairDirByPos(t.pos),n=this.model.getChairDirByPos(e.pos);i.uid==E.uid&&(E.Diamond=i.diamond),vt.instance.showGiftEff(s,n,i.id)}},s.clearTimeDelay=function(){m.instance.off("GAME_START_SHAIZI_DONGFENG_COMP",this,this.onFirstShaiziComp,!0),e.timer.clear(this,this.playEachShaiziEff),e.timer.clear(this,this.onEachEffEnd),e.timer.clear(this,this.contineGameQueue)},s.control_game_operation_hu=function(){this._actived},s.onDelayCallHu=function(){this._actived&&this.showCalculate()},s.resetSelf=function(){this.view.playerInfoPage.hideReadyBtn(),this.view.playerInfoPage.hideZhuang(),this.view.calculatePage.reset(),this.model.reset(),this.view.majiangPage.reset()},s.sendMsgCommond=function(i,t){void 0===t&&(t=!0),t&&this.view.majiangPage.handPart.canControl(this.model.selfChairPos,!1),console.log(i),m.instance.event("SOCKET_SEND",i)},s.pauseGameQueue=function(){E.isReplay?this.model.needCutdownReplay=!0:k.instance.pauseQueue("MESSAGE_GAME")},s.contineGameQueue=function(){E.isReplay?this.model.needCutdownReplay=!1:k.instance.continueQueue("MESSAGE_GAME")},s.popDissolveRoomDetail=function(i){null==this.dissolvePage&&(this.dissolvePage=new b),this.dissolvePage.update(i),x.AddCenter(this.dissolvePage,N.instance.popLayer),x.popBox&&x.popBox.onhide()},s.hideDissolveRoomDetail=function(){this.dissolvePage&&this.dissolvePage.parent&&this.dissolvePage.parent.removeChild(this.dissolvePage)},s.onTimeOver=function(){this.model.isGameStart||(this.view.calculatePage.perPage.isShow?this.view.calculatePage.perPage.timeOver():this.view.calculatePage.perPage.onClickConfirmBtn())},s.sendRandom=function(){return},s.recoveryByReplayData=function(i){if(this.actived){this.model.recoveryByReplayData(i),this.view.majiangPage.handPart.updateAllCards(this.model.allCardsVec),this.view.majiangPage.handPart.updateTheFourteenCards(this.model.theFourteenCardVec);var t=0,e=this.model.chairNum;for(t=0;e>t;t++)this.view.majiangPage.huaPart.showBuhuaCards(this.model.huaVec[t],t),this.view.majiangPage.outputPart.showCardsByPos(t,this.model.outputCardsVec[t]),this.view.majiangPage.pengGangPart.recoveryChi(this.model.chiVec[t],t),this.view.majiangPage.pengGangPart.recoveryPeng(this.model.pengVec[t],t,this.model.pengFromVec[t]),this.view.majiangPage.pengGangPart.recoveryGang(this.model.mingGangVec[t],t,2,this.model.mingGangFromVec[t]),this.view.majiangPage.pengGangPart.recoveryGang(this.model.anGangVec[t],t,1,this.model.anGangFromVec[t]);this.view.majiangPage.handPart.canControl(this.model.curHandlePos,!0),this.view.majiangPage.clockPart.noticeShowClock(this.model.curHandlePos,10),this.view.majiangPage.clockPart.noticeShowLeftCardsNum(),this.view.majiangPage.outputPart.showCurSimbolByPos(this.model.curOutPutPos)}},s.pass=function(i){E.isReplay&&(i.SID==E.selfuid?this.view.majiangPage.handleBtns.hide():x.popMessage(this.model.getPlayerNicknameByUid(parseInt(i.SID))+"选择了过！"))},s.showPreDiscardEff=function(i){this.view.majiangPage.handPart.showPreDiscardEff(i),this.view.majiangPage.outputPart.showPreDiscardEff(i),this.view.majiangPage.pengGangPart.showPreDiscardEff(i)},s.hidePreDiscardEff=function(){this.view.majiangPage.handPart.hidePreDiscardEff(),this.view.majiangPage.outputPart.hidePreDiscardEff(),this.view.majiangPage.pengGangPart.hidePreDiscardEff()},a(0,s,"model",function(){return wt.instance.gameContext.model}),a(0,s,"view",function(){return wt.instance.gameContext.view}),t.PRE_COMM_ADD="05",t}(h),Vt=function(i){function t(){this.isStrictShowCalc=!1,this.beKickedPlayer={},this.isAutoHandle=!1,this.koupaiwancheng=!1,this.isDragingcard=!1,this.isNeedSkipHuAni=!1,this.warnCThenBaoipStr="\n点击确认会承包对方，是否确认？",this.isGameStart=!1,this.preStepNum=4,this.replayData=[],this.replayCurStep=0,this.replayState=0,this.needCutdownReplay=!1,this.isClientPrePop=!1,this.isClientPrePopCard=0,this.fengquan=0,this.tingCardsOfKouBtn=[],this.tingCardsOfCancelBtn=[],this.kouCards=[],this.chengBaoArr=[],this.isSelfSitDown=!1,this.baida=[],this.isHu=!1,this.isLiu=!1,this.leftDesktopCardsNum=0,this._chairNum=3,this.huArr=[],this.selfChairPos=0,this.lastHuanHuaCard=-1,this.yingjiaArr=[],this.paoshouArr=[],this.usersOfRoundData=[],this.isNextCancelBtnKou=!1,this.isCancelTingp=!1,this.theTingCardBeforKou=0,this.tempGangCards=[],this.isNextGang=!1,this.tempKouCards=[],this.reenterOutpuCardsVec=null,this.reenterHuCardsVec=null,this.curHandlePos=0,this.curOutPutPos=-1,this.zhuangpos=0,this.canLiCards=[],this.appendDownCards=[],this.replayAllStepData=[],this.pengGangStepObj=new Object,this.majiangMsgs=new K,this.playerInfoVec=[],this.huaVec=[],this.overHuaVec=[],this.huaNum=[],this.chiVec=[],this.chiFromVec=[],this.pengVec=[],this.pengFromVec=[],this.mingGangVec=[],this.mingGangFromVec=[],this.anGangVec=[],this.anGangFromVec=[],this.kouVec=[],this.outputCardsVec=[],this.allCardsVec=[],this.theFourteenCardVec=[],this.isTingVec=[],this.TingHuCardVec=[],this.TingDownCardVec=[],this.selfOutputCardPos=new V,t.__super.call(this)}n(t,"modules.game.majiangGame.model.MajiangModel",i);var e=t.prototype;return e.initData=function(){},e.onAdd=function(){},e.onRemove=function(){},e.setPlayerReadyFalse=function(){var i=0,t=this.playerInfoVec.length;for(i=0;t>i;i++)this.playerInfoVec[i].readystate=0},e.getHuaArr=function(i,t){var e=[],s=0,n=[];s=this.getshaiziIdxByPos(t),n.push(35+s),2==s?s=3:3==s&&(s=2),n.push(39+s);var a=0,o=this.huaVec[t].length;for(a=0;o>a;a++)-1!=n.indexOf(this.huaVec[t][a])?0==i&&e.push(this.huaVec[t][a]):1==i&&e.push(this.huaVec[t][a]);return e},e.resetCard=function(){var i=0,t=this._chairNum;for(i=0;t>i;i++)this.outputCardsVec[i].length=0,this.huaVec[i].length=0,this.chiVec[i].length=0,this.chiFromVec[i].length=0,this.pengVec[i].length=0,this.pengFromVec[i].length=0,this.mingGangVec[i].length=0,this.mingGangFromVec[i].length=0,this.anGangVec[i].length=0,this.anGangFromVec[i].length=0,this.kouVec[i].length=0,this.theFourteenCardVec[i]=-1},e.reset=function(){this.beKickedPlayer={};var i=0,t=this._chairNum;for(i=0;t>i;i++)this.outputCardsVec[i].length=0,this.huaVec[i].length=0,this.chiVec[i].length=0,this.chiFromVec[i].length=0,this.pengVec[i].length=0,this.pengFromVec[i].length=0,this.mingGangVec[i].length=0,this.mingGangFromVec[i].length=0,this.anGangVec[i].length=0,this.anGangFromVec[i].length=0,this.kouVec[i].length=0,this.theFourteenCardVec[i]=-1,this.isTingVec[i]=!1,this.TingHuCardVec[i].length=0,this.TingDownCardVec[i].length=0,this.overHuaVec[i]=0;this.curOutPutPos=-1,this.isHu=!1,this.isLiu=!1,this.leftDesktopCardsNum=0,this.tempKouCards=[],this.isNextCancelBtnKou=!1,this.theTingCardBeforKou=0,this.tingCardsOfKouBtn=[],this.tingCardsOfCancelBtn=[],this.kouCards=[],this.curHandlePos=0,this.koupaiwancheng=!1,this.majiangMsgs.control_game_operation_hucard_info=null,this.huArr.length=0},e.updateOnePlayerInfo=function(i){i.sex=i.pos%2==0?1:2;var t=0,e=this.playerInfoVec.length,s=!1;for(t=0;e>t;t++)if(this.playerInfoVec[t]&&this.playerInfoVec[t].uid==i.uid){this.playerInfoVec[t].pos!=i.pos&&console.log("传过来的数据有错误!!!!!!"),this.updateObjFromObj(this.playerInfoVec[t],i),s=!0;break}0==s&&this.playerInfoVec.push(i),i.uid==E.selfuid&&(this.selfChairPos=i.pos,-1==this.selfChairPos?(this.isSelfSitDown=!1,this.selfChairPos=0):this.isSelfSitDown=!0)},e.playerByPos=function(i){var t=0,e=this.playerInfoVec.length;for(t=0;e>t;t++)if(this.playerInfoVec[t]&&this.playerInfoVec[t].pos==i)return this.playerInfoVec[t];return null},e.playerByUid=function(i){var t=0,e=this.playerInfoVec.length;for(t=0;e>t;t++)if(this.playerInfoVec[t]&&this.playerInfoVec[t].uid==i)return this.playerInfoVec[t];return null},e.getPlayerPosByUid=function(i){var t=0,e=this.playerInfoVec.length;for(t=0;e>t;t++)if(this.playerInfoVec[t]&&this.playerInfoVec[t].uid==i)return this.playerInfoVec[t].pos;return 0},e.getshaiziIdxByPos=function(i){for(var t=0;t<this.chairNum;t++)if(i==(this.zhuangpos+t)%this.chairNum)return t;return 0},e.getPlayerUidByPos=function(i){var t=0,e=this.playerInfoVec.length;for(t=0;e>t;t++)if(this.playerInfoVec[t]&&this.playerInfoVec[t].pos==i)return this.playerInfoVec[t].uid;return 0},e.getPlayerNicknameByUid=function(i){var t=0,e=this.playerInfoVec.length;for(t=0;e>t;t++)if(this.playerInfoVec[t]&&this.playerInfoVec[t].uid==i)return this.playerInfoVec[t].nickname;return""},e.updateObjFromObj=function(i,t){i.prePos=i.pos;for(var e in t)void 0!=t[e]&&(i[e]=t[e])},e.sitDown=function(i,t,e){var s=0,n=this.playerInfoVec.length;for(s=0;n>s;s++)this.playerInfoVec[s]&&this.playerInfoVec[s].uid==i&&(this.playerInfoVec[s].pos=t,this.playerInfoVec[s].score=e,this.playerInfoVec[s].canKick=!1,i==E.selfuid&&(-1!=t?(this.isSelfSitDown=!0,this.selfChairPos=t):(this.isSelfSitDown=!1,this.selfChairPos=0)))},e.standup=function(i,t){var e=0,s=this.playerInfoVec.length;for(e=0;s>e;e++)this.playerInfoVec[e]&&this.playerInfoVec[e].uid==i&&(this.playerInfoVec[e].pos=t,this.playerInfoVec[e].canKick=!1,i==E.selfuid&&(-1!=t?(this.isSelfSitDown=!0,this.selfChairPos=t):(this.isSelfSitDown=!1,this.selfChairPos=0)))},e.leavePlayer=function(i){var t=0,e=this.playerInfoVec.length;for(t=0;e>t;t++)if(this.playerInfoVec[t]&&this.playerInfoVec[t].uid==i){this.playerInfoVec.splice(t,1);break}},e.updatePlayerInfoVec=function(i){var t,e=0,s=i.length;for(e=0;s>e;e++)t=i[e],E.isReplay&&(t.index=void 0!=t.index?t.index:0,t.diamond=void 0!=t.diamond?t.diamond:0,t.Icon=void 0!=t.Icon?t.Icon:"",t.score=void 0!=t.score?t.score:0,t.coin=void 0!=t.coin?t.coin:0,t.readystate=void 0!=t.readystate?t.readystate:0,t.uid=void 0!=t.uid?t.uid:0,t.IP=void 0!=t.IP?t.IP:"",t.Name=t.name,t.Index=t.index,t.Coin=t.coin,t.readystate=1,t.UID=t.uid,t.Diamond=t.diamond,t.icon&&(t.Icon=t.icon)),t.nickname=t.Name,t.uid=t.UID,t.ip=t.IP,t.pos=t.Index,t.golds=t.Coin,(""!=t.uid||0!=t.uid)&&(3==t.state?(this.beKickedPlayer[t.pos]=t.uid,t.state=1,t.pos=-1):4==t.state&&(this.beKickedPlayer[t.pos]=t.uid,t.state=2,t.pos=-1),this.updateOnePlayerInfo(i[e]))},e.checkTianhu=function(){var i=0,t=0;for(t=this.chairNum,i=0;t>i;i++){if(this.chiVec[i].length>0)return!1;if(this.pengVec[i].length>0)return!1;if(this.anGangVec[i].length>0)return!1;if(this.mingGangVec[i].length>0)return!1;if(this.outputCardsVec[i].length>0)return!1}return!0},e.getChairDirByPos=function(i){if(-1==i)return-1;var t=0;return t=i-this.selfChairPos,0>t&&(t+=this.chairNum),t},e.getChairPosByDir=function(i){var t=0;return t=this.selfChairPos+i,t>this.chairNum-1&&(t-=this.chairNum),t},e.sortAllCards=function(i){this.allCardsVec[i].sort(this.compareFunction),this.pushToHeadBaida(i)},e.compareFunction=function(i,t){return t>i?-1:i==t?0:1},e.cutChiCard=function(i,t){if(this.isSelfSitDown&&(i==this.selfChairPos||E.isReplay)){var e=t,s=0,n=e.length,a=0,o=0;for(s=0;n>s;s++)a=this.allCardsVec[i].indexOf(e[s]),-1!=a&&(this.allCardsVec[i].splice(a,1),o+=1);2!=o&&x.popMessageBox("给玩家吃牌的数据有问题！！！吃掉的牌 "+t[0]+" "+t[1],"BTN_QUEREN",null,null,"错误")}else this.allCardsVec[i].splice(0,2)},e.cutPengCard=function(i,t){if(this.isSelfSitDown&&i==this.selfChairPos){var e=[t,t],s=0,n=e.length,a=0,o=0;for(s=0;n>s;s++)a=this.allCardsVec[i].indexOf(e[s]),-1!=a&&(this.allCardsVec[i].splice(a,1),o+=1);2!=o&&x.popMessageBox("给玩家碰牌的数据有问题！！！碰掉的牌 "+t,"BTN_QUEREN",null,null,"错误")}else this.allCardsVec[i].splice(0,2)},e.cutGangCard=function(i,t,e){console.log("cutGangCard :: pos:: "+i+" cardIdx::"+Q.CARD_REFERENCE[t]+" type:: "+e);var s,n=0,a=0,o=0;if(1==this.isTingVec[i]&&this.kouVec[i].length>0&&0!=e&&(this.kouVec[i].length-=1),this.isSelfSitDown&&i==this.selfChairPos)switch(e){case 0:-1!=this.theFourteenCardVec[i]?this.theFourteenCardVec[i]==t?this.theFourteenCardVec[i]=-1:(a=this.allCardsVec[i].indexOf(t),-1!=a&&this.allCardsVec[i].splice(a,1),this.allCardsVec[i].push(this.theFourteenCardVec[i]),this.theFourteenCardVec[i]=-1,this.sortAllCards(i)):(a=this.allCardsVec[i].indexOf(t),-1!=a&&this.allCardsVec[i].splice(a,1),this.sortAllCards(i));break;case 1:for(-1==this.theFourteenCardVec[i]?s=[t,t,t,t]:this.theFourteenCardVec[i]==t?(this.theFourteenCardVec[i]=-1,s=[t,t,t]):(s=[t,t,t,t],this.allCardsVec[i].push(this.theFourteenCardVec[i]),this.theFourteenCardVec[i]=-1,this.sortAllCards(i)),o=s.length,n=0;o>n;n++)a=this.allCardsVec[i].indexOf(s[n]),-1!=a&&this.allCardsVec[i].splice(a,1);break;case 2:for(s=[t,t,t],o=s.length,n=0;o>n;n++)a=this.allCardsVec[i].indexOf(s[n]),-1!=a&&(this.allCardsVec[i].splice(a,1),console.log("从自己牌里面去掉了一张 ：："+s[n]))}else switch(e){case 0:-1!=this.theFourteenCardVec[i]?this.theFourteenCardVec[i]=-1:this.allCardsVec[i].splice(0,1);break;case 1:-1!=this.theFourteenCardVec[i]?(this.theFourteenCardVec[i]=-1,1==this.isTingVec[i]?this.allCardsVec[i].splice(this.TingDownCardVec[i].length,3):this.allCardsVec[i].splice(0,3)):1==this.isTingVec[i]?this.allCardsVec[i].splice(this.TingDownCardVec[i].length,4):this.allCardsVec[i].splice(0,4);break;case 2:1==this.isTingVec[i]?this.allCardsVec[i].splice(this.TingDownCardVec[i].length,3):this.allCardsVec[i].splice(0,3)}},e.updateAllCardsVecByGameStart=function(i){console.log("selfCards ::"+i);var t=0,e=this.allCardsVec.length;for(t=0;e>t;t++)if(t==this.selfChairPos){this.allCardsVec[t]=[];var s=0,n=i.length;for(s=0;n>s;s++)this.allCardsVec[t].push(i[s].card)}else this.allCardsVec[t]=new Array(0,0,0,0,0,0,0,0,0,0,0,0,0);console.log("selfChairPos::"+this.selfChairPos),this.sortAllCards(this.selfChairPos)},e.outputCard=function(i,t){if(this.curOutPutPos=i,this.outputCardsVec[i].push(t),this.isSelfSitDown&&i==this.selfChairPos){if(-1!=this.theFourteenCardVec[i]&&this.theFourteenCardVec[i]==t)return this.theFourteenCardVec[i]=-1,void 0;var e=this.allCardsVec[i].indexOf(t);-1!=e&&this.allCardsVec[i].splice(e,1),-1!=this.theFourteenCardVec[i]&&(this.allCardsVec[i].push(this.theFourteenCardVec[i]),this.sortAllCards(i),this.theFourteenCardVec[i]=-1)}else{if(-1!=this.theFourteenCardVec[i])return this.theFourteenCardVec[i]=-1,void 0;this.allCardsVec[i].splice(0,1)}},e.updatePengVec=function(i,t,e){this.pengVec[i]&&(this.pengVec[i].push(t),this.pengFromVec[i].push(e))},e.updateBuhua=function(i,t,e){if(this.huaVec[i]&&(this.huaVec[i]=this.huaVec[i].concat(t),E.isReplay||i==this.selfChairPos)){var s=0,n=t.length,a=0;for(s=0;n>s;s++)a=this.allCardsVec[i].indexOf(t[s]),-1!=a&&this.allCardsVec[i].splice(a,1);for(n=e.length,s=0;n>s;s++)this.allCardsVec[i].push(e[s]);this.lastHuanHuaCard=e[e.length-1],this.sortAllCards(i)}},e.updateChiVec=function(i,t,e){if(this.chiVec[i]){var s=new F;s.chicard=t,s.chicards=e,this.chiVec[i].push(s),this.chiFromVec[i].push((this.chairNum+i-1)%this.chairNum)}},e.getChiCards=function(i,t){if(this.chiVec[i])for(var e=0;e<this.chiVec[i].length;e++)if(this.chiVec[i][e].chicard==t)return this.chiVec[i][e].chicards;return[]},e.updateGangVec=function(i,t,e,s,n){switch(console.log("updateGangVec:: pos::"+i+" cardIdx::"+t+" type::"+e),e){case 0:if(-1!=this.mingGangVec[i].indexOf(t))return!0;this.mingGangVec[i].push(t);var a=this.pengVec[i].indexOf(t);-1!=a&&(s==this.selfChairPos&&(s=this.pengFromVec[i][a]),this.pengVec[i].splice(a,1),this.pengFromVec[i].splice(a,1)),n&&(n.TIndex=s,n.TSeat=s),this.mingGangFromVec[i].push(s);break;case 1:if(-1!=this.anGangVec[i].indexOf(t))return!0;this.anGangVec[i].push(t),this.anGangFromVec[i].push(t);break;case 2:if(-1!=this.mingGangVec[i].indexOf(t))return!0;this.mingGangVec[i].push(t),this.mingGangFromVec[i].push(s)}return!1},e.compareType=function(i,t){return i.type<t.type?1:i.type==t.type?i.card<t.card?-1:i.card==t.card?0:1:-1},e.updateAllCards=function(i,t){this.TingDownCardVec[i].length=0;var e=0,s=t.length;s%3==2&&(this.theFourteenCardVec[i]=t[s-1].card,s=t.length-1,t.length=s),t.sort(this.compareType),console.log("更新玩家手里的牌len::"+s),s>13&&(this.theFourteenCardVec[i]=t[s-1].card,t.length=13,s=t.length),this.allCardsVec[i].length=s;var n=0;for(e=0;s>e;e++)this.allCardsVec[i][e]=t[e].card,console.log("allCardsVec[pos][i] i::"+e+" card::"+t[e].card),i==this.selfChairPos?1==t[e].type&&-1==this.kouVec[i].indexOf(t[e].card)&&this.kouVec[i].push(t[e].card):1==t[e].type&&1==t[e].type&&(E.isReplay?-1==this.kouVec[i].indexOf(t[e].card)&&this.kouVec[i].push(t[e].card):n+=1),2==t[e].type&&this.TingDownCardVec[i].push(t[e].card);
i!=this.selfChairPos&&0==E.isReplay&&(this.kouVec[i].length=n/3),this.pushToHeadBaida(i)},e.pushToHeadBaida=function(i){var t=this.majiangMsgs.control_game_operation_tableinfo_Info;if(t&&8==t.roomtype){var e=this.baida[1],s=0,n=this.allCardsVec[i].length,a=[];for(s=0;n>s;s++)this.allCardsVec[i][s]==e&&(a.push(this.allCardsVec[i][s]),this.allCardsVec[i].splice(s,1),s--);this.allCardsVec[i]=a.concat(this.allCardsVec[i])}},e.updateAllCardsAfterHu=function(i,t){var e=0,s=0;for(s=t.length,s%3==2?(this.theFourteenCardVec[i]=t[t.length-1].card,s=t.length-1):s=t.length,t.length=s,t.sort(this.compareType),this.allCardsVec[i].length=s,e=0;s>e;e++)this.allCardsVec[i][e]=t[e].card;this.pushToHeadBaida(i)},e.processRoundData=function(){this.yingjiaArr.length=0,this.paoshouArr.length=0;var i=this.majiangMsgs.control_game_settlement_Info.userinfos,t=0,e=i.length;for(t=0;e>t;t++)this.usersOfRoundData[this.getPlayerPosByUid(i[t].uid)]=i[t],null==this.yingjiaArr[0]?i[t].zongchengji>0&&(this.yingjiaArr[0]=i[t]):i[t].zongchengji>this.yingjiaArr[0].zongchengji?(this.yingjiaArr[0]=i[t],this.yingjiaArr[1]=null,this.yingjiaArr[2]=null):i[t].zongchengji==this.yingjiaArr[0].zongchengji&&this.yingjiaArr.push(i[t]),null==this.paoshouArr[0]?i[t].dianpaocount>0&&(this.paoshouArr[0]=i[t]):i[t].dianpaocount>this.paoshouArr[0].dianpaocount?(this.paoshouArr[0]=i[t],this.paoshouArr[1]=null,this.paoshouArr[2]=null):i[t].dianpaocount==this.paoshouArr[0].dianpaocount&&this.paoshouArr.push(i[t])},e.getKouCards=function(i){var t,e=this.majiangMsgs.control_game_mjopration_Info.nopercard,s=[],n=0,a=e.length;for(n=0;a>n;n++)e[n].card==i&&(t=e[n].nkoucard);if(null!=t&&t.length>0)for(n=0;n<t.length;n++)s.push(t[n].card);return s},e.updateReadyState=function(i,t,e){var s=0,n=this.playerInfoVec.length;for(s=0;n>s;s++)if(this.playerInfoVec[s]&&this.playerInfoVec[s].pos==i){this.playerInfoVec[s].readystate=!0,this.playerInfoVec[s].piao=e;break}},e.gethuCards=function(i){var t=[],e=0,s=0,n=0;if(null!=this.majiangMsgs.control_game_operation_hucard_info){var a=this.majiangMsgs.control_game_operation_hucard_info;for(n=a.nting.length,e=0;n>e;e++)if(a.nting[e].card==i){for(s=0;s<a.nting[e].nhu.length;s++)t.push(a.nting[e].nhu[s].card);break}}if(0==t.length){var o=this.majiangMsgs.control_game_mjopration_Info.nopercard;for(n=o.length,e=0;n>e;e++)if(1==o[e].type&&o[e].card==i){for(s=0;s<o[e].nhucard.length;s++)t.push(o[e].nhucard[s].card);break}}return t},e.cutOutput=function(i,t){var e=this.outputCardsVec[i].indexOf(t);-1!=e&&this.outputCardsVec[i].splice(e,1)},e.judgeHua=function(i){var t=[35,36,37,38,39,40,41,42];return-1!=t.indexOf(i)?!0:!1},e.checkHaveHua=function(i){for(var t=this.allCardsVec[i],e=0;e<t.length;e++)if(1==this.judgeHua(t[e]))return!0;return!1},e.getGangtouRefArr=function(i){return t.GangtouCardArr[(i+this.chairNum-this.zhuangpos)%this.chairNum]},e.getRefZhuangPos=function(i){return(i+this.chairNum-this.zhuangpos)%this.chairNum},e.getGangtouCardImg=function(i,t){void 0===t&&(t=!0);var e="",s=1,n=19,a=10;switch(i){case s:case n:case a:e="1";break;case s+1:case n+1:case a+1:e="2";break;case s+2:case n+2:case a+2:e="3";break;case s+3:case n+3:case a+3:e="4";break;case s+4:case n+4:case a+4:e="5";break;case s+5:case n+5:case a+5:e="6";break;case s+6:case n+6:case a+6:e="7";break;case s+7:case n+7:case a+7:e="8";break;case s+8:case n+8:case a+8:e="9";break;case 769:e="东";break;case 1537:e="春";break;case 1281:e="梅";break;case 1025:e="中";break;case 785:e="南";break;case 1553:e="夏";break;case 1297:e="兰";break;case 1041:e="发";break;case 801:e="西";break;case 1569:e="秋";break;case 1329:e="竹";break;case 1057:e="白";break;case 817:e="北";break;case 1584:e="冬";break;case 1313:e="菊"}return 0==t&&(e+="-1"),"gametable/zhuama/"+e+".png"},e.getHuTipArr=function(i,e){void 0===e&&(e=-1);var s,n=[];s=-1!=this.theFourteenCardVec[this.selfChairPos]?this.allCardsVec[this.selfChairPos].concat(this.theFourteenCardVec[this.selfChairPos]):this.allCardsVec[this.selfChairPos].concat();var a=s.indexOf(i);-1!=a&&s.splice(a,1);var o=0,h=t.all_Cards.length;for(o=0;h>o;o++)1==this.judgeHu(s.concat(t.all_Cards[o]),e)&&n.push(t.all_Cards[o]);return n},e.getSplitBaidaCard=function(i,t){var e=[],s=0,n=i.length,a=[],o=[];for(s=0;n>s;s++)i[s]==t?a.push(i[s]):o.push(i[s]);return e},e.judgeHu=function(i,t){void 0===t&&(t=-1),i.sort(this.compareFunction);var e=0,s=i.length,n=!1;if(s%3!=2)return!1;if((11==E.roomtype||10==E.roomtype)&&14==s){var a=!0;for(e=0;7>e;e++)i[2*e]!=i[2*e+1]&&(a=!1);if(1==a)return!0}var o=this.getPaiduizi(i);if(0==o.length)return!1;var h,r=0,l=0;for(r=0;r<o.length;r++)if(h=i.concat(),l=h.indexOf(o[r]),-1!=l&&h.splice(l,1),l=h.indexOf(o[r]),-1!=l&&h.splice(l,1),1==this.getCan33(h)){n=!0;break}return n},e.getCan33=function(i){if(i.sort(this.compareFunction),0==i.length)return!0;var t=!1,e=0,s=0;if(i[0]==i[1]&&i[1]==i[2]){var n=i.concat();if(i.splice(0,3),t=this.getCan33(i),0==t){i=n;var a=i[0];if(32==a||33==a||34==a||28==a||29==a||30==a||31==a||8==a||9==a||17==a||18==a||26==a||27==a)return!1;if(e=i.indexOf(a+1),s=i.indexOf(a+2),-1==e||-1==s)return!1;i.splice(0,1),i.splice(i.indexOf(a+1),1),i.splice(i.indexOf(a+2),1),t=this.getCan33(i)}}else{if(32==a||33==a||34==a||28==a||29==a||30==a||31==a||8==a||9==a||17==a||18==a||26==a||27==a)return!1;if(e=i.indexOf(a+1),s=i.indexOf(a+2),-1==e||-1==s)return!1;i.splice(0,1),i.splice(i.indexOf(a+1),1),i.splice(i.indexOf(a+2),1),t=this.getCan33(i)}return t},e.getPaiduizi=function(i){var t=[],e=0,s=(i.length,new Object),n=-1;for(e=0;e<i.length;e++)i[e]==n?(s[n]+=1,2==s[n]&&t.push(n)):(n=i[e],s[n]=1);return t},e.getTingDownCards=function(i,t){var e=this.allCardsVec[this.selfChairPos].concat();-1!=this.theFourteenCardVec[this.selfChairPos]&&(e=e.concat(this.theFourteenCardVec[this.selfChairPos]));var s=e.indexOf(i);-1!=s&&e.splice(s,1);var n=0;for(n=0;n<t.length;n++)s=e.indexOf(t[n]),-1!=s&&e.splice(s,1),s=e.indexOf(t[n]),-1!=s&&e.splice(s,1),s=e.indexOf(t[n]),-1!=s&&e.splice(s,1);this.canLiCards=[];var a=[],o=this.gethuCards(i),h=!1;if(1==o.length){if((11==E.roomtype||10==E.roomtype)&&this.isHuqixiaodui(e.concat(o[0])))return{canDownCards:[o[0]],isHaveJiang:!1,jiangpai:0}}else{for(n=0;n<o.length;n++)(11==E.roomtype||10==E.roomtype)&&this.isHuqixiaodui(e.concat(o[n]))&&(h=!0);if(1==h)return{canDownCards:this.allCardsVec[this.selfChairPos],isHaveJiang:!1,jiangpai:0}}for(this.judgeHuZhidingCards(o,e),n=0;n<this.canLiCards.length;n++)s=e.indexOf(this.canLiCards[n]),-1!=s&&e.splice(s,1);a=e.concat();var r,l=this.getPaiduizi(e),c=!1,d=0,u=0,g=!0;for(u=0;u<l.length;u++){r=e.concat(),s=r.indexOf(l[u]),-1!=s&&r.splice(s,1),s=r.indexOf(l[u]),-1!=s&&r.splice(s,1);for(var m=!0,f=0;f<o.length;f++)0==this.getCan33(r.concat(o[f]))&&(m=!1);if(1==m){g=!0,e=r,c=!0,d=l[u];break}}return a=e.concat(this.appendDownCards),{canDownCards:a,isHaveJiang:c,jiangpai:d}},e.isHuqixiaodui=function(i){i.sort(this.compareFunction);var t=0,e=i.length;if(e%3!=2)return!1;if(14==e){var s=!0;for(t=0;7>t;t++)i[2*t]!=i[2*t+1]&&(s=!1);if(1==s)return!0}return!1},e.judgeHuZhidingCards=function(i,t){this.appendDownCards=[];var e=this.getPaizu(t),s=0,n=e.length,a=t.concat(),o=0;for(s=0;n>s;s++){o=a.indexOf(e[s][0]),-1!=o&&a.splice(o,1),o=a.indexOf(e[s][1]),-1!=o&&a.splice(o,1),o=a.indexOf(e[s][2]),-1!=o&&a.splice(o,1);var h=!0,r=0;for(r=0;r<i.length;r++)0==this.judgeHu(a.concat(i[r]))&&(h=!1);if(1==h)return this.canLiCards.push(e[s][0],e[s][1],e[s][2]),this.judgeHuZhidingCards(i,a),void 0;a.push(e[s][0],e[s][1],e[s][2])}},e.getPaizu=function(i){i.sort(this.compareFunction);var t=this.getPaizuKe(i).concat(this.getPaizuShun(i));return t},e.getPaizuKe=function(i){var t=[],e=0,s=(i.length,new Object),n=-1;for(e=0;e<i.length;e++)i[e]==n?(s[n]+=1,3==s[n]&&t.push([n,n,n])):(n=i[e],s[n]=1);return t},e.getPaizuShun=function(i){var t=[],e=0,s=(i.length,new Object,0),n=0,a=0;for(e=0;e<i.length-2;e++)s=i[e],32!=s&&33!=s&&34!=s&&28!=s&&29!=s&&30!=s&&31!=s&&8!=s&&9!=s&&17!=s&&18!=s&&26!=s&&27!=s&&(n=i.indexOf(s+1),a=i.indexOf(s+2),-1!=n&&-1!=a&&t.push([s,s+1,s+2]));return t},e.checkAllBuhuaComp=function(){for(var i=!0,t=0;t<this.overHuaVec.length;t++)this.overHuaVec[t]>0&&(i=!1);return i},e.getRandomFourValue=function(){var i=[],t=[2,3,4,5,6,7,8,9,10,11,12],e=0,s=0;for(e=0;4>e;e++)s=Math.floor(Math.random()*t.length),i.push(t[s]),t.splice(s,1);return i.sort(function(i,t){return i>t?-1:i==t?0:1}),i},e.getChengbaoNumRefNum=function(i,t){var e=0,s=0;for(s=0;s<this.chiFromVec[i].length;s++)this.chiFromVec[i][s]==t&&(e+=1);for(s=0;s<this.pengFromVec[i].length;s++)this.pengFromVec[i][s]==t&&(e+=1);for(s=0;s<this.mingGangFromVec[i].length;s++)this.mingGangFromVec[i][s]==t&&(e+=1);for(s=0;s<this.anGangFromVec[i].length;s++)this.anGangFromVec[i][s]==t&&(e+=1);return console.log("getChengbaoNumRefNum::"+e+"  pos:"+i+" frompos:"+t),e},e.getPengGangNum=function(i){return this.chiVec[i].length+this.pengVec[i].length+this.anGangVec[i].length+this.mingGangVec[i].length},e.judgeMenqing=function(i){var t=this.chiVec[i].length+this.pengVec[i].length+this.mingGangVec[i].length;return 0==t?!0:!1},e.getUseless=function(){var i=[],t=[],e=[],s=[],n=[],a=[],o=[],h=this.allCardsVec[this.selfChairPos];-1!=this.theFourteenCardVec[this.selfChairPos]&&(h=h.concat(this.theFourteenCardVec[this.selfChairPos])),h.sort(this.compareFunction);var r=0,l=h.length,c=this.getPaiduizi(h),d=this.getPaizuShun(h),u=!1,g=!1;for(r=0;l>r&&!this.judgeHua(h[r]);r++)u=this.checkduizi(h[r],c),g=this.checkshunzi(h[r],d),this.getHuTipArr(h[r]).length>0?this.getHuTipArr(h[r]).length>2?n.push(h[r]):this.getHuTipArr(h[r]).length>1?a.push(h[r]):o.push(h[r]):0==u&&0==g?i.push(h[r]):0==g?t.push(h[r]):0==u?e.push(h[r]):s.push(h[r]);if(n.length>0)return n[0];if(a.length>0)return a[0];if(o.length>0)return o[0];if(s.length>0){for(r=0;r<s.length;r++)if(1==this.checkTwoAndMidShun(s[r],d,h))return console.log("检查中间牌是否应该出，应该出了牌：："+s[r]),s[r]}else{if(i.length>0){var m=this.getGuliPai(i,h);return console.log("机器人检测返回了孤立牌：："+m),m}if(t.length>0)return 1==t.length?0==e.length?(console.log("机器人检测返回了对子：："+t[0]),t[0]):(console.log("机器人检测返回了顺子：："+e[0]),e[0]):(console.log("机器人检测返回了对子：："+t[0]),t[0]);if(e.length>0)return console.log("机器人检测返回了顺子：："+e[0]),e[0];if(s.length>0)return console.log("机器人检测返回了对子顺子：："+e[0]),s[0]}return this.allCardsVec[this.selfChairPos][0]},e.checkTwoAndMidShun=function(i,t,e){return!1},e.checkduizi=function(i,t){for(var e=0;e<t.length;e++)if(t[e]==i)return!0;return!1},e.checkshunzi=function(i,t){for(var e=0;e<t.length;e++)if(t[e][0]==i||t[e][1]==i||t[e][2]==i)return!0;return!1},e.getGuliPai=function(i,t){var e=[];e[0]=0,e[1]=0,e[2]=0,e[3]=0;var s=0,n=0,a=[],o=[],h=[],r=[],l=[],c=[],d=[],u=[],g=[];for(n=t.length,s=0;n>s;s++)e[Q.getTypeByCardIndex(t[s])]+=1;for(n=i.length,s=0;n>s;s++)e[Q.getTypeByCardIndex(i[s])]<2?i[s]<=27?a.push(i[s]):o.push(i[s]):e[Q.getTypeByCardIndex(i[s])]<3?i[s]<=27?h.push(i[s]):r.push(i[s]):i[s]<=27?l.push(i[s]):c.push(i[s]);if(a.length>0)return a[0];if(o.length>0)return o[0];if(h.length>0)return h[0];if(r.length>0){for(d=[],u=[],g=[],n=r.length,s=0;n>s;s++)-1!=t.indexOf(r[s]-1)&&Q.getTypeByCardIndex(r[s]-1)==Q.getTypeByCardIndex(r[s])?g.push(r[s]):-1!=t.indexOf(r[s]+1)&&Q.getTypeByCardIndex(r[s]+1)==Q.getTypeByCardIndex(r[s])?g.push(r[s]):-1!=t.indexOf(r[s]-2)&&Q.getTypeByCardIndex(r[s]-2)==Q.getTypeByCardIndex(r[s])?u.push(r[s]):-1!=t.indexOf(r[s]+2)&&Q.getTypeByCardIndex(r[s]+2)==Q.getTypeByCardIndex(r[s])?u.push(r[s]):d.push(r[s]);return d.length>0?d[0]:u.length>0?u[0]:g[0]}if(l.length>0)return l[0];if(c.length>0){for(d=[],u=[],g=[],n=c.length,s=0;n>s;s++)-1!=t.indexOf(c[s]-1)&&Q.getTypeByCardIndex(c[s]-1)==Q.getTypeByCardIndex(c[s])?g.push(c[s]):-1!=t.indexOf(c[s]+1)&&Q.getTypeByCardIndex(c[s]+1)==Q.getTypeByCardIndex(c[s])?g.push(c[s]):-1!=t.indexOf(c[s]-2)&&Q.getTypeByCardIndex(c[s]-2)==Q.getTypeByCardIndex(c[s])?u.push(c[s]):-1!=t.indexOf(c[s]+2)&&Q.getTypeByCardIndex(c[s]+2)==Q.getTypeByCardIndex(c[s])?u.push(c[s]):d.push(c[s]);return d.length>0?d[0]:u.length>0?u[0]:g[0]}return i[0]},e.saveStepData=function(){var i=new Object;i.userData=this.playerInfoVec.concat(),i.outputCardsVec=o(this.chairNum),i.allCardsVec=o(this.chairNum),i.chiVec=o(this.chairNum),i.chiFromVec=o(this.chairNum),i.pengVec=o(this.chairNum),i.pengFromVec=o(this.chairNum),i.mingGangVec=o(this.chairNum),i.mingGangFromVec=o(this.chairNum),i.anGangVec=o(this.chairNum),i.anGangFromVec=o(this.chairNum),i.theFourteenCardVec=o(this.chairNum),i.huaVec=o(this.chairNum);var t=0,e=this.chairNum;for(t=0;e>t;t++)i.allCardsVec[t]=this.allCardsVec[t].concat(),i.theFourteenCardVec[t]=this.theFourteenCardVec[t],i.outputCardsVec[t]=this.outputCardsVec[t].concat(),i.chiVec[t]=this.chiVec[t].concat(),i.chiFromVec[t]=this.chiFromVec[t].concat(),i.pengVec[t]=this.pengVec[t].concat(),i.pengFromVec[t]=this.pengFromVec[t].concat(),i.mingGangVec[t]=this.mingGangVec[t].concat(),i.mingGangFromVec[t]=this.mingGangFromVec[t].concat(),i.anGangVec[t]=this.anGangVec[t].concat(),i.anGangFromVec[t]=this.anGangFromVec[t].concat(),i.huaVec[t]=this.huaVec[t].concat();i.curHandlePos=this.curHandlePos,i.reconnect=1,i.leftDesktopCardsNum=this.leftDesktopCardsNum,i.curOutPutPos=this.curOutPutPos,this.replayAllStepData[this.replayCurStep]=i},e.recoveryByReplayData=function(i){var t=0,e=this.chairNum;for(t=0;e>t;t++)this.allCardsVec[t]=i.allCardsVec[t].concat(),this.theFourteenCardVec[t]=i.theFourteenCardVec[t],this.huaVec[t]=i.huaVec[t].concat(),this.outputCardsVec[t]=i.outputCardsVec[t].concat(),this.chiVec[t]=i.chiVec[t].concat(),this.chiFromVec[t]=i.chiFromVec[t].concat(),this.pengVec[t]=i.pengVec[t].concat(),this.pengFromVec[t]=i.pengFromVec[t].concat(),this.mingGangVec[t]=i.mingGangVec[t].concat(),this.mingGangFromVec[t]=i.mingGangFromVec[t].concat(),this.anGangVec[t]=i.anGangVec[t].concat(),this.anGangFromVec[t]=i.anGangFromVec[t].concat();this.curHandlePos=i.curHandlePos,this.curOutPutPos=i.curOutPutPos,this.leftDesktopCardsNum=i.leftDesktopCardsNum},a(0,e,"gameHasStarted",function(){return this.isGameStart||this.majiangMsgs.ACK_RoomInfo.RoundCount>0?!0:!1}),a(0,e,"chairNum",function(){return this._chairNum},function(i){this._chairNum=i,this.playerInfoVec.length=0,this.huaVec.length=this._chairNum,this.chiVec.length=this._chairNum,this.chiFromVec.length=this._chairNum,this.pengVec.length=this._chairNum,this.pengFromVec.length=this._chairNum,this.mingGangVec.length=this._chairNum,this.mingGangFromVec.length=this._chairNum,this.anGangVec.length=this._chairNum,this.anGangFromVec.length=this._chairNum,this.kouVec.length=this._chairNum,this.outputCardsVec.length=this._chairNum,this.allCardsVec.length=this._chairNum,this.theFourteenCardVec.length=this._chairNum,this.isTingVec.length=this._chairNum,this.TingHuCardVec.length=this._chairNum,this.huaNum.length=this._chairNum,this.TingDownCardVec.length=this._chairNum;var t=0,e=this._chairNum;for(t=0;e>t;t++)this.huaVec[t]=[],this.chiVec[t]=[],this.chiFromVec[t]=[],this.pengVec[t]=[],this.pengFromVec[t]=[],this.mingGangVec[t]=[],this.mingGangFromVec[t]=[],this.outputCardsVec[t]=[],this.anGangVec[t]=[],this.anGangFromVec[t]=[],this.kouVec[t]=[],this.allCardsVec[t]=[],this.theFourteenCardVec[t]=-1,this.isTingVec[t]=!1,this.TingHuCardVec[t]=[],this.TingDownCardVec[t]=[];this.isHu=!1,this.isLiu=!1,this.leftDesktopCardsNum=0,this.isGameStart=!1,this.huArr.length=0}),s(t,["DissolveResult_REF",function(){return this.DissolveResult_REF=["等待操作","同意","拒绝"]},"GangtouCardArr",function(){return this.GangtouCardArr=[[[1,257,513],[65,321,577],[129,385,641],[769],[1537],[1281]],[[17,273,529],[81,337,593],[1025],[785],[1553],[1297]],[[33,289,545],[97,353,609],[1041],[801],[1569],[1329]],[[49,305,561],[113,369,625],[1057],[817],[1584],[1313]]]},"all_Cards",function(){return this.all_Cards=[1,2,3,4,5,6,7,8,9,10,11,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34]}]),t}(h),Tt=function(i){function t(){this._majiangPage=null,this.popChatArr=null,this.expressloaderArr=null,this._playerInfoPage=null,this._tableInfoPage=null,this._calculatePage=null,this._replayControlView=null,this._chatPage=null,this._gui=null,this._voiceRecording=-1,this.isPlayVoice=!1,this.isClick=!1,this.isRecording=!1,t.__super.call(this),this.setType(3)}n(t,"modules.game.majiangGame.view.MajiangGameView",i);var s=t.prototype;return s.onAdd=function(){this.onAddUI(),this.onAddListener()},s.onRemove=function(){this.onRemoveUI(),this.onRemoveListener()},s.onAddUI=function(){null==this._gui&&(this._gui=new p,this._gui.mouseThrough=!0),console.log("桌面被添加到舞台！！"),N.instance.uiLayer.addChild(this._gui),null==this._majiangPage&&(this._majiangPage=new Z(new P),this._gui.mjContainer.addChild(this._majiangPage.skin)),null==this._tableInfoPage&&(this._tableInfoPage=new yt(this._gui.tableInfoPage)),null==this._playerInfoPage&&(this._playerInfoPage=new _t(this._gui.playerInfoPage)),null==this._calculatePage&&(this._calculatePage=new Y(this._gui.calculatePart)),null==this._replayControlView&&(this._replayControlView=new B(this._gui.replayControlView)),this._chatPage=d.hchatPage,this.gui.chatContainer.addChild(this._chatPage.skin),this._chatPage.hide(),1==E.isReplay?this._replayControlView.show():this._replayControlView.hide(),this._gui.leftPopChat.visible=!1,this._gui.rightPopChat.visible=!1,this._gui.bottomPopChat.visible=!1,this._gui.topPopChat.visible=!1,m.instance.on("SEND_CHAT_MESSAGE",this,this.onSendChat),this._gui.tableInfoPage.voiceIntercomBtn.on("click",this,this.onVoiceOpClick),this._gui.tableInfoPage.voiceIntercomBtn.on("mouseout",this,this.onVoiceOpOut),this._gui.tableInfoPage.chatBtn.on("click",this,this.onShowChatPage)},s.initPopChat=function(i){switch(void 0===i&&(i=3),this.popChatArr=[],i){case 2:this.popChatArr.push(this._gui.bottomPopChat,this._gui.topPopChat);break;case 3:this.popChatArr.push(this._gui.bottomPopChat,this._gui.rightPopChat,this._gui.leftPopChat);break;case 4:this.popChatArr.push(this._gui.bottomPopChat,this._gui.rightPopChat,this._gui.topPopChat,this._gui.leftPopChat)}},s.onSendChat=function(i){this.chatPage.switchState();var t={message:i,type:2};m.instance.event("SOCKET_SEND",T.getProtoMessage(370,t))},s.onVoiceOpClick=function(i){this.isClick=!0,console.log("点击了？？？？？？ "),this.isRecording?this.stopRecord():this.startRecord(),i.stopPropagation()},s.onVoiceOpOut=function(){return this.isClick?(this.isClick=!1,void 0):(console.log("滑动了？？？？？？ "),1==this.isRecording&&(H.stopRecord(-1),e.timer.clear(this,this.onRecording),this._gui.tableInfoPage.voiceTip.visible=!1,this._gui.tableInfoPage.voicePlay.visible=!1,this.tableInfoPage.stopVoicePlay(),this.onStopSuccess(),this.isRecording=!1,this.isPlayVoice||this.Voice()),void 0)},s.startRecord=function(){H.startRecord(),this._gui.tableInfoPage.voicePlay.visible=!0,this.tableInfoPage.playVoicePlay(),this._gui.tableInfoPage.voiceTip.visible=!0,this._voiceRecording=R.unixtime,this._gui.tableInfoPage._time.text="15'",e.timer.loop(100,this,this.onRecording),this.isRecording=!0},s.stopRecord=function(){var i=R.unixtime-this._voiceRecording;500>i||(1e3>i?(H.stopRecord(-1),x.VoiceTip(3),e.timer.clear(this,this.onRecording),this._gui.tableInfoPage.voiceTip.visible=!1,this._gui.tableInfoPage.voicePlay.visible=!1,this.tableInfoPage.stopVoicePlay(),this.onStopSuccess()):(H.stopRecord(0,this,this.onStopSuccess),e.timer.clear(this,this.onRecording),this._gui.tableInfoPage.voiceTip.visible=!1,this._gui.tableInfoPage.voicePlay.visible=!1,this.tableInfoPage.stopVoicePlay(),wt.instance.gameContext.view.gui.tableInfoPage.voiceIntercomBtn.disabled=!0,wt.instance.gameContext.view.gui.tableInfoPage.voiceDis.visible=!0),this.isRecording=!1,this.isPlayVoice||this.Voice())},s.onStopSuccess=function(){wt.instance.gameContext.view.gui.tableInfoPage.voiceIntercomBtn.disabled=!1,wt.instance.gameContext.view.gui.tableInfoPage.voiceDis.visible=!1},s.onRecording=function(){var i=(R.unixtime-this._voiceRecording)/1e3;this._gui.tableInfoPage._time.text=15-Math.floor(i)+"'",i>=l.maxVoiceTime&&this.stopRecord()},s.onRecChat=function(i){var t=i.message.split("#");t.length>1&&this.showPopChat(t[0],t[1])},s.showPopChat=function(i,t){null==this.popChatArr&&this.initPopChat(this.model.chairNum);var e=this.model.getPlayerPosByUid(i),s=this.model.getChairDirByPos(e),n=t.split("|");if(n.length>1){if("express"==n[0]){var a=parseInt(n[1]);return this._playerInfoPage.showExpress(s,a+1),void 0}"VoiceId"==n[0]&&(console.log("youyuyinguolaile"),H.voiceArr.push([parseInt(i),n[1]]),this.isPlayVoice||0!=this.isRecording||this.Voice())}else{this.popChatArr[s].visible=!0,this.popChatArr[s].tf.text=t,this.popChatArr[s].backimg.width=this.popChatArr[s].tf.textField.textWidth+30,this.popChatArr[s].backimg.height=this.popChatArr[s].tf.textField.textHeight+40,M.clearAll(this.popChatArr[s]),this.popChatArr[s].alpha=1;var o=2e3*this.popChatArr[s].tf.textField.lines.length;S.playSound(G.instance.getliaotianPath(this.model.playerByPos(e).sex,l.getChatSound(t)),1)}this.popChatArr[s]==this._gui.rightPopChat&&(this.popChatArr[s].x=522+(392-this.popChatArr[s].tf.textField.textWidth)),M.to(this.popChatArr[s],{alpha:.3},o,null,new v(this,this.onCompeteTween,[this.popChatArr[s]]),500)},s.Voice=function(){var i=this;if(!(H.voiceArr.length<=0||H.isUpLoading)){this.isPlayVoice=!0;var t=H.voiceArr.shift();H.downloadVoice(t[1],this,this.playVoice,[t[0]]),c.window.wx.onVoicePlayEnd({success:function(){console.log("声音播放完成了！！ uid：："+t[0]),console.log("WX.voiceArr.length::"+H.voiceArr.length),e.timer.clear(wt.instance.gameContext.view,i.recoverSoundVolume),wt.instance.gameContext.view.playerInfoPage.hideVoice(t[0]),l.isPlayingRecord=!1,e.timer.once(1e3,null,G.swithMusic,["game"]),H.voiceArr.length>0?i.Voice():(H.isDownLoading=!1,H.uploadArr.length>0&&(H.uploadVoice(H.uploadArr[0]),H.uploadArr.length=0),wt.instance.gameContext.view.isPlayVoice=!1,0==H.isUpLoading&&(wt.instance.gameContext.view.gui.tableInfoPage.voiceIntercomBtn.disabled=!1,wt.instance.gameContext.view.gui.tableInfoPage.voiceDis.visible=!1))}})}},s.playVoice=function(i){e.timer.once(15e3,this,this.recoverSoundVolume,[parseInt(i)]),this._playerInfoPage.showVoice(parseInt(i))},s.recoverSoundVolume=function(i){0!=this.isPlayVoice&&(this.isPlayVoice=!1,l.isPlayingRecord=!1,G.swithMusic("game"),this._playerInfoPage.hideVoice(i),this._gui.tableInfoPage.voiceIntercomBtn.disabled=!1,this._gui.tableInfoPage.voiceDis.visible=!1)},s.playend=function(i){this._playerInfoPage.hideVoice(i)},s.onCompeteTween=function(i){i.alpha=1,i.visible=!1},s.onShowChatPage=function(i){this.chatPage.switchState(),i.stopPropagation()},s.setChairNmu=function(i){this._majiangPage.setChairNum(i),this._playerInfoPage.setChairNum(i),this.reset()},s.startGame=function(){},s.onAddListener=function(){},s.onticketCardChange=function(i){this.calculatePage.showGetTicket(i[0]),i&&i.complete()},s.onRemoveUI=function(){null!=this._gui&&(N.instance.uiLayer.removeChild(this._gui),console.log("桌面被移除舞台！！"),this._gui.tableInfoPage.chatBtn.off("mousedown",this,this.onShowChatPage),m.instance.off("SEND_CHAT_MESSAGE",this,this.onSendChat),this._gui.tableInfoPage.voiceIntercomBtn.off("click",this,this.onVoiceOpClick),this._gui.tableInfoPage.voiceIntercomBtn.off("mouseout",this,this.onVoiceOpOut))},s.reset=function(){kt.instance.hide(),this._majiangPage.reset(),this._tableInfoPage.reset(),this._playerInfoPage.havePiaoReset(),this._calculatePage.reset(),this._replayControlView.reset()},s.replayup_reset=function(){this._majiangPage.reset(),this._tableInfoPage.reset(),this._playerInfoPage.havePiaoReset(),this._calculatePage.reset(),this._replayControlView.replayup_reset()},s.onRemoveListener=function(){},a(0,s,"model",function(){return wt.instance.gameContext.model}),a(0,s,"replayControlView",function(){return this._replayControlView}),a(0,s,"majiangPage",function(){return this._majiangPage}),a(0,s,"playerInfoPage",function(){return this._playerInfoPage}),a(0,s,"gui",function(){return this._gui}),a(0,s,"chatPage",function(){return this._chatPage}),a(0,s,"tableInfoPage",function(){return this._tableInfoPage}),a(0,s,"calculatePage",function(){return this._calculatePage}),t}(h),xt=function(i){function t(i,e,s){this.dragRegion=null,this.readyOffsetY=-20,this.skinPreX=0,this.needAlpha=!0,this.needSkinY0=!0,this._isNextOutputTingCard=!1,this._isNextOutputKouCard=!1,void 0===e&&(e=!0),void 0===s&&(s=!0),t.__super.call(this,i),this._skin=i,this._skin.dark=!1,this.skinPreX=this._skin.x,this.needSkinY0=s,s&&(this._skin.y=0),this.needAlpha=e,this.init()}n(t,"modules.game.majiangGame.view.card.handCard.BottomHandleCard",i);var s=t.prototype;return s.onClickStage=function(i){console.log("click card e.target"+i.target+(i.target==this._skin)),i.target!=this._skin&&this._skin.y==this.readyOffsetY&&(this._skin.y=0,i.target instanceof ui.mainGame.Items.BottomHandleItemUI||0!=this.model.isTingVec[this.model.selfChairPos]||wt.instance.gameContext.view.majiangPage.hupaiTipPart.cancelShowHuTip(this.model.selfChairPos),0==this.model.isNextGang&&wt.instance.gameContext.controller.hidePreDiscardEff())},s.init=function(){},s.onStopDrag=function(){wt.instance.gameContext.controller.hidePreDiscardEff(),this.model.isDragingcard=!1;var i=this._skin;this.model.selfOutputCardPos=x.localToGlobal(i,new V(i.x,i.y)),this._skin.stopDrag(),this._skin.x=this.skinPreX,this._skin.y<=this.readyOffsetY?(this._skin.y=0,this.disCard(),0==this.model.isTingVec[this.model.selfChairPos]&&wt.instance.gameContext.view.majiangPage.hupaiTipPart.cancelShowHuTip(this.model.selfChairPos)):(this._skin.y>0?(this._skin.y=0,0==this.model.isTingVec[this.model.selfChairPos]&&wt.instance.gameContext.view.majiangPage.hupaiTipPart.cancelShowHuTip(this.model.selfChairPos)):(this._skin.y=1,M.to(this._skin,{y:this.readyOffsetY},40),G.playEffect("audio_card_click"),0==this.model.isTingVec[this.model.selfChairPos]&&(this.isShowTingImg||wt.instance.gameContext.view.majiangPage.hupaiTipPart.cancelShowHuTip(this.model.selfChairPos)),0==this.model.isNextGang&&e.timer.frameOnce(1,this,this.showPreEff)),(this._isNextOutputKouCard||this.model.isNextGang)&&(this.disCard(),this._skin.y=0),this._isNextOutputTingCard),this.view.gui.main.off("mouseup",this,this.onStopDrag),this.view.gui.main.off("mouseout",this,this.onStopDrag),e.timer.clear(this,this.onDragMove)},s.showPreEff=function(){wt.instance.gameContext.controller.showPreDiscardEff(this.cardIdx)},s.disCard=function(){console.log("chupaile ::"+Q.CARD_REFERENCE[this.cardIdx]);var i=0,t=0;if(this.model.isNextGang){var e=0;for(t=this.model.tempGangCards.length,i=0;t>i;i++)if(this.model.tempGangCards[i].card==this.cardIdx){e=this.model.tempGangCards[i].type;break}var s={SID:E.SID,CID:this.cardIdx-1};return wt.instance.gameContext.controller.sendMsgCommond(T.getProtoMessage(310,s)),this.model.isNextGang=!1,void 0}if(this._isNextOutputTingCard){var n={cmd:"TING"+this.cardIdx};t=this.model.tempKouCards.length;var a="";for(i=0;t>i;i++)""==a?a=" "+this.model.tempKouCards[i]:a+=","+this.model.tempKouCards[i];""==a?a=" -1|":a+="|";var o=this.model.getTingDownCards(this.cardIdx,this.model.tempKouCards),h=o.canDownCards,r="";for(i=0;i<h.length;i++)""==r?r=h[i]:r+=","+h[i];n.cmd+=a+r,n.cmd+=1==o.isHaveJiang?"="+o.jiangpai:"=-1",wt.instance.gameContext.controller.sendMsgCommond(n),wt.instance.gameContext.view.majiangPage.handleBtns.hide(),wt.instance.gameContext.model.isTingVec[wt.instance.gameContext.model.selfChairPos]=!0,this._isNextOutputTingCard=!1,this.model.isNextCancelBtnKou=!1,this.model.isCancelTingp=!1}else if(this._isNextOutputKouCard){this.model.tempKouCards.push(this.cardIdx),this.view.majiangPage.handPart.showTempKouCards(this.cardIdx),this.view.majiangPage.handleBtns.showKouBtnEnable(),this._isNextOutputKouCard=!1;var l={cmd:"KOUP"+(this.cardIdx+1)};wt.instance.gameContext.controller.sendMsgCommond(l)}else wt.instance.gameContext.controller.discard(this.cardIdx),wt.instance.gameContext.controller.hidePreDiscardEff()},s.onDragMove=function(){(e.stage.mouseX>=e.stage.width||e.stage.mouseY>=e.stage.height||e.stage.mouseX<=0||e.stage.mouseY<=0)&&this.onStopDrag()},s.onStartDrag=function(){this.model.isDragingcard=!0,this._skin.parent.addChild(this._skin),this._skin.startDrag(null,!0,100),e.timer.loop(50,this,this.onDragMove),this.view.gui.main.on("mouseup",this,this.onStopDrag),this.view.gui.main.on("mouseout",this,this.onStopDrag)},s.up=function(){0!=this.state&&(this._skin.valueImg.y=34,this._skin.frontImg.visible=!0,this._skin.valueImg.visible=!0,this._skin.backImg.visible=!1,this._skin.downImg.visible=!1,i.prototype.up.call(this))},s.down=function(){1!=this.state&&(this._skin.y=0,this._skin.valueImg.y=2,this._skin.frontImg.visible=!1,this._skin.valueImg.visible=!0,this._skin.backImg.visible=!1,this._skin.downImg.visible=!0,i.prototype.down.call(this))},s.back=function(){2!=this.state&&(this._skin.frontImg.visible=!1,this._skin.valueImg.visible=!1,this._skin.backImg.visible=!0,this._skin.downImg.visible=!1,i.prototype.back.call(this))},s.show=function(){this._skin.visible=!0},s.hide=function(){this._skin.visible=!1},s.showTingState=function(i){i?(this.canControl=!0,this._isNextOutputTingCard=!0):this.canControl=!1},s.cancleTingState=function(){this.canControl=!0,this._isNextOutputTingCard=!1},s.showKouState=function(i){i?(this.canControl=!0,this._isNextOutputKouCard=!0):this.canControl=!1},s.removeTingEff=function(){this._isNextOutputTingCard=!1},s.setCardImg=function(t){this.showBaidaSimbol=!0,console.log("bottom cardIdx ::"+t),Q.CARD_REFERENCE.hasOwnProperty(t.toString())&&(this._skin.valueImg.skin="gametable/mahjongpai/"+Q.CARD_REFERENCE[t.toString()]),i.prototype.setCardImg.call(this,t)},a(0,s,"canControl",null,function(i){this.model.isSelfSitDown||(i=!1),i?(e.stage.on("click",this,this.onClickStage),this._skin.on("mousedown",this,this.onStartDrag)):(e.stage.off("click",this,this.onClickStage),this._skin.off("mousedown",this,this.onStartDrag),this.needAlpha&&(x.addDark(this._skin,!1),this._skin.dark=!1),this.needSkinY0&&(this._skin.y=0),this._isNextOutputKouCard=!1,this._isNextOutputTingCard=!1)}),a(0,s,"canControlWitchDark",null,function(i){i?(x.addDark(this._skin,!1),0==this._skin.dark):(this._skin.off("mousedown",this,this.onStartDrag),this._skin.off("mousedown",this,this.onStartDrag),x.addDark(this._skin,!0),this._skin.dark=!0)}),a(0,s,"view",function(){return wt.instance.gameContext.view}),a(0,s,"model",function(){return wt.instance.gameContext.model}),a(0,s,"visible",function(){return this._skin.visible}),t}(Q),Bt=function(i){function t(i){this.tingpaiImg=null,this.mingEffAni=null,t.__super.call(this,i),this._skin=i,this.tingpaiImg=this._skin.LiangEff}n(t,"modules.game.majiangGame.view.card.handCard.LeftHandleCard",i);var e=t.prototype;return e.up=function(){0!=this.state&&(this._skin.frontImg.visible=!0,this._skin.valueImg.visible=!1,this._skin.backImg.visible=!1,this._skin.downImg.visible=!1,i.prototype.up.call(this))},e.down=function(){1!=this.state&&(this._skin.frontImg.visible=!1,this._skin.valueImg.visible=!0,this._skin.backImg.visible=!1,this._skin.downImg.visible=!0,i.prototype.down.call(this))},e.back=function(){2!=this.state&&(this._skin.frontImg.visible=!1,this._skin.valueImg.visible=!1,this._skin.backImg.visible=!0,this._skin.downImg.visible=!1,i.prototype.back.call(this))},e.show=function(){this._skin.visible=!0},e.hide=function(){this._skin.visible=!1},e.setCardImg=function(t){console.log("left ::cardIdx"+t),this.cardIdx!=t&&(console.log("left cardIdx ::"+t),Q.CARD_REFERENCE.hasOwnProperty(t.toString())&&(this._skin.valueImg.skin="gametable/mahjongpai/"+Q.CARD_REFERENCE[t.toString()]),i.prototype.setCardImg.call(this,t))},e.reset=function(){i.prototype.reset.call(this),this.tingpaiImg.visible=!1},e.showTingEff=function(){this.tingpaiImg.visible=!0},t}(Q),St=function(i){function t(i){this.tingpaiImg=null,this.mingEffAni=null,t.__super.call(this,i),this._skin=i,this.tingpaiImg=this._skin.LiangEff}n(t,"modules.game.majiangGame.view.card.handCard.RightHandleCard",i);var e=t.prototype;return e.up=function(){0!=this.state&&(this._skin.frontImg.visible=!0,this._skin.valueImg.visible=!1,this._skin.backImg.visible=!1,this._skin.downImg.visible=!1,i.prototype.up.call(this))
},e.down=function(){1!=this.state&&(this._skin.frontImg.visible=!1,this._skin.valueImg.visible=!0,this._skin.backImg.visible=!1,this._skin.downImg.visible=!0,i.prototype.down.call(this))},e.back=function(){2!=this.state&&(this._skin.frontImg.visible=!1,this._skin.valueImg.visible=!1,this._skin.backImg.visible=!0,this._skin.downImg.visible=!1,i.prototype.back.call(this))},e.show=function(){this._skin.visible=!0},e.hide=function(){this._skin.visible=!1},e.setCardImg=function(t){console.log("right ::cardIdx"+t),this.cardIdx!=t&&(console.log("right ::cardIdx"+t),Q.CARD_REFERENCE.hasOwnProperty(t.toString())&&(this._skin.valueImg.skin="gametable/mahjongpai/"+Q.CARD_REFERENCE[t.toString()]),i.prototype.setCardImg.call(this,t))},e.reset=function(){i.prototype.reset.call(this),this.tingpaiImg.visible=!1},e.showTingEff=function(){this.tingpaiImg.visible=!0},t}(Q),Gt=function(i){function t(i){t.__super.call(this,i),this._skin=i}n(t,"modules.game.majiangGame.view.card.handCard.TopHandleCard",i);var e=t.prototype;return e.up=function(){0!=this.state&&(this._skin.frontImg.visible=!0,this._skin.valueImg.visible=!1,this._skin.backImg.visible=!1,this._skin.downImg.visible=!1,i.prototype.up.call(this))},e.down=function(){1!=this.state&&(this._skin.frontImg.visible=!1,this._skin.valueImg.visible=!0,this._skin.backImg.visible=!1,this._skin.downImg.visible=!0,i.prototype.down.call(this))},e.back=function(){2!=this.state&&(this._skin.frontImg.visible=!1,this._skin.valueImg.visible=!1,this._skin.backImg.visible=!0,this._skin.downImg.visible=!1,i.prototype.back.call(this))},e.show=function(){this._skin.visible=!0},e.hide=function(){this._skin.visible=!1},e.setCardImg=function(t){console.log("top ::cardIdx"+t),this.cardIdx!=t&&(console.log("top ::cardIdx"+t),Q.CARD_REFERENCE.hasOwnProperty(t.toString())&&(this._skin.valueImg.skin="gametable/mahjongpai/"+Q.CARD_REFERENCE[t.toString()]),i.prototype.setCardImg.call(this,t))},t}(Q),jt=function(i){function t(i){this.nowNum=1,this.path="gametable/mahjongpai/",this.HUA_IMAGE={32:"zzhong.png",33:"zfa.png",34:"zbai.png",28:"zdong.png",29:"hjdong.png",30:"zxi.png",31:"zbei.png",35:"hchun.png",36:"hxia.png",37:"hqiu.png",38:"hjdong.png",39:"hmei.png",40:"hlan.png",41:"hzhu.png",42:"hju.png"},t.__super.call(this,i)}n(t,"modules.game.majiangGame.view.card.hupartCard.HuaItemCard",i);var e=t.prototype;return e.down=function(){1!=this.state&&(this._skin.downImg.visible=!0,this._skin.valueImg.visible=!0,i.prototype.down.call(this))},e.back=function(){2!=this.state&&(this._skin.downImg.visible=!1,this._skin.valueImg.visible=!1,i.prototype.back.call(this))},e.show=function(){this._skin.downImg.visible=!0,this._skin.valueImg.visible=!0,this._skin.visible=!0},e.hide=function(){this._skin.downImg.visible=!1,this._skin.valueImg.visible=!1,this._skin.visible=!1,this.nowNum=0,this.cardIdx=0},e.setCardImg=function(t){this.cardIdx!=t&&(this._skin.valueImg.skin=this.path+this.HUA_IMAGE[t.toString()],i.prototype.setCardImg.call(this,t))},e.setNum=function(){4!=this.nowNum&&this.nowNum++},e.getNumUrl=function(i){var t="";switch(i){case 1:t="hua1.png";break;case 2:t="hua2.png";break;case 3:t="hua3.png";break;case 4:t="hua4.png"}return t},t}(Q),Dt=function(i){function t(i){this.isTingState=!1,this.timeLine=new A,t.__super.call(this,i);var e=this._skin.curIdxSimbol.y;this.timeLine.to(this._skin.curIdxSimbol,{y:e-40},500,g.quadOut).to(this._skin.curIdxSimbol,{y:e},500,g.quadIn),this.timeLine.play(0,!0),this.timeLine.pause()}n(t,"modules.game.majiangGame.view.card.outputCard.BaseOutputCard",i);var e=t.prototype;return e.showCurOutputSimbol=function(i){this._skin.curIdxSimbol.visible=i,1==i?this.timeLine.resume():this.timeLine.pause()},e.makeTingState=function(i){x.addDark(this._skin,i),this.isTingState=i},t}(Q),At=function(i){function t(i){this._skin=null,t.__super.call(this),this._skin=i,this.init()}n(t,"modules.game.majiangGame.view.card.pengGangCard.BottomPengGangCards",i);var e=t.prototype;return e.init=function(){var i=0,t=this._cardsVec.length;for(i=0;t>i;i++)this._cardsVec[i]=new te(this._skin["card"+i])},e.show=function(){this._skin.visible=!0,i.prototype.show.call(this)},e.hide=function(){this._skin.visible=!1,i.prototype.hide.call(this)},a(0,e,"visible",function(){return this._skin.visible}),t}(X),Rt=function(i){function t(i){this._skin=null,t.__super.call(this),this._skin=i,this.init()}n(t,"modules.game.majiangGame.view.card.pengGangCard.LeftPengGangCards",i);var e=t.prototype;return e.init=function(){var i=0,t=this._cardsVec.length;for(i=0;t>i;i++)this._cardsVec[i]=new ee(this._skin["card"+i])},e.show=function(){this._skin.visible=!0,i.prototype.show.call(this)},e.hide=function(){this._skin.visible=!1,i.prototype.hide.call(this)},a(0,e,"visible",function(){return this._skin.visible}),t}(X),Mt=function(i){function t(i){this._skin=null,t.__super.call(this),this._skin=i,this.init()}n(t,"modules.game.majiangGame.view.card.pengGangCard.RightPengGangCards",i);var e=t.prototype;return e.init=function(){var i=0,t=this._cardsVec.length;for(i=0;t>i;i++)this._cardsVec[i]=new se(this._skin["card"+i])},e.show=function(){this._skin.visible=!0,i.prototype.show.call(this)},e.hide=function(){this._skin.visible=!1,i.prototype.hide.call(this)},a(0,e,"visible",function(){return this._skin.visible}),t}(X),Nt=function(i){function t(i){this._skin=null,t.__super.call(this),this._skin=i,this.init()}n(t,"modules.game.majiangGame.view.card.pengGangCard.TopPengGangCards",i);var e=t.prototype;return e.init=function(){var i=0,t=this._cardsVec.length;for(i=0;t>i;i++)this._cardsVec[i]=new ne(this._skin["card"+i])},e.show=function(){this._skin.visible=!0,i.prototype.show.call(this)},e.hide=function(){this._skin.visible=!1,i.prototype.hide.call(this)},a(0,e,"visible",function(){return this._skin.visible}),t}(X),Et=function(i){function t(i){t.__super.call(this,i),this.init()}n(t,"modules.game.majiangGame.view.majiangPart.hupaiTip.BottomHupaiTipPart",i);var e=t.prototype;return e.init=function(){for(var i=0;9>i;i++)this.allCards[i]=new te(this._skin["card"+i])},e.setBackSize=function(i){this._skin.backimg.width=625-(9-i)*this.SingleCardW,this._skin.liangImg.x=this._skin.backimg.width+this._skin.backimg.x},e.reset=function(){this._skin.visible=!1},t}(ot),Ot=function(i){function t(i){t.__super.call(this,i),this.init()}n(t,"modules.game.majiangGame.view.majiangPart.hupaiTip.LeftHupaiTipPart",i);var e=t.prototype;return e.init=function(){for(var i=0;9>i;i++)this.allCards[i]=new ee(this._skin["card"+i])},e.setBackSize=function(i){this._skin.backimg.height=411-(9-i)*(this.SingleCardH-11),this._skin.liangImg.y=this._skin.backimg.y+this._skin.backimg.height},t}(ot),Ht=function(i){function t(i){t.__super.call(this,i),this.init()}n(t,"modules.game.majiangGame.view.majiangPart.hupaiTip.RightHupaiTipPart",i);var e=t.prototype;return e.init=function(){for(var i=0;9>i;i++)this.allCards[i]=new se(this._skin["card"+i])},e.setBackSize=function(i){this._skin.backimg.height=411-(9-i)*(this.SingleCardH-11),this._skin.liangImg.y=this._skin.backimg.y+this._skin.backimg.height},t}(ot),Ft=function(i){function t(i,e){this._skin=null,this.needAlpha=!0,void 0===e&&(e=!0),t.__super.call(this,i),this._skin=i,this.tingImg=i.tingImg,this._OrignalX=this._skin.x,this.needAlpha=e,this.init()}n(t,"modules.game.majiangGame.view.majiangPart.singlePart.handlePart.BottomSingleHandlePart",i);var e=t.prototype;return e.init=function(){this._SingleCardW=this._skin.card0.width*this._skin.scaleX;var i=0,t=this._preThirteenCards.length;for(i=0;t>i;i++)this._preThirteenCards[i]=new xt(this._skin["card"+i],this.needAlpha);this._theFourteenCard=new xt(this._skin.card13,this.needAlpha),this.canControl=!1},e.judegCanTingOut=function(i){return-1!=this.model.TingHuCardVec[this.model.getChairPosByDir(1)].indexOf(i)||-1!=this.model.TingHuCardVec[this.model.getChairPosByDir(2)].indexOf(i)?!0:!1},e.canControlWitchDark=function(i){var t=!0,e=0,s=this._preThirteenCards.length,n=0;for(e=0;s>e;e++)n=this._preThirteenCards[e].cardIdx,-1!=i.indexOf(n)&&(this._preThirteenCards[e].canControlWitchDark=!1);1==t&&(n=this._theFourteenCard.cardIdx,-1!=i.indexOf(n)&&(this._theFourteenCard.canControlWitchDark=!1))},e.show=function(){this._skin.visible=!0},e.hide=function(){this._skin.visible=!1},e.movePeng=function(i){this._skin.x=i?this._OrignalX+this._SingleCardW:this._OrignalX},e.setTingImgXAndW=function(i){this.tingImg.x=(13-i)*(this._SingleCardW+1),this.tingImg.width=1014-this.tingImg.x},e.judgeEveryCanTing=function(){if(i.prototype.judgeEveryCanTing.call(this),!this.model.isHu){console.log("judgeEveryCanTing");var t,e=0,s=this._preThirteenCards.length,n=-1;for(e=0;s>e;e++)1==this._preThirteenCards[e].visible&&(1==this.model.isTingVec[this.model.getChairPosByDir(0)]?this._preThirteenCards[e].showCanTingImg(!1):(n=this._preThirteenCards[e].cardIdx,t=this.model.getHuTipArr(n),t.length>0?this._preThirteenCards[e].showCanTingImg(!0):this._preThirteenCards[e].showCanTingImg(!1)));1==this.model.isTingVec[this.model.getChairPosByDir(0)]?this._theFourteenCard.showCanTingImg(!1):1==this._theFourteenCard.visible&&(n=this._theFourteenCard.cardIdx,t=this.model.getHuTipArr(n),t.length>0?this._theFourteenCard.showCanTingImg(!0):this._theFourteenCard.showCanTingImg(!1))}},a(0,e,"canControl",null,function(i){var t=0,e=this._preThirteenCards.length,s=0,n=!0;for(t=0;e>t;t++)this.model&&1==this.model.isTingVec[this.model.selfChairPos]?this._preThirteenCards[t].canControl=!1:1==i?(s=this._preThirteenCards[t].cardIdx,-1!=this.model.TingHuCardVec[this.model.getChairPosByDir(1)].indexOf(s)||-1!=this.model.TingHuCardVec[this.model.getChairPosByDir(2)].indexOf(s)?this._preThirteenCards[t].canControl=!1:(this._preThirteenCards[t].canControl=!0,this._preThirteenCards[t].visible&&(n=!1))):this._preThirteenCards[t].canControl=i;if(1==i?(s=this._theFourteenCard.cardIdx,-1!=this.model.TingHuCardVec[this.model.getChairPosByDir(1)].indexOf(s)||-1!=this.model.TingHuCardVec[this.model.getChairPosByDir(2)].indexOf(s)?this._theFourteenCard.canControl=!1:(this._theFourteenCard.canControl=!0,this._theFourteenCard.visible&&(n=!1))):this._theFourteenCard.canControl=i,1==n&&1==i){for(t=0;e>t;t++)this._preThirteenCards[t].canControl=this.model&&1==this.model.isTingVec[this.model.selfChairPos]?!1:i;this._theFourteenCard.canControl=i}}),a(0,e,"visible",function(){return this._skin.visible}),t}(mt),Kt=function(i){function t(i){this._skin=null,t.__super.call(this,i),this._skin=i,this._OrignalY=this._skin.y,this.init()}n(t,"modules.game.majiangGame.view.majiangPart.singlePart.handlePart.LeftSingleHandlePart",i);var e=t.prototype;return e.init=function(){this._SingleCardH=this._skin.card0.height*this._skin.scaleX;var i=0,t=this._preThirteenCards.length;for(i=0;t>i;i++)this._preThirteenCards[i]=new Bt(this._skin["card"+i]);this._theFourteenCard=new Bt(this._skin.card13),this.tingImg=this._skin.tingImg,this.up()},e.show=function(){this._skin.visible=!0},e.hide=function(){this._skin.visible=!1},e.movePeng=function(i){this._skin.y=i?E.isReplay?this._OrignalY+this._SingleCardH/2:this._OrignalY+this._SingleCardH:this._OrignalY},e.showTinged=function(){if(this.needTingEff){var i=0,t=this._preThirteenCards.length;for(i=0;t>i;i++)this._preThirteenCards[i].showTingEff()}},a(0,e,"visible",function(){return this._skin.visible}),t}(mt),Lt=function(i){function t(i){this._skin=null,t.__super.call(this,i),this._skin=i,this._OrignalY=this._skin.y,this.init()}n(t,"modules.game.majiangGame.view.majiangPart.singlePart.handlePart.RightSingleHandlePart",i);var e=t.prototype;return e.init=function(){this._SingleCardH=this._skin.card0.height*this._skin.scaleX;var i=0,t=this._preThirteenCards.length;for(i=0;t>i;i++)this._preThirteenCards[i]=new St(this._skin["card"+i]);this._theFourteenCard=new St(this._skin.card13),this.tingImg=this._skin.tingImg,this.down()},e.show=function(){this._skin.visible=!0},e.hide=function(){this._skin.visible=!1},e.movePeng=function(i){this._skin.y=i?E.isReplay?this._OrignalY-this._SingleCardH/2:this._OrignalY-this._SingleCardH:this._OrignalY},e.showTinged=function(){if(this.needTingEff){var i=0,t=this._preThirteenCards.length;for(i=0;t>i;i++)this._preThirteenCards[i].showTingEff()}},a(0,e,"visible",function(){return this._skin.visible}),t}(mt),Ut=function(i){function t(i){this._skin=null,t.__super.call(this,i),this._skin=i,this._OrignalX=this._skin.x,this.init()}n(t,"modules.game.majiangGame.view.majiangPart.singlePart.handlePart.TopSingleHandlePart",i);var e=t.prototype;return e.init=function(){this._SingleCardW=this._skin.card0.width*this._skin.scaleX;var i=0,t=this._preThirteenCards.length;for(i=0;t>i;i++)this._preThirteenCards[i]=new Gt(this._skin["card"+i]);this._theFourteenCard=new Gt(this._skin.card13),this.tingImg=this._skin.tingImg,this.back()},e.show=function(){this._skin.visible=!0},e.hide=function(){this._skin.visible=!1},e.movePeng=function(i){this._skin.x=i?this._OrignalX-this._SingleCardW:this._OrignalX},a(0,e,"visible",function(){return this._skin.visible}),t}(mt),zt=function(i){function t(i){this._skin=null,t.__super.call(this),this._skin=i,this.init()}n(t,"modules.game.majiangGame.view.majiangPart.singlePart.outputPart.BottomSingleOutputPart",i);var e=t.prototype;return e.init=function(){var i=0,t=this._cardsVec.length;for(i=0;t>i;i++)this._cardsVec[i]=new te(this._skin["card"+i])},e.show=function(){this._skin.visible=!0},e.hide=function(){this._skin.visible=!1},t}(ft),Wt=function(i){function t(i){this._skin=null,t.__super.call(this),this._skin=i,this.init()}n(t,"modules.game.majiangGame.view.majiangPart.singlePart.outputPart.LeftSingleOutputPart",i);var e=t.prototype;return e.init=function(){var i=0,t=this._cardsVec.length;for(i=0;t>i;i++)this._cardsVec[i]=new ee(this._skin["card"+i])},e.show=function(){this._skin.visible=!0},e.hide=function(){this._skin.visible=!1},t}(ft),Yt=function(i){function t(i){this._skin=null,t.__super.call(this),this._skin=i,this.init()}n(t,"modules.game.majiangGame.view.majiangPart.singlePart.outputPart.RightSingleOutputPart",i);var e=t.prototype;return e.init=function(){var i=0,t=this._cardsVec.length;for(i=0;t>i;i++)this._cardsVec[i]=new se(this._skin["card"+i])},e.show=function(){this._skin.visible=!0},e.hide=function(){this._skin.visible=!1},t}(ft),Qt=function(i){function t(i){this._skin=null,t.__super.call(this),this._skin=i,this.init()}n(t,"modules.game.majiangGame.view.majiangPart.singlePart.outputPart.TopSingleOutputPart",i);var e=t.prototype;return e.init=function(){var i=0,t=this._cardsVec.length;for(i=0;t>i;i++)this._cardsVec[i]=new ne(this._skin["card"+i])},e.show=function(){this._skin.visible=!0},e.hide=function(){this._skin.visible=!1},t}(ft),Xt=function(i){function t(i){this._skin=null,t.__super.call(this),this._skin=i,this.init()}n(t,"modules.game.majiangGame.view.majiangPart.singlePart.pengGangPart.BottomSinglePengGangPart",i);var e=t.prototype;return e.init=function(){var i=0,t=this._cardsVec.length;for(i=0;t>i;i++)this._cardsVec[i]=new At(this._skin["peng"+i])},e.show=function(){this._skin.visible=!0},e.hide=function(){this._skin.visible=!1},a(0,e,"visible",function(){return this._skin.visible}),t}(pt),Zt=function(i){function t(i){this._skin=null,t.__super.call(this),this._skin=i,this.init()}n(t,"modules.game.majiangGame.view.majiangPart.singlePart.pengGangPart.LeftSinglePengGangPart",i);var e=t.prototype;return e.init=function(){var i=0,t=this._cardsVec.length;for(i=0;t>i;i++)this._cardsVec[i]=new Rt(this._skin["peng"+i])},e.show=function(){this._skin.visible=!0},e.hide=function(){this._skin.visible=!1},a(0,e,"visible",function(){return this._skin.visible}),t}(pt),qt=function(i){function t(i){this._skin=null,t.__super.call(this),this._skin=i,this.init()}n(t,"modules.game.majiangGame.view.majiangPart.singlePart.pengGangPart.RightSinglePengGangPart",i);var e=t.prototype;return e.init=function(){var i=0,t=this._cardsVec.length;for(i=0;t>i;i++)this._cardsVec[i]=new Mt(this._skin["peng"+i])},e.show=function(){this._skin.visible=!0},e.hide=function(){this._skin.visible=!1},a(0,e,"visible",function(){return this._skin.visible}),t}(pt),Jt=function(i){function t(i){this._skin=null,t.__super.call(this),this._skin=i,this.init()}n(t,"modules.game.majiangGame.view.majiangPart.singlePart.pengGangPart.TopSinglePengGangPart",i);var e=t.prototype;return e.init=function(){var i=0,t=this._cardsVec.length;for(i=0;t>i;i++)this._cardsVec[i]=new Nt(this._skin["peng"+i])},e.show=function(){this._skin.visible=!0},e.hide=function(){this._skin.visible=!1},a(0,e,"visible",function(){return this._skin.visible}),t}(pt),$t=function(i){function t(){t.__super.call(this)}return n(t,"modules.game.majiangGame.controller.ReplayMajiangGameController",i),t}(bt),ie=function(i){function t(){this.isShowOtherCards=!0,t.__super.call(this)}n(t,"modules.game.majiangGame.model.ReplayMajiangModel",i);var e=t.prototype;return e.saveStepData=function(){i.prototype.saveStepData.call(this)},e.reset=function(){i.prototype.reset.call(this),this.isStrictShowCalc=!1},e.replayReset=function(){i.prototype.reset.call(this)},e.cutPengCard=function(t,e){if(this.isShowOtherCards){var s=[e,e],n=0,a=s.length,o=0;for(n=0;a>n;n++)o=this.allCardsVec[t].indexOf(s[n]),-1!=o&&this.allCardsVec[t].splice(o,1)}else i.prototype.cutPengCard.call(this,t,e)},e.cutGangCard=function(t,e,s){if(this.isShowOtherCards){var n,a=0,o=0,h=0;switch(1==this.isTingVec[t]&&this.kouVec[t].length>0&&0!=s&&(this.kouVec[t].length-=1),s){case 0:-1!=this.theFourteenCardVec[t]?this.theFourteenCardVec[t]==e?this.theFourteenCardVec[t]=-1:(o=this.allCardsVec[t].indexOf(e),-1!=o&&this.allCardsVec[t].splice(o,1),this.allCardsVec[t].push(this.theFourteenCardVec[t]),this.theFourteenCardVec[t]=-1,this.sortAllCards(t)):(o=this.allCardsVec[t].indexOf(e),-1!=o&&this.allCardsVec[t].splice(o,1),this.sortAllCards(t));break;case 1:for(this.theFourteenCardVec[t]==e?(this.theFourteenCardVec[t]=-1,n=[e,e,e]):(n=[e,e,e,e],this.allCardsVec[t].push(this.theFourteenCardVec[t]),this.theFourteenCardVec[t]=-1,this.sortAllCards(t)),h=n.length,a=0;h>a;a++)o=this.allCardsVec[t].indexOf(n[a]),-1!=o&&this.allCardsVec[t].splice(o,1);break;case 2:for(n=[e,e,e],h=n.length,a=0;h>a;a++)o=this.allCardsVec[t].indexOf(n[a]),-1!=o&&this.allCardsVec[t].splice(o,1)}}else i.prototype.cutGangCard.call(this,t,e,s)},e.outputCard=function(t,e){if(this.curOutPutPos=t,this.isShowOtherCards){if(this.outputCardsVec[t].push(e),-1!=this.theFourteenCardVec[t]&&this.theFourteenCardVec[t]==e)return this.theFourteenCardVec[t]=-1,void 0;var s=this.allCardsVec[t].indexOf(e);-1!=s&&this.allCardsVec[t].splice(s,1),-1!=this.theFourteenCardVec[t]&&(this.allCardsVec[t].push(this.theFourteenCardVec[t]),this.sortAllCards(t),this.theFourteenCardVec[t]=-1)}else i.prototype.outputCard.call(this,t,e)},e.updateAllCardsVecByGameStart=function(i){var t=0,e=i.length;for(t=0;e>t;t++){var s=this.getPlayerPosByUid(i[t].uid);this.updateOneAllCardsVecByGameStart(i[t].nusercard,s)}},e.updateOneAllCardsVecByGameStart=function(i,t){var e=0;this.allCardsVec[t]=[];var s=i.length;for(e=0;s>e;e++)this.allCardsVec[t].push(i[e].card);this.sortAllCards(t)},t}(Vt),te=function(i){function t(i){t.__super.call(this,i)}n(t,"modules.game.majiangGame.view.card.outputCard.BottomOutputCard",i);var e=t.prototype;return e.down=function(){1!=this.state&&(this._skin.downImg.visible=!0,this._skin.valueImg.visible=!0,this._skin.backImg.visible=!1,modules.game.majiangGame.view.card.BaseCard.prototype.down.call(this))},e.back=function(){2!=this.state&&(this._skin.downImg.visible=!1,this._skin.valueImg.visible=!1,this._skin.backImg.visible=!0,modules.game.majiangGame.view.card.BaseCard.prototype.back.call(this))},e.show=function(){this._skin.visible=!0},e.hide=function(){this._skin.visible=!1},e.setCardImg=function(i){this.cardIdx!=i&&(this._skin.valueImg.skin="gametable/mahjongpai/"+Q.CARD_REFERENCE[i.toString()],modules.game.majiangGame.view.card.BaseCard.prototype.setCardImg.call(this,i))},t}(Dt),ee=function(i){function t(i){t.__super.call(this,i),this._skin=i}n(t,"modules.game.majiangGame.view.card.outputCard.LeftOutputCard",i);var e=t.prototype;return e.down=function(){1!=this.state&&(this._skin.downImg.visible=!0,this._skin.valueImg.visible=!0,this._skin.backImg.visible=!1,modules.game.majiangGame.view.card.BaseCard.prototype.down.call(this))},e.back=function(){2!=this.state&&(this._skin.downImg.visible=!1,this._skin.valueImg.visible=!1,this._skin.backImg.visible=!0,modules.game.majiangGame.view.card.BaseCard.prototype.back.call(this))},e.show=function(){this._skin.visible=!0},e.hide=function(){this._skin.visible=!1},e.setCardImg=function(i){this.cardIdx!=i&&(this._skin.valueImg.skin="gametable/mahjongpai/"+Q.CARD_REFERENCE[i.toString()],modules.game.majiangGame.view.card.BaseCard.prototype.setCardImg.call(this,i))},t}(Dt),se=function(i){function t(i){t.__super.call(this,i),this._skin=i}n(t,"modules.game.majiangGame.view.card.outputCard.RightOutputCard",i);var e=t.prototype;return e.down=function(){1!=this.state&&(this._skin.downImg.visible=!0,this._skin.valueImg.visible=!0,this._skin.backImg.visible=!1,modules.game.majiangGame.view.card.BaseCard.prototype.down.call(this))},e.back=function(){2!=this.state&&(this._skin.downImg.visible=!1,this._skin.valueImg.visible=!1,this._skin.backImg.visible=!0,modules.game.majiangGame.view.card.BaseCard.prototype.back.call(this))},e.show=function(){this._skin.visible=!0},e.hide=function(){this._skin.visible=!1},e.setCardImg=function(i){this.cardIdx!=i&&(this._skin.valueImg.skin="gametable/mahjongpai/"+Q.CARD_REFERENCE[i.toString()],modules.game.majiangGame.view.card.BaseCard.prototype.setCardImg.call(this,i))},t}(Dt),ne=function(i){function t(i){t.__super.call(this,i),this._skin=i}n(t,"modules.game.majiangGame.view.card.outputCard.TopOutputCard",i);var e=t.prototype;return e.down=function(){1!=this.state&&(this._skin.downImg.visible=!0,this._skin.valueImg.visible=!0,this._skin.backImg.visible=!1,modules.game.majiangGame.view.card.BaseCard.prototype.down.call(this))},e.back=function(){2!=this.state&&(this._skin.downImg.visible=!1,this._skin.valueImg.visible=!1,this._skin.backImg.visible=!0,modules.game.majiangGame.view.card.BaseCard.prototype.back.call(this))},e.show=function(){this._skin.visible=!0},e.hide=function(){this._skin.visible=!1},e.setCardImg=function(i){this.cardIdx!=i&&(this._skin.valueImg.skin="gametable/mahjongpai/"+Q.CARD_REFERENCE[i.toString()],modules.game.majiangGame.view.card.BaseCard.prototype.setCardImg.call(this,i))},t}(Dt),ae=function(i){function t(){this.ani_shandian=null,this.ani_huoyan=null,t.__super.call(this),this.ani_shandian=new r,this.ani_shandian.loadAtlas("res/animations/huangseshandian.json"),this.ani_shandian.stop(),this.ani_huoyan=new r,this.ani_huoyan.loadAtlas("res/animations/huoyandonghua.json"),this.ani_huoyan.stop(),this.addChild(this.ani_shandian),this.addChild(this.ani_huoyan),this.ani_shandian.x=(this.width-this.ani_huoyan.width)/2,this.ani_huoyan.y=300,this.y=-300,m.instance.on("MAJIANGPAGE_NOTICE_HUEFF_HIDE",this,this.hide),this.hide()}n(t,"modules.game.majiangGame.view.animation.HuAnimation",i);var e=t.prototype;return e.play=function(){this.ani_shandian.play(0,!1),this.ani_huoyan.play(),this.show()},e.show=function(){this.visible=!0},e.noticeHide=function(){m.instance.event("MAJIANGPAGE_NOTICE_HUEFF_HIDE")},e.hide=function(){this.ani_shandian.stop(),this.ani_huoyan.stop(),this.visible=!1},a(1,t,"instance",function(){return new t},laya.display.Sprite._$SET_instance),t}(j),oe=function(i){function t(){this.tUid=null,this.dat=null,t.__super.call(this),this.on("click",this,this.onClick)}n(t,"modules.game.majiangGame.view.playerInfoPart.GiftItem",i);var e=t.prototype;return e.setData=function(i,t){if(i){this.dat=i,this.tUid=t,this.img.disabled=t==E.uid||0==wt.instance.gameContext.model.isSelfSitDown?!0:!1,this.img.skin="ani/"+i.name+".png";var e=parseInt(i.price);this.costTf.color=e>E.Diamond?"#ff3d01":"#2dc509",this.costTf.text=i.price}},e.onClick=function(){if(this.tUid!=E.uid){if(0==wt.instance.gameContext.model.isSelfSitDown)return x.popMessage("围观用户禁止送礼物！"),void 0;kt.instance.hide(),console.log("送礼物咯：： id:"+this.dat.id+"  tUid:"+this.tUid);var i={id:this.dat.id,tUid:this.tUid};m.instance.event("SOCKET_SEND",T.getProtoMessage(410,i))}},t}(_),he=function(i){function t(i,e,s){this._socketControl=null,void 0===i&&(i=""),t.__super.call(this,i,e,s)}n(t,"modules.game.context.GameMainContext",i);var e=t.prototype;return e.open=function(){i.prototype.open.call(this),null==this._socketControl&&(this._socketControl=new It),this.addController(this.socketControl)},e.close=function(){i.prototype.close.call(this)},a(0,e,"socketControl",function(){return this._socketControl}),t}(f),re=function(i){function t(i,e,s){this._majiangGameView=null,this._majiangGameController=null,this._rMajiangGameController=null,this._majiangModel=null,this._rMajiangModel=null,void 0===i&&(i=""),t.__super.call(this,i,e,s)}n(t,"modules.game.majiangGame.context.MajiangGameContext",i);var e=t.prototype;return e.open=function(){i.prototype.open.call(this),this.initUI(),console.log("addView(_majiangGameView)////////////////"),this.addView(this._majiangGameView),E.isReplay?(this.addController(this._rMajiangGameController),this.addModel(this._rMajiangModel)):(this.addController(this._majiangGameController),this.addModel(this._majiangModel)),console.log("majiang gamecontext UserData.roomtype::"+E.roomtype),this.setChairNum(4),G.swithMusic("game"),console.log("MajiangGameContext open:::..."),console.log("注册了游戏内的消息！！！"),k.instance.continueQueue("MESSAGE_GAME"),m.instance.event("GameContextReady",null)},e.initUI=function(){null==this._majiangModel&&(this._majiangModel=new Vt),null==this._rMajiangModel&&(this._rMajiangModel=new ie),null==this._rMajiangGameController&&(this._rMajiangGameController=new $t),null==this._majiangGameView&&(this._majiangGameView=new Tt),null==this._majiangGameController&&(this._majiangGameController=new bt)},e.close=function(){i.prototype.close.call(this),S.stopMusic()},e.setChairNum=function(i){E.isReplay?this._rMajiangModel.chairNum=i:this._majiangModel.chairNum=i,this._majiangGameView.setChairNmu(i)},a(0,e,"view",function(){return this._majiangGameView}),a(0,e,"controller",function(){return E.isReplay?this._rMajiangGameController:this._majiangGameController}),a(0,e,"model",function(){return E.isReplay?this._rMajiangModel:this._majiangModel}),t}(f);e.__init([kt,vt])}(window,document,Laya),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function(i,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});for(var e in Laya){var s=Laya[e];s&&s.__isclass&&(t[e]=s)}});